[ { "title": "Monitoramento do Di√°rio Oficial da Uni√£o via Telegram", "url": "/posts/DOU2Telegram/", "categories": "Telegram, Bot", "tags": "telegram, bot, dou, diariooficial", "date": "2025-05-24 18:25:00 -0300", "snippet": "Di√°rio Oficial da Uni√£o O Di√°rio Oficial da Uni√£o √© um dos ve√≠culos de comunica√ß√£o pelo qual a Imprensa Nacional do Brasil tem de tornar p√∫blico todo e qualquer assunto acerca do √¢mbito federal.1A...", "content": "Di√°rio Oficial da Uni√£o O Di√°rio Oficial da Uni√£o √© um dos ve√≠culos de comunica√ß√£o pelo qual a Imprensa Nacional do Brasil tem de tornar p√∫blico todo e qualquer assunto acerca do √¢mbito federal.1Acompanhar o DOU √© uma tarefa tediosa, mas que deve ser feita diariamente, seja voc√™ um servidor p√∫blico, um concurseiro ou apenas um cidad√£o que gosta de saber das decis√µes que dizem respeito ao nosso pa√≠s. N√£o raramente s√£o publicadas vers√µes adicionais e em hor√°rios n√£o programados. Fazer o montoramento manualmente √© invi√°vel.DOU2Telegramrequirements.txtInstale os seguintes requisitos:pyTelegramBotAPI==4.21.0requests==2.31.0urllib3==1.26.3beautifulsoup4==4.9.1bot.pyPreencha as vari√°veis e execute o c√≥digo: &lt;TOKEN&gt;: Token do bot que far√° os envios2. &lt;TERMO&gt;: Termo usado na busca do Di√°rio Oficial. &lt;CHATID&gt;: ID de destino da mensagem3.import requestsimport telebotimport urllibfrom bs4 import BeautifulSoupfrom datetime import datetimebot = telebot.TeleBot('&lt;TOKEN&gt;')termo = '&lt;TERMO&gt;'chatid = &lt;CHATID&gt;def check_dou(link, param): try: response = requests.get( link, timeout=10, headers={'User-agent': 'Mozilla/5.1'} ) except: return False return BeautifulSoup(response.content, 'html.parser')def get_dou_results(html): div_content = html.find('p', {'class': 'search-total-label'}) qtd_results = int(div_content.text.strip().split()[0]) return div_content, qtd_resultsdef send_message(param, link, results): btn_link = telebot.types.InlineKeyboardMarkup() btn = telebot.types.InlineKeyboardButton(f'üîó Consultar', url=link) btn_link.row(btn) bot.send_message( chatid, 'üõé &lt;b&gt;Di√°rio Oficial da Uni√£o&lt;/b&gt;\\n\\n'+ f'&lt;b&gt;Termo&lt;/b&gt;: &lt;code&gt;{param}&lt;/code&gt;\\n'+ f'&lt;b&gt;Resultados&lt;/b&gt;: {results}\\n', parse_mode='HTML', reply_markup=btn_link )if __name__ == \"__main__\": today = datetime.today().strftime(\"%d-%m-%Y\") link = ( 'https://www.in.gov.br/consulta/-/buscar/dou?q=%22' +f'{urllib.parse.quote_plus(termo)}' +'%22&amp;s=todos&amp;exactDate=personalizado' +f'&amp;sortType=0&amp;publishFrom={today}&amp;publishTo={today}' ) html = check_dou(link, param) if html: content, results = get_dou_results(html) if results: send_message(param, link, results)Resumo do funcionamentoO script simula uma busca no Di√°rio Oficial usando como par√¢metro a data atual, fun√ß√£o check_dou. Havendo resultados, fun√ß√£o get_dou_results, √© enviada uma mensagem com a fun√ß√£o send_message. https://pt.wikipedia.org/wiki/Di%C3%A1rio_Oficial_da_Uni%C3%A3o¬†&#8617; Como fazer bots para o Telegram.¬†&#8617; Como obter IDs no Telegram.¬†&#8617; " }, { "title": "Modera√ß√£o autom√°tica de conte√∫do usando a nuvem da OpenAI", "url": "/posts/OpenAIModeration/", "categories": "Telegram, Bot", "tags": "telegram, bot, openai, moderation", "date": "2025-04-12 18:30:00 -0300", "snippet": "Modera√ß√£oA OpenAI oferece uma ferramenta gratuita de modera√ß√£o1, cuja finalidade √© analisar os conte√∫dos e classific√°-los entre as categorias: harassment: Conte√∫do que expresse, incite ou promova ...", "content": "Modera√ß√£oA OpenAI oferece uma ferramenta gratuita de modera√ß√£o1, cuja finalidade √© analisar os conte√∫dos e classific√°-los entre as categorias: harassment: Conte√∫do que expresse, incite ou promova linguagem de ass√©dio contra qualquer pessoa; harassment/threatening: Conte√∫do de ass√©dio que tamb√©m inclua viol√™ncia ou dano grave contra qualquer pessoa; hate: Conte√∫do que expresse, incite ou promova √≥dio com base em ra√ßa, g√™nero, etnia, religi√£o, nacionalidade, orienta√ß√£o sexual, defici√™ncia ou casta; hate/threatening: Conte√∫do de √≥dio que tamb√©m inclua viol√™ncia ou dano grave contra o grupo alvo com base em ra√ßa, g√™nero, etnia, religi√£o, nacionalidade, orienta√ß√£o sexual, defici√™ncia ou casta; illicit: Conte√∫do que ofere√ßa conselhos ou instru√ß√µes sobre como cometer atos il√≠citos. illicit/violent: Os mesmos tipos de conte√∫do sinalizados pela categoria illicit:, mas tamb√©m inclui refer√™ncias √† viol√™ncia ou √† obten√ß√£o de armas; self-harm: Conte√∫do que promove, incentiva ou retrata atos de automutila√ß√£o, como suic√≠dio, automutila√ß√£o e transtornos alimentares; self-harm/intent: Conte√∫do em que o falante expressa que est√° se envolvendo ou pretende se envolver em atos de automutila√ß√£o, como suic√≠dio, automutila√ß√£o e transtornos alimentares; self-harm/instructions: Conte√∫do que incentiva a pr√°tica de atos de automutila√ß√£o, como suic√≠dio, automutila√ß√£o e transtornos alimentares, ou que fornece instru√ß√µes ou conselhos sobre como cometer tais atos; sexual: Conte√∫do destinado a despertar excita√ß√£o sexual, como a descri√ß√£o de atividade sexual, ou que promove servi√ßos sexuais (exceto educa√ß√£o sexual e bem-estar); sexual/minors: Conte√∫do sexual que inclua um indiv√≠duo com menos de 18 anos; violence: Conte√∫do que retrate morte, viol√™ncia ou les√£o f√≠sica; violence/graphic: Conte√∫do que retrate morte, viol√™ncia ou les√£o f√≠sica em detalhes gr√°ficos.A resposta da ferramenta √© no formato de probabilidades.Envio de frasefrom openai import OpenAIOPENAI_KEY=open('utils/openai.conf', 'r').read().strip()client = OpenAI(api_key=OPENAI_KEY)response = client.moderations.create( model=\"omni-moderation-latest\", input=\"Voc√™ √© feio\",)print(response)RespostaModerationCreateResponse(id='modr-970d409ef3bef3b70c73d8232df86e7d',model='omni-moderation-latest',results=[ Moderation( categories=Categories( harassment=True, harassment_threatening=False, hate=False, hate_threatening=False, self_harm=False, self_harm_instructions=False, self_harm_intent=False, sexual=False, sexual_minors=False, violence=False, violence_graphic=False, harassment/threatening=False, hate/threatening=False, illicit=False, illicit/violent=False, self-harm/intent=False, self-harm/instructions=False, self-harm=False, sexual/minors=False, violence/graphic=False ), category_scores=CategoryScores( harassment=0.8874508716149667, harassment_threatening=4.583129006350382e-05, hate=0.0071335892195802525, hate_threatening=7.646537350121258e-07, self_harm=0.00046372467876705764, self_harm_instructions=0.00021833860887263772, self_harm_intent=0.0002152775092824918, sexual=7.437028637763686e-05, sexual_minors=1.8925148246037342e-06, violence=0.0005005862322300009, violence_graphic=3.2192334497037803e-06, harassment/threatening=4.583129006350382e-05, hate/threatening=7.646537350121258e-07, illicit=2.0342697805520655e-05, illicit/violent=2.01456908529364e-06, self-harm/intent=0.0002152775092824918, self-harm/instructions=0.00021833860887263772, self-harm=0.00046372467876705764, sexual/minors=1.8925148246037342e-06, violence/graphic=3.2192334497037803e-06 ), flagged=True, category_applied_input_types={ 'harassment': ['text'], 'harassment/threatening': ['text'], 'sexual': ['text'], 'hate': ['text'], 'hate/threatening': ['text'], 'illicit': ['text'], 'illicit/violent': ['text'], 'self-harm/intent': ['text'], 'self-harm/instructions': ['text'], 'self-harm': ['text'], 'sexual/minors': ['text'], 'violence': ['text'], 'violence/graphic': ['text'] } )])ResultadoA linha 49 confirma que o conte√∫do resultou em positivo para alguma das categorias:flagged=True,J√° a linha 6 indica:harassment=True,Com a probabilidade conforme a linha 28:harassment=0.8874508716149667,Ou seja, a ferramenta detectou um ass√©dio(harassment) com probabilidade de 88.74% na mensagem enviada.Envio de imagemPara fazer a an√°lise de imagens, utilize o c√≥digo:from openai import OpenAIOPENAI_KEY=open('utils/openai.conf', 'r').read().strip()client = OpenAI(api_key=OPENAI_KEY)response = client.moderations.create( model=\"omni-moderation-latest\", input=[ { \"type\": \"image_url\", \"image_url\": { &lt;URL_DA_IMAGEM&gt; } } ])print(response)TelegramOs conte√∫dos enviados no Telegram podem ser nocivos e ocasionar a remo√ß√£o do grupo uma vez que os Termos de Uso foram descumpridos. Para evitar este tipo de problema, utilizo um bot que submete √† OpenAI textos e imagens enviados e, dependendo do caso, notifica os administradores ou remove o conte√∫do de imediato. Assim, n√£o √© necess√°rio que um administrador esteja sempre observando tudo. O bot ir√° alertar sobre textos ou remover imagens quando for necess√°rio.BotO AnaliseDeConteudoBot submete √† ferramenta todo o conte√∫do compartilhado em grupos em que sou administrador. Caso o conte√∫do seja um texto, todos os administradores do grupo recebem uma mensagem com o alerta, contendo o link para a mensagem original e uma c√≥pia do que foi escrito. Caso o conte√∫do seja uma imagem, o bot automaticamente a remove do grupo ap√≥s notificar os administradores. Ap√≥s meses usando a ferramenta, cheguei √† conclus√£o que o valor de 0.8 √© um bom limite para notificar os administradores ou remover conte√∫dos. Menos que isso gerou muitos falsos positivos.Para ficar claro para o grupo que os administradores foram alertados, as mensagens que gerarem notifica√ß√µes recebem a rea√ß√£o ü§î. Caso um dos administradores clique em Ignorar alerta, a rea√ß√£o √© removida da mensagem. O bot tamb√©m faz a verifica√ß√£o de mensagens editadas, portanto, √© poss√≠vel que uma mesma mensagem gere alertas repetidos a depender do conte√∫do de cada edi√ß√£o.Exemplos de alertas de conte√∫dos inapropriados categorizados como harassment.Executando o botTodo o conte√∫do do bot est√° presente no reposit√≥rio github.com/GabrielRF/AnaliseDeConteudoBot. Ap√≥s baixar o conte√∫do, abra a pasta utils e edite os tr√™s arquivos, sendo eles: bottoken.conf: Com o token do Bot obtido no @BotFather; groups.conf: Os IDs dos grupos em que o bot ir√° funcionar2; openai.conf: O token de acesso obtido na OpenAI.Preenchidos os arquivos corretamente, basta executar o arquivo bot.py como preferir3. OpenAI Moderation¬†&#8617; Como obter IDs no Telegram¬†&#8617; Como manter um processo rodando para sempre¬†&#8617; " }, { "title": "Telegram Stars - Primeiras impress√µes", "url": "/posts/TelegramStars/", "categories": "Telegram, Bot", "tags": "telegram, stars, bot", "date": "2024-08-19 18:30:00 -0300", "snippet": "StarsNo dia 6 de Junho de 2024 o Telegram lan√ßou sua criptomoeda chamada Telegram Stars1. Seu uso passou a ser obrigat√≥rio em transa√ß√µes que envolvam produtos ou servi√ßos digitais2. Bots que descum...", "content": "StarsNo dia 6 de Junho de 2024 o Telegram lan√ßou sua criptomoeda chamada Telegram Stars1. Seu uso passou a ser obrigat√≥rio em transa√ß√µes que envolvam produtos ou servi√ßos digitais2. Bots que descumprirem a regra podem ser punidos com suspens√£o.CompraAs Stars podem ser adquiridas a partir de qualquer bot que tenha sistema de cobran√ßa. Basta clicar no bot√£o de comprar que, n√£o havendo saldo suficiente em Stars, ser√° exibida a op√ß√£o de compra. Seu custo √© de aproximadamente US$ 1,00 para cada 50 Stars.Tabela de pre√ßos (em d√≥lares) Sabendo que as estrelas possuem um valor fixo para o saque, a Taxa que o Telegram cobra em cada transa√ß√£o foi estimada nas tabelas abaixo.Lojas AppStore e PlayStore Quantidade Pre√ßo Comiss√£o Loja Taxa Telegram 50 0,99 0,30 (30%) 0,04 (4%) 75 1,49 0,45 (30%) 0,07 (4,5%) 100 1,99 0,60 (30%) 0,09 (4,5%) 150 2,99 0,90 (30%) 0,14 (4,6%) 250 4,99 1,50 (30%) 0,24 (4,8%) 350 6,99 2,10 (30%) 0,34 (4,8%) 500 9,99 3,00 (30%) 0,49 (4,9%) 750 14,99 4,50 (30%) 0,74 (4,9%) 1000 19,99 6,00 (30%) 0,99 (5%) 1500 29,99 9,00 (30%) 1,49 (5%) 2500 49,99 15,00 (30%) 2,49 (5%) Tabela com os pre√ßos de apps de lojas. Fonte.Fragment Fragment.com Quantidade Pre√ßo Taxa Telegram 50 0,75 0,10 (13,3%) 75 1,13 0,15 (13,3%) 100 1,50 0,20 (13,3%) 150 2,25 0,30 (13,3%) 250 3,75 0,50 (13,3%) 350 5,25 0,70 (13,3%) 500 7,50 1,00 (13,3%) 750 11,25 1,50 (13,3%) 1000 15,00 2,00 (13,3%) 1500 22,50 3,00 (13,3%) 2500 37,50 5,00 (13,3%) Direct Site Telegram Quantidade Pre√ßo Taxa Telegram 50 0,93 0,28 (30%) 75 1,32 0,35 (26%) 100 1,69 0,39 (23%) 150 2,49 0,54 (22%) 250 4,03 0,78 (19%) 350 5,59 1,04 (19%) 500 7,89 1,39 (18%) Quantidade: Quantidade de estrelas compradas Pre√ßo: Valor pago em d√≥lares americanos Comiss√£o loja: Comiss√£o das lojas da Apple e do Google Taxa Telegram: Taxa cobrada pelo TelegramSaqueO valor para saque √© de US$ 0,013 cada estrela3. Ou seja, independente de como foi feita a compra, o desenvolvedor do bot receber√° 0,013 centavos de d√≥lar em cada estrela. O requisito para o saque √© ter pelo menos 1.000 estrelas h√° pelo menos 21 dias4.Consultar SaldoO saldo √© visualizado individualmente em cada chat, seja ele um bot ou um canal. Infelizmente os saldos n√£o s√£o agrupados. Ou seja, mesmo que sejam atingidas 998 estrelas em um bot e 500 em um canal, o saque n√£o ser√° permitido. √â necess√°rio que o requisito seja atingido no chat individualmente.Saldo de Stars em um bot.UsoEstou usando as estrelas em dois bots, @Send2KindleBot e @ClientesChatBot. A solu√ß√£o foi implementada n√£o por ser √≥tima, mas sim por ser uma imposi√ß√£o do app. Caso n√£o tenha implementado as estrelas em seus bots, canais ou grupos, recomendo que o fa√ßa, caso contr√°rio o Telegram pode punir sua solu√ß√£o, tornando seu chat indispon√≠vel.Conclus√£oApesar de ser uma solu√ß√£o de f√°cil implementa√ß√£o nos bots e canais, as Estrelas est√£o longe de ser uma solu√ß√£o ideal. Infelizmente, dentre os usu√°rios de meus bots, o coment√°rio mais comum foi: N√£o encontrei onde comprar as estrelas. Ou seja, h√° ainda um longo caminho de ensinamentos a ser trilhado. O Telegram n√£o fez nenhuma a√ß√£o que explicasse o funcionamento ou a aquisi√ß√£o das estrelas. Al√©m disso, o fato de os saldos n√£o serem agrupados me preocupa muito, pois √© poss√≠vel que as estrelas se percam antes do prazo poss√≠vel para o saque. Stars earned in connection with the content you publish on Telegram are valid for 3 years from the date they were received. Should you fail to accept rewards with the Stars you accrued within their 3 year period of validity, they will be considered forfeit and debited from your balance5.Ou seja, se no per√≠odo de tr√™s anos n√£o for feito o saque, o saldo ser√° incorporado ao patrim√¥nio do Telegram. ü§° Post oficial do Telegram.¬†&#8617; Termos de uso da moeda Telegram Stars.¬†&#8617; Termos de uso para Criadores de Conte√∫do, se√ß√£o Conte√∫do Pago¬†&#8617; Termos de uso para Criadores de Conte√∫do, se√ß√£o Saldo¬†&#8617; Termos de uso para Criadores de Conte√∫do, se√ß√£o Validade¬†&#8617; " }, { "title": "Notificando inscritos da Twitch via Telegram", "url": "/posts/Twitch2Telegram/", "categories": "Telegram, Automa√ß√£o", "tags": "telegram, twitch, notificacoes, inscritos, canal", "date": "2024-07-28 20:00:00 -0300", "snippet": "TwitchTwitch √© um site em que milh√µes de pessoas se re√∫nem diariamente para conversar, interagir e criar seu pr√≥prio conte√∫do. Tem como principal atrativo as transmiss√µes ao vivo, chamadas de lives...", "content": "TwitchTwitch √© um site em que milh√µes de pessoas se re√∫nem diariamente para conversar, interagir e criar seu pr√≥prio conte√∫do. Tem como principal atrativo as transmiss√µes ao vivo, chamadas de lives, em que o bate-papo, chat, interage entre si e com o criador do conte√∫do. No entanto, assim como em outras plataformas, as notifica√ß√µes aos inscritos podem atrasar ou at√© mesmo nunca chegar, deixando parte da audi√™ncia de fora das transmiss√µes.TelegramCanais do Telegram s√£o parecidos com grupos de conversas, com a diferen√ßa que somente os administradores podem falar. Um canal entrega a notifica√ß√£o para todos os inscritos simultaneamente, sem limite de quantidade, sendo ideal para grandes p√∫blicos1. Grupos, por exemplo, s√£o limitados a 200.000 pessoas. J√° os bots enviam apenas 30 mensagens por segundo2.Integrando as notifica√ß√µes da Twitch ao TelegramAplica√ß√£o na TwitchO primeiro passo √© a cria√ß√£o de uma aplica√ß√£o na Twitch. Ela √© importante para a obten√ß√£o dos dados da transmiss√£o. Acesse dev.twitch.tv/console; Crie uma aplica√ß√£o nova em Register Your Application; Preencha os campos: Name: Nome de sua aplica√ß√£o. OAuth Redirect URLs: Preencha com http://localhost; Category: Confidential. Salve os valores de Client ID e Client Secret.Bot no TelegramA fun√ß√£o do bot √© o envio da mensagem do canal. Seu nome ou @nome_de_usu√°rio s√£o irrelevantes, pois n√£o ser√£o vistos pelos inscritos. Fale com o @BotFather e crie um bot3; Salve o valor do Token; Caso o canal n√£o exista, crie-o e salve seu ID4; Adicione o bot como administrador do canal.Script Pythonrequirements.txtInstale as bibliotecas abaixo:pytelegrambotapi==4.21.0requests==2.28.1twitch2telegramO script abaixo √© respons√°vel por verificar a exist√™ncia de lives, gerar a thumbnail e fazer os envios.import datetimeimport pytzimport requestsimport telebot## Twitchclient_id = \"&lt;Client ID da Twitch&gt;\"client_secret = \"&lt;Client Secret da Twitch&gt;\"streamer = \"&lt;Nome da Stream&gt;\"## Telegramtoken = \"&lt;Token do bot&gt;\"destination = &lt;ID de destino da mensagem&gt;## Ajustesminutos = 5## Verifica os dados da streamdef get_data(): body = { 'client_id': client_id, 'client_secret': client_secret, 'grant_type': 'client_credentials' } r = requests.post('https://id.twitch.tv/oauth2/token', body) keys = r.json(); headers = { 'Client-ID': client_id, 'Authorization': 'Bearer ' + keys['access_token'] } stream = requests.get( 'https://api.twitch.tv/helix/streams?user_login=' + streamer, headers=headers ) stream_data = stream.json(); try: return stream_data['data'][0] except IndexError: return None## Gera a thumbnaildef get_thumbnail(live_data): thumbnail_url = live_data['thumbnail_url'] thumbnail_url = thumbnail_url.replace('{width}x{height}', '1280x720') response = requests.get(thumbnail_url) open('thumb.png', 'wb').write(response.content) return open('thumb.png', 'rb')## Envia mensagemdef send_message(thumbnail, title): bot = telebot.TeleBot(token) message = ( f'üî¥ &lt;b&gt;Alerta de Live!&lt;/b&gt;\\n' + f'&lt;blockquote&gt;{title}&lt;/blockquote&gt;' ) btn_link = telebot.types.InlineKeyboardMarkup() btn = telebot.types.InlineKeyboardButton(f'üìπ Twitch', url=f'https://www.twitch.tv/{streamer}') btn_link.row(btn) msg = bot.send_photo( destination, thumbnail, caption=message, parse_mode='HTML', reply_markup=btn_link )## Verifica h√° quanto tempo a transmiss√£o est√° funcionandodef check_time(): start_time = datetime.datetime.strptime( live_data['started_at'], '%Y-%m-%dT%H:%M:%S%z' ) time_diff = ( datetime.datetime.utcnow().replace(tzinfo=pytz.utc) - start_time ) if time_diff &lt; datetime.timedelta(minutes=minutos): return True return Falseif __name__ == \"__main__\": live_data = get_data() if live_data and check_time(): title = live_data['title'] thumbnail = get_thumbnail(live_data) send_message(thumbnail, title)Para que o c√≥digo funcione, ajuste as vari√°veis: client_id: Com o valor fornecido pela Twitch no passo Aplica√ß√£o na Twitch; client_secret: Com o valor fornecido pela Twitch no passo Aplica√ß√£o na Twitch; streamer: Nome do streamer; token: Token do bot criado no passo Bot no Telegram; destination: ID de destino da mensagem4; minutos: Intervalo de checagem. Exemplo: Se a checagem for feita a cada cinco minutos, o valor deve ser 5. A vari√°vel minutos tem a fun√ß√£o de simplificar o c√≥digo. Caso a transmiss√£o tenha mais tempo de dura√ß√£o que o valor desta vari√°vel, nenhuma mensagem √© enviada. Caso contr√°rio, √© entendido que a live come√ßou h√° pouco tempo, portanto, a mensagem √© enviada no canal.O script python pode ser rodado de in√∫meras formas. Recomendo o uso de cronjobs ou at√© como um servi√ßo do sistema operacional5.Exemplos de canaisDois exemplos de canais que usam o script deste post: @NaoSigo, com atualiza√ß√µes das lives e v√≠deos do Cid Cidoso (N√£o Salvo). @BotaNoGau, com informa√ß√µes das streams do Gaules. Telegram n√£o aumenta engajamento.¬†&#8617; Broadcasting to Users.¬†&#8617; Como fazer bots para o Telegram¬†&#8617; Como obter IDs no Telegram¬†&#8617;¬†&#8617;2 Como manter um processo rodando para sempre¬†&#8617; " }, { "title": "Descri√ß√£o autom√°tica de imagens no Telegram usando ChatGPT-4o", "url": "/posts/ChatGPT4o-Image-Description/", "categories": "Telegram, Automa√ß√£o", "tags": "telegram, automa√ß√£o, openai, descri√ß√£o, acessibilidade", "date": "2024-05-25 11:00:00 -0300", "snippet": "Descri√ß√£o das duas imagens do post: A imagem mostra uma estrutura arquitet√¥nica ic√¥nica, possivelmente a Catedral Metropolitana de Bras√≠lia, projetada por Oscar Niemeyer. A catedral possui um desi...", "content": "Descri√ß√£o das duas imagens do post: A imagem mostra uma estrutura arquitet√¥nica ic√¥nica, possivelmente a Catedral Metropolitana de Bras√≠lia, projetada por Oscar Niemeyer. A catedral possui um design distinto, com 16 colunas de concreto que se curvam em dire√ß√£o ao c√©u, criando uma forma circular e coroada por uma cruz met√°lica. As colunas t√™m uma apar√™ncia que lembra m√£os interligadas em ora√ß√£o, simbolizando encontro e eleva√ß√£o espiritual. Na frente da estrutura, algumas pessoas est√£o reunidas na √°rea externa. O c√©u est√° parcialmente nublado, com tons alaranjados indicativos do entardecer, conferindo uma ilumina√ß√£o suave e din√¢mica √† cena. A imagem √© um banner promocional para um evento intitulado ‚ÄúConcurso Nacional Unificado‚Äù. √Ä esquerda do banner, em letras grandes e azuis, l√™-se ‚ÄúConcurso Nacional Unificado‚Äù. Na parte inferior esquerda, h√° os logos do Minist√©rio da Gest√£o e da Inova√ß√£o em Servi√ßos P√∫blicos e do Governo Federal, que inclui a bandeira do Brasil estilizada acompanhada do texto ‚ÄúUni√£o e Reconstru√ß√£o‚Äù. √Ä direita da imagem, h√° a foto em preto e branco de uma mulher jovem, sorrindo, segurando um caderno de prancheta. A foto dela est√° emoldurada por um contorno verde e superposta a v√°rias formas geom√©tricas coloridas, como um c√≠rculo vermelho com listras brancas e um tri√¢ngulo amarelo com um c√≠rculo azul dentro. O fundo do banner √© predominantemente branco, com detalhes coloridos nos cantos superiores esquerdo e inferior direito, seguindo um estilo moderno e vibrante.ChatGPT-4oNo dia 13 de Maio de 2024 a OpenAI lan√ßou a vers√£o mais nova do ChatGPT, a vers√£o 4o. Segundo a pr√≥pria OpenAI: GPT-4o (‚Äúo‚Äù de ‚Äúomni‚Äù) √© um passo em dire√ß√£o a uma intera√ß√£o humano-computador muito mais natural‚Äîele aceita como entrada qualquer combina√ß√£o de texto, √°udio, imagem e v√≠deo e gera qualquer combina√ß√£o de sa√≠das de texto, √°udio e imagem. Ele pode responder a entradas de √°udio em apenas 232 milissegundos, com uma m√©dia de 320 milissegundos, o que √© semelhante ao tempo de resposta humano em uma conversa. Ele iguala o desempenho do GPT-4 Turbo em texto em ingl√™s e c√≥digo, com melhorias significativas em texto em l√≠nguas n√£o inglesas, al√©m de ser muito mais r√°pido e 50% mais barato na API. O GPT-4o √© especialmente melhor na compreens√£o de vis√£o e √°udio em compara√ß√£o com os modelos existentes. 1Os v√≠deos do lan√ßamento s√£o impressionantes2. Um v√≠deo em particular chamou minha aten√ß√£o:Motiva√ß√£oParticipo de um grupo no Telegram que possui, dentre suas recomenda√ß√µes e regras, a orienta√ß√£o de que descrevam todas as imagens. A meta √© que todas as pessoas sejam capazes de participar das conversas, independente de qualquer coisa. Ao assistir o v√≠deo acima, pensei: Por que n√£o automatizar a descri√ß√£o de imagens?BotA integra√ß√£o com um bot do Telegram foi relativamente simples. Segui o guia oficial3 e funcionou de maneira excepcional. As descri√ß√µes, em sua maioria, ficam excelentes! Como a funcionalidade √© paga, o bot n√£o √© p√∫blico. Caso crie o seu, n√£o se esque√ßa de consultar os pre√ßos no site. 4requirements.txtCrie o arquivo requirements.txt com o conte√∫do:pyTelegramBotAPI==4.15.4requests==2.31.0Instale as depend√™ncias usando o comando:pip install -r requirements.txtbot.pyimport base64import requestsimport telebot# Valores necess√°rios ao funcionamentoBOT_TOKEN = &lt;Token do bot&gt;OPENAI_KEY = &lt;Api key da OpenAI&gt;# Cria botbot = telebot.TeleBot(BOT_TOKEN)# Baixa a imagem e retorna o nome do arquivodef download_photo(message): photo_info = bot.get_file(message.photo[-1].file_id) photo_download = bot.download_file(photo_info.file_path) photo_name = f'{photo_info.file_unique_id[:6]}.{photo_info.file_path.split(\".\")[-1]}' with open(photo_name, 'wb') as new_photo: new_photo.write(photo_download) return photo_name# Faz o encode da imagem para base64def encode_image(photo_name): with open(photo_name, \"rb\") as photo_file: return base64.b64encode(photo_file.read()).decode('utf-8')# Gera a descri√ß√£o da fotodef describe_photo(photo_encoded): headers = { \"Content-Type\": \"application/json\", \"Authorization\": f\"Bearer {OPENAI_KEY}\" } payload = { \"model\": \"gpt-4o\", \"messages\": [ { \"role\": \"user\", \"content\": [ { \"type\": \"text\", \"text\": \"Descreva a imagem\" }, { \"type\": \"image_url\", \"image_url\": { \"url\": f\"data:image/jpeg;base64,{photo_encoded}\" } } ] } ], \"max_tokens\": 500 } response = requests.post(\"https://api.openai.com/v1/chat/completions\", headers=headers, json=payload) return response.json()['choices'][0]['message']['content']# Remove a foto do disco de armazenamentodef remove_photo(photo_name): os.remove(photo_name)# Recebimento de imagens e envio de descri√ß√£o@bot.message_handler(content_types=['photo'])def get_photo(message): photo_name = download_photo(message) photo_encoded = encode_image(photo_name) description = describe_photo(photo_encoded) text = ( f'üñº &lt;b&gt;Descri√ß√£o autom√°tica:&lt;/b&gt;' f'\\n&lt;blockquote&gt;{description}&lt;/blockquote&gt;' ) bot.send_message( message.chat.id, text, parse_mode='HTML', reply_to_message_id=message.id ) remove_photo(photo_name)bot.infinity_polling()Sendo: BOT_TOKEN: O token do seu bot, obtido no @BotFather; OPENAI_KEY: Chave de API da OpenAI, obtida em https://platform.openai.com/api-keys.O bot √© executado pelo comando5:python bot.py Texto de apresenta√ß√£o: https://openai.com/index/hello-gpt-4o/¬†&#8617; Playlist de lan√ßamento do ChatGPT 4o: https://www.youtube.com/playlist?list=PLOXw6I10VTv8VOvPNVQ8c4D4NyMRMotXh¬†&#8617; Guia oficial de implementa√ß√£o do Vision: https://platform.openai.com/docs/guides/vision¬†&#8617; Pre√ßos do ChatGPT 4o: https://openai.com/api/pricing/¬†&#8617; Veja o post ‚ÄúComo manter um processo rodando para sempre‚Äù¬†&#8617; " }, { "title": "Transcri√ß√£o autom√°tica de √°udios na nuvem da OpenAI", "url": "/posts/WhisperPyrogramCloud/", "categories": "Telegram, Automa√ß√£o", "tags": "telegram, automa√ß√£o, whisper, openai, pyrogram", "date": "2024-05-04 11:00:00 -0300", "snippet": " Leia as informa√ß√µes introdut√≥rias deste post em Transcri√ß√£o autom√°tica de mensagens de voz no Telegram.Nuvem da OpenAIUsar a nuvem da OpenAI para a transcri√ß√£o de √°udios, apesar de paga, pode ser...", "content": " Leia as informa√ß√µes introdut√≥rias deste post em Transcri√ß√£o autom√°tica de mensagens de voz no Telegram.Nuvem da OpenAIUsar a nuvem da OpenAI para a transcri√ß√£o de √°udios, apesar de paga, pode ser uma √≥tima alternativa quando avaliada a rela√ß√£o custo x benef√≠cio. Atualmente, em maio de 2024, a transcri√ß√£o, utilizando o modelo Whisper, custa aproximadamente US$ 0,006 por minuto, arredondado para o segundo mais pr√≥ximo do tempo do √°udio. Tal custo, dependendo do uso, pode ser inferior ao gasto mensal com a energia el√©trica para se manter um computador em funcionamento, pricipalmente quando comparado ao uso de m√°quinas com placas de v√≠deo de alto desempenho. Veja os pre√ßos atualizados da nuvem da OpenAI no site oficial.Para meu uso pessoal, as principais vantages de usar a nuvem s√£o: Menor gasto mensal, pois meu computador faz minha conta de energia el√©trica aumentar aproximadamente R$ 100,00/m√™s, sendo o uso da nuvem inferior a US$ 2,00/m√™s; O servidor do script tem menores requisitos computacionais uma vez que n√£o faz nenhum processamento importante. Excelente qualidade na transcri√ß√£o.Mudan√ßas no c√≥digoA mudan√ßa no c√≥digo √© pequena. Em resumo, basta alterar a fun√ß√£o voice_to_text:def voice_to_text(voice_file, i=0): if i == 5: return False audio_file = open(voice_file, 'rb') try: result = client.audio.transcriptions.create( model=\"whisper-1\", file=audio_file ).text except: time.sleep(3) result = voice_to_text(voice_file, i+1) return resultE criar um client antes de a fun√ß√£o ser executada:client = OpenAI(api_key='ab-cdefghijklmnopqrstuvxz')A API_KEY deve ser obtida cadastrando-se em platform.openai.com/api-keys.O c√≥digo completo da solu√ß√£o √©:from pyrogram import Client, filters, enumsimport telebotimport timeimport osfrom openai import OpenAIapi_id = 123456789api_hash = \"1a2b3c4d5e6f7g8h9i0j\"app = Client(\"Voice2Text\", api_id=api_id, api_hash=api_hash)client = OpenAI(api_key='ab-cdefghijklmnopqrstuvxz')def remove_file(voice_file): os.remove(voice_file)def voice_to_text(voice_file, i=0): if i == 5: return False audio_file = open(voice_file, 'rb') try: result = client.audio.transcriptions.create( model=\"whisper-1\", file=audio_file ).text except: time.sleep(3) result = voice_to_text(voice_file, i+1) return resultdef download_voice(message): return app.download_media(message)def edit_message(client, msg, message, transcription): text = ( f'&lt;b&gt;üéô Transcri√ß√£o autom√°tica:&lt;/b&gt;' f'\\n&lt;i&gt;{transcription}&lt;/i&gt;' ) client.edit_message_text( chat_id=message.chat.id, message_id=msg.id, text=text, parse_mode=enums.ParseMode.HTML )def send_message(client, message): msg = app.send_message( chat_id=message.chat.id, text='üìù Transcri√ß√£o iniciada...', parse_mode=enums.ParseMode.HTML, reply_to_message_id=message.id ) return msgdef delete_message(client, msg): app.delete_messages( chat_id=msg.chat.id, message_ids=msg.id )@app.on_message(filters.private &amp; (filters.voice | filters.video_note))def receive_voice(client, message): msg = send_message(client, message) app.send_chat_action(message.chat.id, enums.ChatAction.TYPING) voice_file = download_voice(message) transcription = voice_to_text(voice_file) if not transcription: delete_message(client, msg) return print(f'{message.chat.id} disse: {transcription}') edit_message(client, msg, message, transcription) remove_file(voice_file)app.run()E pronto! Deixando esse script em execu√ß√£o, as transcri√ß√µes das mensagens de voz enviadas ou recebidas acontecer√° automaticamente.Leia mais em Como manter um processo rodando para sempre." }, { "title": "Detec√ß√£o de movimento e disparo de v√≠deo por Telegram", "url": "/posts/MotionToTelegram/", "categories": "Automa√ß√£o Residencial, CFTV", "tags": "python, hass, homeassistant, camera, webcam, cftv, rpi, raspberry, telegram, bot", "date": "2023-12-24 13:00:00 -0300", "snippet": " Monitore sua casa com custo baix√≠ssimo e sem se preocupar com DVR ou espa√ßo em disco.Mais que um monitor de movimento, uma webcam √© uma poderos√≠ssima ferramenta de automa√ß√£o residencial e de segu...", "content": " Monitore sua casa com custo baix√≠ssimo e sem se preocupar com DVR ou espa√ßo em disco.Mais que um monitor de movimento, uma webcam √© uma poderos√≠ssima ferramenta de automa√ß√£o residencial e de seguran√ßa. Usando duas solu√ß√µes open source e um aplicativo de mensagens, este guia explica como fazer o envio de v√≠deos curtos sempre que for detectado movimento na c√¢mera.RequisitosMotionPrograma de c√≥digo aberto capaz de interpretar v√≠deo de c√¢meras e agir quando houver movimento. √â o componente respons√°vel por fazer o monitoramento e gerar um arquivo .mp4 sempre que houver movimento. Al√©m disso, √© capaz de fazer streaming da c√¢mera, permitindo a visualiza√ß√£o em tempo real do que est√° acontecendo, al√©m de poder ser integrado ao Home Assistant.Site: https://motion-project.github.io/Video2TelegramPequeno script Python que monitora uma pasta e, havendo um arquivo novo, o envia pelo aplicativo Telegram. Pode fazer a convers√£o para gif (Video2Telegram) ou n√£o (Document2Telegram), a depender da prefer√™ncia.Reposit√≥rios: Video2Telegram: https://github.com/GabrielRF/Video2Telegram Document2Telegram: https://github.com/GabrielRF/Document2Telegram TelegramO aplicativo Telegram √© a escolha ideal por ser leve e com armazenamento gratuito na nuvem para arquivos de at√© 2GB, sem limite de quantidade. Al√©m disso, pode ser acessado de diversos dispositivos, n√£o ficando dependente de um celular o tempo todo.Configura√ß√£oRaspberry Pi Este guia foi pensado e testado em um Raspberry Pi 3 Model B Rev 1.2 e em um Raspberry Pi Zero 2 W. Pode ser aplicado tamb√©m em computadores com sistema operacional Linux, desde que compat√≠vel com o Motion. Este guia foi feito usando o sistema Raspberry Pi OS Lite de 11 de Dezembro de 2023. A vantagem da vers√£o Lite √© ser mais leve, consumindo menos espa√ßo e recursos computacionais. Como o Raspberry Pi ficar√° dedicado √† solu√ß√£o, sem softwares adicionais, a vers√£o Lite foi a escolhida.Baixe o sistema operacional de sua prefer√™ncia no site oficial, em https://www.raspberrypi.com/software/operating-systems/.Feito o download, crie um disco de boot da imagem baixada.Cria√ß√£o de disco de boot.Acesso SSHPara habilitar o acesso via ssh, ap√≥s a cria√ß√£o da imagem, crie um arquivo chamado ssh na parti√ß√£o de boot.cd /media/gabriel/bootfstouch ssh Substituindo gabriel pelo usu√°rio de seu computador.Cria√ß√£o de usu√°rioPor padr√£o, o sistema operacional do Raspberry Pi exige a cria√ß√£o de um novo usu√°rio ao ser ligado pela primeira vez. Para pular este passo, recomendo os passos abaixo:Encripte a senha do usu√°rioExecute o comando abaixo e armazene seu resultado, pois ser√° usado a seguir.echo '&lt;DIGITE SUA SENHA AQUI&gt;' | openssl passwd -6 -stdinCrie um arquivo na parti√ß√£o de boottouch userconfAbra o arquivo userconf criado acima com o editor de sua prefer√™ncia e cole o conte√∫do&lt;USUARIO&gt;:&lt;SENHA ENCRIPTADA&gt;Ou seja, o arquivo userconf com o usu√°rio gabriel e a senha teste teria, por exemplo, o conte√∫do:gabriel:$6$6OITwZhScE7vD4r7$bEGFbmrOqbVCEGp.N5rmu9ca1arqH.ynOxRXMYl6XYLeyXfPIEMaOGr0yr9tY8RKcSBJDEfXHUYva3QWRTR2G. Aten√ß√£o: A mesma senha n√£o ir√° gerar a mesma sa√≠da! N√£o estranhe se o resultado for diferente do exemplo.RedeInfelizmente n√£o √© mais poss√≠vel fazer a configura√ß√£o da conex√£o √† redes sem fio pelo arquivo wpa_supplicant.conf1, portanto, para seguir este guia, recomendo que fa√ßa a liga√ß√£o √† sua rede via cabo.Configura√ß√£o do Raspberry Pi OSFeita a configura√ß√£o inicial, acesse seu Raspberry Pi via ssh.ssh &lt;USUARIO&gt;@&lt;IP RASPBERRY PI&gt;Atualize os pacotes e instale o Motion.sudo apt-get updatesudo apt-get install motionO Motion ir√° falhar caso tente execut√°-lo. Para corrigir o problema, execute os dois comandos:sudo mkdir motion:motion /var/log/motion/sudo chown -R motion:motion /var/log/motion/O primeiro cria a pasta de log e o segundo d√° a permiss√£o correta para esta pasta. Feito isto, o Motion j√° est√° pronto para ser usado.Configura√ß√£o do MotionO arquivo de configura√ß√£o do Motion fica armazenado em /etc/motion/motion.conf. Abaixo listo alguns pontos relevantes e algumas recomenda√ß√µes de mudan√ßas. Por ser um ajuste fino que depende de diversos fatores, como modelo da c√¢mera, intensidade da luz e √°rea monitorada, n√£o existe resposta 100% correta. Cada caso necessita de ajustes espec√≠ficos. target_dir: Pasta em que ficam os v√≠deos e fotos do Motion; video_device: Dispositivo de v√≠deo. Em geral, n√£o precisa ser alterado; width: Largura da imagem. Quanto maior, melhor. Por√©m, quanto maior, mais pesado o arquivo. Recomendo ao menos 800; height: Altura da imagem. Recomendo ao menos 600; framerate: Taxa de quadros por segundo. Recomendo 30; text_left: Texto exibido na esquerda; text_right: Texto da direita; threshold: Quantidade m√≠nima de pixels que precisam variar para que seja considerado movimento; minimum_motion_frames: N√∫mero m√≠nimo de quadros com varia√ß√£o para ser considerado movimento; event_gap: Intervalo em segundos entre eventos. Recomendo 0; pre_capture: N√∫mero de quadros anteriores ao movimento para compor o v√≠deo. Recomendo 2; post_capture: N√∫mero de quadros posteriores ao movimento para compor o v√≠deo. Recomendo 2; movie_max_time: Tamanho m√°ximo do v√≠deo em segundos. Recomendo 30; movie_quality: Qualidade do v√≠deo. Recomendo 100; movie_codec: Coded do v√≠deo. Recomendo mp42; movie_filename: Nome do arquivo de v√≠deo; webcontrol_localhost: Permitir controle de fora do Raspberry Pi. Recomendo off; stream_localhost: Permitir acesso ao streaming de fora do Raspberry Pi. Recomendo off.Ap√≥s toda e qualquer mudan√ßa no arquivo motion.conf √© necess√°rio reiniciar a aplica√ß√£o executando:sudo systemctl restart motionRegistros / LogPara ver o log, acesse o arquivo /var/log/motion/motion.log. Caso necessite visualizar mais detalhes, altere o valor de log_level para 9 no arquivo de configura√ß√£o.StreamingCaso tenha permitido a visualiza√ß√£o da c√¢mera no par√¢metro stream_localhost, acesse o endere√ßo IP do Raspberry Pi pelo seu navegador pela porta 8080.Acesso via browser ao streaming da camera.Clicando-se na c√¢mera √© poss√≠vel capturar o endere√ßo direto de seu stream, que pode ser usado no Home Assistant ou em qualquer outro software compat√≠vel.Video2TelegramRequisitosinotify==0.2.10pyTelegramBotAPI==4.11.0Arquivo Pythonimport inotify.adaptersimport osimport telebotTOKEN = &lt;TOKEN DO BOT&gt;FOLDER = &lt;PASTA A SER MONITORADA&gt;EXTENSION = &lt;EXTENS√ÉO DO ARQUIVO&gt;DESTINATION = &lt;ID DE DESTINO&gt;bot = telegram.Bot(TOKEN)notifier = inotify.adapters.InotifyTree(FOLDER)for event in notifier.event_gen(): if event is not None: if 'IN_CLOSE_WRITE' in event[1] and EXTENSION in event[3]: file_path = event[2] + '/' + event[3] file_open = open(file_path, 'rb') try: bot.send_chat_action(DESTINATION, 'upload_video') bot.send_animation(DESTINATION, file_open) except: bot.send_chat_action(DESTINATION, 'upload_document') bot.send_document(DESTINATION, file_open) os.remove(file_path)Vari√°veis TOKEN: Token do bot3; FOLDER: Pasta a ser monitorada. Valor padr√£o: /var/lib/motion; EXTENSION: Extens√£o de arquivo a ser enviada. Recomendado: mp4 DESTINATION: Destino da mensagem no Telegram4.Envio de gif ou Envio de documentoO c√≥digo, como mostrado acima, primeiro tenta enviar um gif e, caso falhe, tenta enviar o documento. Isto √©, primeiro h√° a tentativa de convers√£o do v√≠deo em gif e, caso ocorra uma falha, o arquivo √© enviado sem altera√ß√£o. Caso prefira o envio sem convers√£o alguma, remova as linhas 17, 18, 19 e 20, ou seja, remova do c√≥digo o trecho que cont√©m: try: bot.send_chat_action(DESTINATION, 'upload_video') bot.send_animation(DESTINATION, file_open) except:Ajuste a identa√ß√£o, alinhando as duas linhas iniciadas com bot. √† linha iniciada com file_open.A √∫ltima linha, os.remove(file_path), remove o arquivo ap√≥s o envio, evitando que o disco do computador fique cheio.Por fim, execute o script python5.C√¢merasAs c√¢meras que podem ser usadas com esta solu√ß√£o s√£o as c√¢meras que funcionam como webcam, c√¢meras comuns, geralmente que se conectam via porta USB. Para testes foram usadas tr√™s: Logitech C920; Logitech C120; Camera V2 para Raspberry Pi.Todas com resultados satisfat√≥rios, variando apenas a qualidade da imagem de uma c√¢mera para a outra. https://www.raspberrypi.com/documentation/computers/configuration.html#connect-to-a-wireless-network.¬†&#8617; Recomendo o uso do codec mp4 por ser um formato que funciona bem com o Telegram. Al√©m disso, caso o v√≠deo n√£o tenha som, o Telegram automaticamente transforma o mp4 em gif.¬†&#8617; Como fazer bots para o Telegram.¬†&#8617; Como obter IDs no Telegram.¬†&#8617; Como manter um processo rodando para sempre.¬†&#8617; " }, { "title": "N√£o perturbe. Em reuni√£o.", "url": "/posts/DoNotDisturb/", "categories": "Automa√ß√£o Residencial, MQTT", "tags": "automa√ß√£o, mqtt, python, hass, homeassistant", "date": "2023-11-21 18:30:00 -0300", "snippet": " ‚ÄúEstou em reuni√£o. Falo com voc√™ em seguida‚Äù.Este pequeno script Python monitora o estado de sua webcam e informa, em tempo real, se ela est√° sendo usada. Por meio de um t√≥pico MQTT, todos os dis...", "content": " ‚ÄúEstou em reuni√£o. Falo com voc√™ em seguida‚Äù.Este pequeno script Python monitora o estado de sua webcam e informa, em tempo real, se ela est√° sendo usada. Por meio de um t√≥pico MQTT, todos os dispositivos da rede podem consultar o uso da c√¢mera, podendo iniciar, por exemplo, uma automa√ß√£o que acende uma luz. Solu√ß√£o important√≠ssima para os profissionais que atuam remotamente e, em muitos casos, n√£o podem ser incomodados.Apesar de ser escrito em Python, a solu√ß√£o aborda alguns comandos e conceitos do Linux, tais como:lsmodLista os m√≥dulos do kernel1 que est√£o carregados na mem√≥ria. Ao ser executado, sua sa√≠da ser√° parecida com:$ lsmodModule Size Used bynfnetlink 20480 0hidp 40960 1tls 151552 4nvidia_uvm 1802240 8uvcvideo 135168 0Repare que a primeira coluna cont√©m o nome do m√≥dulo e a √∫ltima cont√©m os m√≥dulos que est√£o utilizando o recurso.uvcvideoUSB Video Class - Classe de v√≠deo USB. √â o m√≥dulo que descreve dispositivos de v√≠deo, como webcams. Ou seja, ao ser executado o comando lsmod, √© poss√≠vel ver quais processos est√£o utilizando o recurso de v√≠deo.Webcam desligada$ lsmod | grep uvcvideouvcvideo 135168 0Webcam em uso$ lsmod | grep uvcvideouvcvideo 135168 1WebcamStatus2MQTTScript PythonO √∫nico requisito deste script √© o pacote Paho-MQTT, que pode ser instalado usando-se pip install paho-mqttimport paho.mqtt.client as mqttimport osimport subprocessMQTTSERVER = '' # Servidor MQTT, tamb√©m chamado de brokerMQTTUSER = '' # Usu√°rio MQTTMQTTPASS = '' # Senha do usu√°rio MQTTMQTTTOPIC = 'Webcam' # T√≥pico a ser usadoCLIENTID = 'WebcamStatus' # Identificador √∫nico do cliente MQTTdef run_lsmod(): # Fun√ß√£o que lista os m√≥dulos do kernel lsmod = subprocess.run(['lsmod'], capture_output=True, text=True) lines = lsmod.stdout.splitlines() for line in lines: if 'uvcvideo' in line: return linedef post_mqtt(value): # Fun√ß√£o que faz a publica√ß√£o no t√≥pico MQTT mqttclient = mqtt.Client(client_id=CLIENTID) mqttclient.username_pw_set(MQTTUSER, password=MQTTPASS) mqttclient.connect(MQTTSERVER) mqttclient.publish(f'{MQTTTOPIC}/state', value)if __name__ == \"__main__\": status = run_lsmod() post_mqtt(status.split()[-1]) run_lsmod: Fun√ß√£o que executa o comando lsmod e captura seu resultado. Em seguida, busca pela string ‚Äúuvcvideo‚Äù e retorna a primeira linha em que ela √© encontrada; post_mqtt: Recebe o √∫ltimo d√≠gito do resultado da fun√ß√£o lsmod e o publica em um t√≥pico do broker MQTT.CronjobO arquivo Python √© executado minuto a minuto por meio de um cronjob2 na m√°quina em que ocorrem as reuni√µes.* * * * * cd /home/gabriel/WebcamStatus2MQTT; /usr/bin/python3 WebcamStatus2MQTT.pyHome AssistantSensorPara receber os dados via MQTT, abra o arquivo configuration.yaml e adicione:mqtt: sensor: - name: StatusWebcam state_topic: \"Webcam/state\" value_template: \"{{ float(value) }}\" unique_id: \"mqtt_sensor_webcam\"Por fim, para controlar um dispositivo ligando-o ou desligando-o, conforme o estado da webcam, s√£o criadas duas automa√ß√µes:Automa√ß√£o Webcam em funcionamentoalias: Webcam Ligadadescription: \"\"trigger: - platform: state entity_id: - sensor.statuswebcam from: \"0.0\" to: \"1.0\"condition: []action: - service: switch.turn_on data: {} target: entity_id: - switch.sonoff_100000000mode: singleIsto √©, se o valor de sensor.statuswebcam variar de 0.0 para 1.0, ent√£o o dispositivo switch.sonoff_100000000 √© ligado, acendendo uma l√¢mpada.Automa√ß√£o Webcam desligadaalias: Webcam Desligadadescription: \"\"trigger: - platform: state entity_id: - sensor.statuswebcam from: \"1.0\" to: \"0.0\"condition: []action: - service: switch.turn_off data: {} target: entity_id: - switch.sonoff_100000000mode: singleOu seja, quando o valor de sensor.statuswebcam sair de 1.0 para 0.0, quando a c√¢mera √© desligada, a luz controlada pelo switch.sonoff_100000000 √© desligada.Template de SensorUm template no Home Assistant permite criar entidades com base em outros valores. No exemplo abaixo √© criado um sensor que varia o √≠cone, o estado e o nome com base no sensor.statuswebcam.template: - sensor: - unique_id: template_sensor_em_reuniao icon: &gt; {% if states('sensor.statuswebcam')|float == 0 %} mdi:account {% elif states('sensor.statuswebcam')|float == 1 %} mdi:account-group {% endif %} state: &gt; {% if states('sensor.statuswebcam')|float == 0 %} off {% elif states('sensor.statuswebcam')|float == 1 %} on {% endif %} name: &gt; {% if states('sensor.statuswebcam')|float == 0 %} Dispon√≠vel {% elif states('sensor.statuswebcam')|float == 1 %} Em reuni√£o {% endif %} unique_id: Id √∫nico da entidade que est√° sendo criada; icon: Ajustes de √≠cone; state: Ajustes de estado; name: Ajustes de nome.Todos os ajustes baseiam-se nos mesmos casos: Se o sensor.statuswebcam for igual a 0, ent√£o a webcam est√° desligada e, portanto, n√£o h√° reuni√£o; Caso o valor do sensor.statuswebcam seja igual a 1, ent√£o uma reuni√£o est√° acontecendo.Exemplo de sensor criado por template. Sem reuni√£o (acima) e com reuni√£o acontecendo. √â, basicamente, a parte do sistema operacional respons√°vel pela comunica√ß√£o entre o software e o hardware dos computadores.¬†&#8617; Uma tarefa executada periodicamente, seguindo um cronograma.¬†&#8617; " }, { "title": "Como criar a Leitura R√°pida no Telegram", "url": "/posts/InstantView/", "categories": "Telegram, Curiosidades", "tags": "telegram, instantview, leiturar√°pida, leitura, telegraph", "date": "2023-10-22 12:00:00 -0300", "snippet": "Leitura R√°pidaO Telegram oferece uma poderosa ferramenta de visualizar conte√∫do chamada Leitura R√°pida. O conte√∫do visto desta forma √© rapidamente carregado e ret√©m o usu√°rio no aplicativo, mantend...", "content": "Leitura R√°pidaO Telegram oferece uma poderosa ferramenta de visualizar conte√∫do chamada Leitura R√°pida. O conte√∫do visto desta forma √© rapidamente carregado e ret√©m o usu√°rio no aplicativo, mantendo a pessoa engajada em seu canal ou grupo. Al√©m disso, o acesso n√£o sobrecarrega seu servidor, tudo fica hospedado no pr√≥prio Telegram. √â uma forma gr√°tis de ter muita gente lendo o seu conte√∫do simultaneamente.Por√©m, alguns pontos podem n√£o agradar a todos.N√£o exibe an√∫nciosO conte√∫do exibido em leitura r√°pida n√£o exibe an√∫ncios, ou seja, tem o potencial de afetar a renda do produtor de conte√∫do.Visita n√£o conta em AnalyticsCaso o produtor de conte√∫do utilize alguma ferramenta de Analytics, as leituras feitas pela Leitura R√°pida n√£o ser√£o contabilizadas como visitas uma vez que o site em si n√£o recebe visita alguma.Falta de concursosO Telegram n√£o realiza concursos de templates de Leitura R√°pida desde 2019. A consequ√™ncia disso √© que n√£o √© mais poss√≠vel criar um template p√∫blico para um site, que funcione automaticamente ao compartilhar um link. A leitura r√°pida de novos sites somente √© poss√≠vel com solu√ß√µes personalizadas, logo, se o link for compartilhado sem os devidos ajustes, a op√ß√£o de leitura r√°pida n√£o ser√° exibida.Guia R√°pidoExplico abaixo duas maneiras de criar a Leitura R√°pida de qualquer conte√∫do. A primeira permite maiores ajustes, por√©m, funciona exclusivamente em sites. J√° a segunda, usando a api do Telegraph, permite a cria√ß√£o da Leitura R√°pida de absolutamente qualquer conte√∫do, mesmo que um site n√£o exista.Leitura R√°pida usando TemplatesAcesse o site instantview.telegram.org e autentique-se.Clique em My Templates e cole a URL no campo que deseja criar o template. Tela de cria√ß√£o de template de Leitura R√°pida.A tela de cria√ß√£o de um template √© dividida em tr√™s janelas. A primeira √© o site original, a do meio cont√©m as regras de cria√ß√£o e a terceira traz a pr√©-visualiza√ß√£o da Leitura R√°pida.Formato das regras title (obrigat√≥rio): T√≠tulo da postagem; body (obrigat√≥rio): Corpo da postagem; subtitle: Subt√≠tulo; kicker: Primeira linha do template; author: Autor(a); author_url: Link do autor(a); published_date: Data da publica√ß√£o em formado Unix; description: Descri√ß√£o curta exibida na pr√©-visualiza√ß√£o; image_url: Link da imagem exibida na pr√©-visualiza√ß√£o; document_url: Link do documento exibido na pr√©-visualiza√ß√£o; site_name: Nome do site exibido na pr√©-visualiza√ß√£o; channel: Canal do autor no formato @canal; cover: Capa da p√°gina (imagem, v√≠deo, mapa).Exemplo de regra~version: \"2.1\"title: $body//h1[1]body: //*[contains(@class, \"post-content\")]cover: //img[has-class(\"lazyloaded\")]@set_attr(\"src\", @data-src): $body//img[@data-src]channel: \"@GabRF\"site_name: \"blog.GabRF.com\"@split_parent: //a/img@split_parent: //p/img O t√≠tulo ser√° o conte√∫do do primeiro cabe√ßalho do tipo h1; O corpo ser√° o conte√∫do da classe post-content; A capa ser√° a imagem de classe lazyloaded; No corpo o par√¢metro src (usado em imagens) ser√° preenchido com o valor da tag data-src; Canal exibido no topo, ao lado do bot√£o Join; Nome do site exibido na pr√©-visualiza√ß√£o; Duas regras que tratam erros do tipo Element &lt;img&gt; is not supported in &lt;a&gt;1.Salvar e UtilizarAp√≥s criar a regra do template, clique em Mark as Checked para o Telegram salvar as mudan√ßas. Feito isto, clique em View in Telegram e compartilhe em suas Mensagens Salvas. A inten√ß√£o neste passo √© simplesmente o de copiar o link para obter o identificador de template.O link gerado ter√° o seguinte formato: https://t.me/iv?url=&lt;URL_DO_POST&gt;%2F&amp;rhash=&lt;IDENTIFICADOR_DO_TEMPLATE&gt;, composto por: URL_DO_POST: Link direto para o conte√∫do daquele dom√≠nio (em formato de URL); IDENTIFICADOR_DO_TEMPLATE: Valor fixo correspondente ao template criado.No exemplo, o link gerado foi o https://t.me/iv?url=https%3A%2F%2Fblog.gabrf.com%2Fposts%2FFimDoRastreioBot%2F&amp;rhash=36c1a8c5edccc1. Repita o teste em outros links do mesmo site para confirmar se o template realmente est√° bom. O ideal √© testar ao menos 10 links diferentes. √â importante saber que o identificador de template √© fixo. Ou seja, √© poss√≠vel atualizar as regras a qualquer momento e isto ir√° afetar a Leitura R√°pida de todo aquele site, tanto as futuras quanto as j√° enviadas. O valor de identificador √© √∫nico, vinculado √† sua conta do Telegram. Logo, se duas ou mais pessoas criarem regras para o mesmo site, cada pessoa ter√° o seu identificador.Exemplo de fun√ß√£o em pythonimport urllib # pip install urllibrhash = '36c1a8c5edccc1' # Identificador do Templatedef get_iv_link(link): iv_link = f'https://t.me/iv?url={urllib.parse.quote_plus(link)}&amp;rhash={rhash}' return iv_linkEsta fun√ß√£o recebe a string https://blog.gabrf.com/posts/FimDoRastreioBot/ e retorna o link com Leitura R√°pida: https://t.me/iv?url=https%3A%2F%2Fblog.gabrf.com%2Fposts%2FFimDoRastreioBot%2F&amp;rhash=36c1a8c5edccc1.Leitura R√°pida via API TelegraphO Telegram possui uma plataforma de publica√ß√£o de textos chamada Telegraph, que pode ser usada diretamente pelo site ou via API p√∫blica. Todo texto criado na plataforma automaticamente tem o recurso de Leitura R√°pida habilitado, podendo, portanto, ser uma solu√ß√£o para quem n√£o possui um site ou possui alguma dificuldade em utilizar templates, como explicado anteriormente2.Autentica√ß√£oO primeiro passo √© criar a sua chave de acesso. Para isto, acesse a url abaixo substituindo os valores &lt;NOME_CURTO&gt; e &lt;NOME&gt; pelo que julgar adequado:https://api.telegra.ph/createAccount?short_name=&lt;NOME_CURTO&gt;&amp;author_name=&lt;NOME&gt;O resultado dever√° ser parecido com este:{ \"ok\":true, \"result\":{ \"short_name\":\"Sandbox\", \"author_name\":\"Anonymous\", \"author_url\":\"\", \"access_token\":\"d3b25feccb89e508a9114afb82aa421fe2a9712b963b387cc5ad71e58722\", \"auth_url\":\"https:\\/\\/edit.telegra.ph\\/auth\\/d3b25feccb89e508a9114afb82aa421fe2a9712b963b387cc5ad71e58722\" }}O valor de access_token √© o que ser√° usado daqui em diante em uma vari√°vel de mesmo nome. Este valor n√£o deve ser compartilhado com ningu√©m. Deve ser guardado como uma senha.Instala√ß√£o da biblioteca em PythonInstale a biblioteca conforme o seu cen√°rio de configura√ß√£o. O m√©todo mais simples seria usando pip install.$ python3 -m pip install telegraph# Alternativamente, op√ß√£o ass√≠ncrona$ python3 -m pip install 'telegraph[aio]'Exemplo de uso da biblioteca em Pythonimport telegraphdef create_telegraph_post(titulo, imagem, subtitulo, texto, link, autor): telegraph_auth = telegraph.Telegraph( access_token=access_token ) response = telegraph_auth.create_page( f'{titulo}', html_content=( f'&lt;img src=\"{imagem}\"&gt;' + f'&lt;h4&gt;{subtitulo}&lt;/h4&gt;&lt;br&gt;&lt;br&gt;' + f'{texto}&lt;br&gt;&lt;br&gt;' + f'&lt;a href=\"{link}\"&gt;Leia a mat√©ria original&lt;/a&gt;' ), author_name=f'{autor}' ) return dataA fun√ß√£o create_telegraph_post recebe como par√¢metros o t√≠tulo, a imagem, um subt√≠tulo, o texto completo, o link para o site e o nome do autor respectivamente. A resposta ser√°:{ 'path': 'T√≠tulo-10-22-5', 'url': 'https://telegra.ph/T√≠tulo-10-22-5', 'title': 'T√≠tulo', 'description': '', 'author_name': 'Autor', 'views': 0, 'can_edit': True}Pronto. Agora basta compartilhar o link presente em url e a fun√ß√£o de Leitura R√°pida ir√° aparecer.Link do Telegraph com Leitura R√°pida.Exemplo de texto visto em modo de Leitura R√°pida.Envio de imagens para o Telegraph Explica√ß√£o b√¥nus, m√©todo n√£o oficial!H√° casos em que a exibi√ß√£o de imagem n√£o funciona, pois o site que hospeda a imagem pode colocar algumas prote√ß√µes que a impe√ßam de serem compartilhadas em sites terceiros. A solu√ß√£o para tal caso seria o de enviar a imagem para o Telegraph, por√©m, este m√©todo n√£o est√° oficialmente na API. Use-o sabendo que √© uma gambiarra!import ioimport requestsimport telegraphdef upload_telegraph_image(image): telegraph_auth = telegraph.Telegraph( access_token=access_token ) file = requests.get(image) inmemoryfile = io.BytesIO(file.content) path = telegraph_auth.upload_file(inmemoryfile) return f'https://telegra.ph{path[0][\"src\"]}'A fun√ß√£o upload_telegraph_image far√° o upload da imagem contida na URL para o Telegragh, criando um novo endere√ßo para visualiza√ß√£o, exemplo:if __name__ == \"__main__\": data = upload_telegraph_image('https://instantview.telegram.org/file/811140067/3/6oS3A6aSzxU.261217/1d6f75b81ed67c983a') print(data)Cuja resposta ser√°:https://telegra.ph/file/2abe611003a6c9aa2f5f4.pngQue √© a imagem oficial do Telegram usando no exemplo acima. Erro muito comum. Acontece quando elementos est√£o aninhados e n√£o s√£o suportados pela Leitura R√°pida. A regra split_parent retira esse aninhamento, resolvendo o problema. Leia mais no site oficial.¬†&#8617; H√° casos, por exemplo, em que um site n√£o pode ser acessado de determinados pa√≠ses, impedindo a solu√ß√£o que usa templates de funcionar. Usando a op√ß√£o via Telegraph √© poss√≠vel capturar os dados do site em seu pr√≥prio computador, evitando assim o problema de bloqueio por geo-localiza√ß√£o.¬†&#8617; " }, { "title": "RastreioBot - Encerramento", "url": "/posts/FimDoRastreioBot/", "categories": "Telegram, Bot", "tags": "telegram, bot, rastreiobot", "date": "2023-09-21 11:00:00 -0300", "snippet": "Ap√≥s mais de 2 milh√µes de pacotes rastreados, chegou a hora de desligar o RastreioBot.O bot foi criado da necessidade de receber os alertas de meus pacotes de maneira organizada e √°gil, no celular ...", "content": "Ap√≥s mais de 2 milh√µes de pacotes rastreados, chegou a hora de desligar o RastreioBot.O bot foi criado da necessidade de receber os alertas de meus pacotes de maneira organizada e √°gil, no celular e no computador de uma √∫nica vez, sem duplicar os avisos. Come√ßou como um projeto de necessidade particular e virou um dos bots mais queridinhos do Telegram. Me rendeu viagem, amigos, experi√™ncias e muito, muito aprendizado.At√© 2018, A Empresa Brasileira de Correios e Tel√©grafos (ECT/Correios) n√£o tinha um aplicativo de celular. Mesmo quando lan√ßou seu app, era lento e n√£o era agrad√°vel de usar. J√° o bot era √°gil, permitia descrever os pacotes e sempre notificava antes do app oficial.Nunca foi disponibilizada (pela ECT) uma maneira de notificar as pessoas ou at√© mesmo os aplicativos que houve uma movimenta√ß√£o de um pacote. O funcionamento sempre foi baseado em enviar uma pergunta e ser respondido pelo servidor, um processo chamado de polling. No auge, o RastreioBot era capaz de verificar aproximadamente 25.000 pacotes em apenas tr√™s minutos. O ciclo de verifica√ß√£o era repetido in√∫meras vezes por dia, notificando as pessoas com um atraso m√≠nimo de poucos minutos.Esta solu√ß√£o, sem d√∫vida alguma, estava longe de ser a ideal. Com certeza gerava uma carga enorme aos servidores da empresa. Eram in√∫meros aplicativos, bots e outros servi√ßos enviando milhares de solicita√ß√µes por minuto. O custo para manter isso no ar, respondendo a todos, n√£o tinha como ser baixo.Imagino que, com o objetivo de reduzir custos, a empresa decidiu barrar tais acessos. Revogou as chaves usadas e dificultou a obten√ß√£o de novas. Atualmente, para acessar o servi√ßo de rastreamento de pacotes, √© necess√°rio um CNPJ e um contrato Bronze com os Correios, al√©m de um Cart√£o de Postagem (fornecido pela empresa). Por fim, limitou a tr√™s acessos por segundo. Ou seja, al√©m da dificuldade t√©cnica, h√° tamb√©m a burocracia. Ficou complicado e lento demais.O bot √© um hobby. Nunca acertei uma maneira de monetiz√°-lo a ponto de virar um trabalho. Nunca faturou o suficiente para justificar a abertura de um CNPJ. Al√©m disso, um CNPJ n√£o garante a aprova√ß√£o dos Correios para o fornecimento das credenciais necess√°rias para o funcionamento.Pessoas vieram me oferecer acessos alternativos, n√£o oficiais. Agrade√ßo a inten√ß√£o de todas elas em ajudar, mas educadamente recusei cada uma das propostas. Acho complicado entregar os dados de milhares de pessoas para um intermedi√°rio, principalmente quando as pessoas n√£o concordaram com isso. N√£o sei tamb√©m at√© quando um intermedi√°rio conseguiria funcionar ou at√© quando manteria meu acesso gr√°tis. Acredito que seria empurrar o problema com a barriga.Portanto, com tristeza, encerro o bot.Ele seguir√° respondendo as pessoas com o link para este texto e seguir√° tendo o c√≥digo publicado no GitHub. Sigo aberto √† possibilidade de voltar o bot, desde que seja usando a solu√ß√£o oficial.Agrade√ßo aos amigos e aos desconhecidos por tudo. Foi muito divertido e proveitoso.A quem doou seu tempo e seu conhecimento, a quem me ajudou com c√≥digo, a quem ajudou com doa√ß√µes e tamb√©m quem ajudou com conversas, com dicas e tamb√©m fazendo cr√≠ticas:Muito obrigado.Links:Site: RastreioBot.xyzReposit√≥rio: github.com/GabrielRF/RastreioBotPerfil no Twitter: @RastreioBotEstat√≠sticas no Telegram: GabRF/RastreioBot" }, { "title": "Bot que cria legendas diretamente no Telegram", "url": "/posts/VideoCaptionsBot/", "categories": "Telegram, Bot", "tags": "telegram, bot, whisper, openai, captions, subtitles, chatgpt", "date": "2023-09-02 14:00:00 -0300", "snippet": "VideoCaptionsBotO VideoCaptionsBot foi criado com a mesma tecnologia das transcri√ß√µes autom√°ticas de mensagens de voz, usando a biblioteca OpenAI-Whisper. Ele recebe arquivos de v√≠deo ou mensagens ...", "content": "VideoCaptionsBotO VideoCaptionsBot foi criado com a mesma tecnologia das transcri√ß√µes autom√°ticas de mensagens de voz, usando a biblioteca OpenAI-Whisper. Ele recebe arquivos de v√≠deo ou mensagens de voz circulares (v√≠deo de bolinha) e cria, automaticamente, a legenda e, se necess√°rio, a tradu√ß√£o.Apesar da cria√ß√£o de legendas no idioma original do v√≠deo ser executada localmente, no servidor do bot, com a finalidade de evitar o mau uso do servi√ßo o texto √© submetido √† ferramenta de modera√ß√£o da OpenAI. Caso seja identificado conte√∫do n√£o permitido, o bot remover√° o arquivo da conversa e n√£o enviar√° o v√≠deo legendado ao usu√°rio.Usando o ChatGPT, tamb√©m da OpenAI, o bot √© capaz de traduzir as legendas originais para o idioma do usu√°rio. O VideoCaptionsBot considera o idioma ajustado no aplicativo Telegram como o idioma do usu√°rio, portanto, sempre que uma legenda for gerada em idioma diferente do aplicativo, o bot far√° o envio de dois v√≠deos, um com a legenda em idioma original e outro com a legenda no idioma do usu√°rio.Legenda em v√≠deo do Rodrigo Goes - Canal no YouTube.FuncionamentoO bot funciona em dois processos Python separados. O primeiro, videocaptionsbot.py tem a fun√ß√£o de receber os comandos /start, /termos, /pix e de receber os v√≠deos. As mensagens contendo os v√≠deos s√£o enviadas √† fila, uma inst√¢ncia do RabbitMQ, e atendidas uma a uma no processo seguinte.O arquivo consumeline.py verifica a exist√™ncia de mensagens na fila e as processa. Inicialmente cria um arquivo .srt com as legendas e o submete √† ferramenta de modera√ß√£o. Caso haja aprova√ß√£o, um novo v√≠deo contendo as legendas √© gerado. Por fim, o bot verifica se o idioma do app do usu√°rio √© o mesmo da legenda criada e, caso n√£o seja, solicita ao ChatGPT a tradu√ß√£o das legendas para que um segundo arquivo de v√≠deo seja gerado e enviado ao usu√°rio.C√≥digo FonteO VideoCaptionsBot possui c√≥digo aberto, dispon√≠vel no reposit√≥rio do GitHub de endere√ßo github.com/GabrielRF/VideoCaptionsBot.Toda e qualquer colabora√ß√£o √© bem vinda! Cr√≠ticas e sugest√µes podem ser feitas no pr√≥prio GitHub ou diretamente no Telegram. Grupo para conversarmos sobre o bot dispon√≠vel aqui." }, { "title": "Transcri√ß√£o autom√°tica de mensagens de voz no Telegram", "url": "/posts/WhisperPyrogram/", "categories": "Telegram, Automa√ß√£o", "tags": "telegram, automa√ß√£o, whisper, openai, pyrogram", "date": "2023-07-26 23:00:00 -0300", "snippet": "PyrogramEsta √© uma biblioteca Python que permite a comunica√ß√£o direta com os servidores do Telegram, por meio do protocolo MTProto. Funciona usando a chamada API do Telegram, diferente da API de Bo...", "content": "PyrogramEsta √© uma biblioteca Python que permite a comunica√ß√£o direta com os servidores do Telegram, por meio do protocolo MTProto. Funciona usando a chamada API do Telegram, diferente da API de Bots. Apesar de a Pyrogram tamb√©m servir para a cria√ß√£o de bots, n√£o √© poss√≠vel afirmar que √© vantajoso usar a API do Telegram em todos os casos, pois existem m√©todos exclusivos em cada uma das op√ß√µes. Este texto, por tratar de uma automa√ß√£o em conta de usu√°rio, tal API √© a √∫nica alternativa.Diferen√ßa entre a API de Bots e a API do Telegram. FonteCredenciaisPara gerar as credenciais necess√°rias para se comunicar aos servidores do Telegram, acesse https://my.telegram.org/apps. Digite seu telefone e clique em Next. Em seguida, digite o c√≥digo recebido via Telegram. Para que tudo funcione ser√£o necess√°rios os valores de App api_id e App api_hash. Estes dados s√£o confidenciais. Jamais os compartilhe.OpenAI WhisperA transcri√ß√£o de textos √© feita usando o modelo de reconhecimento de voz da OpenAI, chamado Whisper. √â um modelo gr√°tis e que funciona localmente, ou seja, n√£o exige comunica√ß√£o com nenhum servidor externo. Tudo acontece na sua m√°quina, resguardando sua privacidade.O Whisper possui cinco modelos de reconhecimento de voz, que devem ser usados de acordo com a disponibilidade de recursos computacionais do servidor. Leia mais no reposit√≥rio oficial. O presente script usa o modelo base, por√©m, se poss√≠vel, recomendo o uso do small para que as transcri√ß√µes sejam mais exatas.Voice2TextResposit√≥rio: https://github.com/GabrielRF/Voice2TextEste pequeno script usa as credenciais da conta do Telegram para transcrever todas as mensagens de voz que forem recebidas em conversas privadas. A transcri√ß√£o √© autom√°tica, n√£o exigindo nenhuma a√ß√£o para que aconte√ßa.RequisitosInstale os requisitos usando o comando pip install -r requirements.txt. Este passo √© um pouco demorado devido ao tamanho da openai-whisper.Caso queira instalar manualmente, os requisitos s√£o:openai-whisper==20230314TgCrypto==1.2.3Pyrogram==2.0.106ffmpeg-python==0.2.0Voice2Text.pyTranscri√ß√£o de √°udio em conversa privada.Ajustes os valores de api_id e api_hash nas linhas 7 e 8 do arquivo Voice2Text.py.from pyrogram import Client, filters, enumsimport asyncioimport timeimport osimport whisperapi_id = 123456789api_hash = \"1a2b3c4d5e6f7g8h9i0j\"app = Client(\"Voice2Text\", api_id=api_id, api_hash=api_hash)model = whisper.load_model(\"base\")Altere a linha 16 do arquivo caso queira utilizar um modelo diferente do base.Por fim, execute o script usando o comando:python Voice2Text.py Na primeira execu√ß√£o ser√° necess√°rio autenticar-se em sua conta do Telegram. Siga os passos e ser√° criado um arquivo .session. Para remover a sessƒÅo, remova este arquivo.Para manter o processo em execu√ß√£o, leia o post ‚ÄúComo manter um processo rodando para sempre‚Äù." }, { "title": "Contagem de tempo de uso de equipamentos usando Home Assistant", "url": "/posts/HassHistoryStats/", "categories": "Automa√ß√£o Residencial, Home Assistant", "tags": "hass, homeassistant, historystats, how-to, automa√ß√£o", "date": "2023-07-09 14:00:00 -0300", "snippet": "SensorA contagem de tempo no Home Assistant √© feita usando-se um sensor do tipo History Stats e de um Utility Meter, ambos definidos no arquivo configuration.yaml. O primeiro tem a fun√ß√£o de fazer ...", "content": "SensorA contagem de tempo no Home Assistant √© feita usando-se um sensor do tipo History Stats e de um Utility Meter, ambos definidos no arquivo configuration.yaml. O primeiro tem a fun√ß√£o de fazer a contagem enquanto o segundo √© respons√°vel pelo ac√∫mulo dos dados das medi√ß√µes.History StatsV√° at√© o arquivo configuration.yaml e crie um novo sensor, de plataforma history_stats, seguindo o exemplo:sensor: - platform: history_stats name: Tempo Roomba entity_id: vacuum.roomba type: time state: 'cleaning' start: '{{as_timestamp(now().replace(hour=0).replace(minute=0).replace(second=0))}}' end: '{{ now() }}' name: Nome que ser√° exibido na interface do Home Assistant; entity_id: Entidade a ser contada; type: Tipo do sensor; Op√ß√µes: time, ratio e count; state: Estado a ser contado; Exemplo: on, que seria o estado de ligado; start: Quando come√ßar a contagem; end: Quando encerrar a contagem.Normalmente √© necess√°rio personalizar apenas os valores dos campos name e entity_id. Para consultar a lista de entidades de seu Home Assistant, navegue at√© Configura√ß√µes. Em seguida, clique em Dispositivos &amp; Servi√ßos e em Registro de Entidades.Utility MeterAinda no configuration.yaml, crie os utility meter que julgar pertinente. Exemplos:utility_meter: tempo_roomba_diario: source: sensor.tempo_roomba cycle: daily tempo_roomba_semanal: source: sensor.tempo_roomba cron: 0 0 * * 0 tempo_roomba_mensal: source: sensor.tempo_roomba cycle: monthlyA estrutura normalmente √© um nome seguido de duas op√ß√µes: source: Origem do dado, sensor. seguido do nome do sensor criado em history_stats Sempre em letras min√∫sculas e com os espa√ßos substitu√≠dos por _; cycle: Per√≠odo de validade da contagem; Op√ß√µes: quarter-hourly, hourly, daily, weekly, monthly, bimonthly, quarterly e yearly. Por padr√£o, as medi√ß√µes no Home Assistant s√£o iniciadas em 0 minutos, 0 horas, segunda-feira, dia 1 e em Janeiro. Ou seja, no caso do contador semanal, a semana come√ßa na segunda-feira. Para que a contagem semanal inicie-se no domingo √© usada uma regra de cron, descrita abaixo: cron: 0 0 * * 0: 0 minutos, 0 horas, todos os dias, todos os meses, aos domingos.TemplateFinalmente, para se ter √≠cones alterados conforme o tempo de uso ou outra condi√ß√£o, usa-se o Template. Tal personaliza√ß√£o permite a consulta r√°pida de acontecimentos diretamente na interface. Abaixo, um exemplo para saber se o aspirador de p√≥ j√° passou hoje ou n√£o.Tela de resumo do rob√¥ aspirador de p√≥.No configuration.yaml √© definido:template: - sensor: - name: \"Roomba limpou hoje\" state: &gt; {{ states('sensor.tempo_roomba_diario') }} icon: &gt; {% if states('binary_sensor.roomba_bin_full') == \"on\" %} mdi:robot-dead-outline {% elif states('sensor.tempo_roomba_diario')|float &gt; 0 %} mdi:robot-happy-outline {% else %} mdi:robot-angry-outline {% endif %} name: Nome da nova entidade cujo √≠cone ir√° variar de acordo com as regras; state: Define um modelo para obter o estado do sensor; icon: Define o √≠cone;No exemplo, as regras de √≠cone s√£o: Se o estado de binary_sensor.roomba_bin_full √© ligado, ou seja, lixeira cheia, ent√£o o √≠cone √© definido como mdi:robot-dead-outline; Se o estado de sensor.tempo_roomba_diario for maior que zero, isto √©, limpeza de hoje j√° iniciada, ent√£o mdi:robot-happy-outline; Caso contr√°rio, mdi:robot-angry-outline" }, { "title": "Como manter um processo rodando para sempre", "url": "/posts/Systemctl/", "categories": "Linux, Comandos", "tags": "linux, comandos, systemctl, systemd, bots, rotina", "date": "2023-06-10 18:30:00 -0300", "snippet": " Bots n√£o dormem. Bots n√£o d√£o problema. Mas se algo acontecer, que reiniciem automaticamente. üòÇSystemctlO comando systemctl √© o gerenciador do systemd, que gerencia o Linux. √â uma ferramenta esse...", "content": " Bots n√£o dormem. Bots n√£o d√£o problema. Mas se algo acontecer, que reiniciem automaticamente. üòÇSystemctlO comando systemctl √© o gerenciador do systemd, que gerencia o Linux. √â uma ferramenta essencial para administra√ß√£o de servidores Linux e permite total controle sobre os servi√ßos em execu√ß√£o no sistema. O systemctl pode ser usado para controlar um servi√ßo pelos comandos status, start, stop e restart.Um servi√ßo do sistema operacional pode ser usado para manter bots no ar ou para qualquer outra coisa que seja executada sempre ou em intervalos bem definidos. O RastreioBot, por exemplo, possui dois servi√ßos.1. O bot que fala com as pessoasExiste um servi√ßo principal que √© respons√°vel por responder as pessoas, coletar os c√≥digos de pacotes enviados e tamb√©m responder a comandos, como /start, /gif etc. Este servi√ßo n√£o procura por atualiza√ß√µes nos pacotes. Ele apenas consulta o banco de dados. N√£o h√° qualquer consulta ao sistema dos Correios neste servi√ßo.2. A rotina que verifica os pacotesO segundo servi√ßo √© a rotina que verifica os pacotes, que faz a comunica√ß√£o com os Correios. Esta rotina √© executada usando-se um servi√ßo do sistema operacional e √© executada em intervalos definidos. Isto √©, espera-se o tempo escolhido(RestartSec) antes de executar a rotina novamente. A vantagem desta abordagem em rela√ß√£o ao uso de um cronjob √© que evita que uma rotina seja iniciada em paralelo √† anterior caso ela n√£o tenha terminado. Ou seja, n√£o importa a dura√ß√£o de tempo para que o arquivo python seja executado. O tempo entre as rotinas √© sempre o mesmo e n√£o h√° execu√ß√µes em paralelo.Criar um servi√ßoCrie um arquivo chamado &lt;nome do servi√ßo&gt;.service na pasta /lib/systemd/system com o conte√∫do abaixo:# cd /lib/systemd/system# nano &lt;nome do servi√ßo&gt;.service[Unit]Description=&lt;DESCRI√á√ÉO&gt;After=multi-user.target[Service]Type=simpleWorkingDirectory=&lt;DIRET√ìRIO&gt;ExecStart=&lt;COMANDO&gt;Restart=alwaysRestartSec=&lt;INTERVALO&gt;[Install]WantedBy=multi-user.targetDefina os valores conforme sua prefer√™ncia. Description: Descri√ß√£o do servi√ßo; After: Em que momento o servi√ßo ser√° iniciado; Type: Tipo de servi√ßo; WorkingDirectory: Diret√≥rio do servi√ßo; ExecStart: Comando para iniciar o servi√ßo; Restart: Quando reiniciar o servi√ßo; RestartSec: Tempo de espera em segundos entre as tentativas de reiniciar o servi√ßo; WantedBy: Determina em quais condi√ß√µes o servi√ßo ser√° iniciado caso habilitado para in√≠ciar automaticamente.Exemplo de arquivo preenchido:[Unit]Description=RastreioBotAfter=multi-user.target[Service]Type=simpleWorkingDirectory=/usr/local/bin/RastreioBotExecStart=/usr/bin/python3 /usr/local/bin/RastreioBot/rastreiobot.pyRestart=alwaysRestartSec=10[Install]WantedBy=multi-user.targetServi√ßo de nome RastreioBot, localizado na pasta /usr/local/bin/RastreioBot/, e que deve ser reiniciado em 10 segundos caso pare por algum motivo.Carregar altera√ß√µesReinicie o servi√ßo do systemd sempre que um arquivo .service for alterado.# systemctl daemon-reloadHabilitar in√≠cio autom√°tico√â necess√°rio habilitar um servi√ßo para que ele seja iniciado junto do sistema operacional. Ou seja, para que o servi√ßo seja iniciado caso o servidor seja reiniciado.# systemctl enable &lt;nome do servi√ßo&gt;.serviceIniciar servi√ßo# systemctl start &lt;nome do servi√ßo&gt;.serviceParar um servi√ßo# systemctl stop &lt;nome do servi√ßo&gt;.serviceReiniciar um servi√ßo# systemctl restart &lt;nome do servi√ßo&gt;.serviceVerificar o status# systemctl status &lt;nome do servi√ßo&gt;.serviceVerificar logs# journalctl -u &lt;nome do servi√ßo&gt;.service" }, { "title": "Bot do Telegram para controlar seu Home Assistant", "url": "/posts/HassTelegramBot/", "categories": "Automa√ß√£o Residencial, Home Assistant", "tags": "telegram, bot, homeassistant, hass, assist", "date": "2023-05-27 20:30:00 -0300", "snippet": " Conceitos necess√°rios: Como obter IDs no Telegram Como fazer bots para o Telegram. Introdu√ß√£o ao Home Assistant.Introdu√ß√£oTer um bot vinculado ao seu Home Assistant pode ser bastante √∫til. Eis...", "content": " Conceitos necess√°rios: Como obter IDs no Telegram Como fazer bots para o Telegram. Introdu√ß√£o ao Home Assistant.Introdu√ß√£oTer um bot vinculado ao seu Home Assistant pode ser bastante √∫til. Eis alguns casos: F√°cil gest√£o de usu√°rios fora do Home AssistantO bot pode ser habilitado para aceitar comandos de um grupo do Telegram. Desta forma, a gest√£o de quem pode ligar ou desligar as luzes, por exemplo, passa a ser a simples gest√£o de quem est√° ou n√£o no grupo. Controle mesmo quando o Home Assistant n√£o √© acess√≠vel pela internetCaso o Home Assistant n√£o esteja exposto na internet, o controle pode ser feito via bot. Ou seja, mesmo que haja um firewall de operadora bloqueando o acesso ao seu Home Assistant, sua resid√™ncia pode ser gerida pelo Telegram em uma conversa. N√£o √© necess√°rio configurar redirecionamento de portas nem lidar com certificados https. Tudo funciona de maneira simples.Configuration.yamlA configura√ß√£o inicial do bot deve ser feita no arquivo configuration.yaml, como no exemplo abaixo:telegram_bot: - platform: polling api_key: 158700146:AAHOPReqqTR8V7FXysa8mJCbQACUWSTBog8 parse_mode: html allowed_chat_ids: - 9083329 # Gabriel - 172293282 # Bia platform: Maneira que o bot ir√° receber as mensagens do Telegram. As op√ß√µes s√£o polling ou webhook; api_key: Token do seu bot; parse_mode: Tipo de formata√ß√£o que seu bot usar√°. As op√ß√µes s√£o html ou markdown; allowed_chat_ids: Lista de IDs que podem usar o bot. Podem ser IDs de pessoas ou de grupos. De agora em diante, todas as configura√ß√µes do bot no Home Assistant ser√£o feitas nas Automa√ß√µes. Abra o Home Assistant e, no menu esquerdo, clique em Configura√ß√µes e em Automa√ß√µes &amp; Cenas.Comando /startUm bot sempre √© iniciado pelo comando /start. Por este motivo, recomendo que este comando esteja presente na configura√ß√£o, retornando uma mensagem de in√≠cio, uma introdu√ß√£o ao bot. Al√©m de servir como primeiro contato, o comando /start pode ser uma maneira f√°cil de verificar se o bot est√° funcionando.Clique em Criar automa√ß√£o, Criar nova automa√ß√£o. No canto superior direito, clique nos tr√™s pontinhos e, em seguida, em Editar como YAML.Copie e cole o c√≥digo:alias: Telegram Comando startdescription: \"\"trigger: - platform: event event_type: telegram_command event_data: command: /startcondition: []action: - service: telegram_bot.send_message data: message: | &lt;b&gt;Home Assistant bot&lt;/b&gt; ‚ÜôÔ∏è Clique em &lt;i&gt;Menu&lt;/i&gt; para ver os comandos. target: {{ trigger.event.data.chat_id }}mode: single alias: Nome da automa√ß√£o; description: Descri√ß√£o; trigger: Gatilho, o que faz a automa√ß√£o iniciar; platform: Tipo de plataforma do gatilho; event_type: Tipo de evento; event_data: Dado do evento; command: Comando; condition: Condi√ß√£o, o que impede ou n√£o a automa√ß√£o; Nenhuma condi√ß√£o definida; action: A√ß√£o, o que a automa√ß√£o de fato faz; service: Tipo de servi√ßo; data: Dados usados na a√ß√£o; message: Mensagem enviada. | √© usado para casos de m√∫ltiplas linhas; target: Destinat√°rio da mensagem. O valor {{ trigger.event.data.chat_id }} faz responder no mesmo chat em que o comando foi enviado; mode: Modo de execu√ß√£o. Ou seja, se a automa√ß√£o pode ser executada em m√∫ltiplas tarefas ou n√£o.Pronto! Seu bot j√° deve estar respondendo ao comando /start. Para criar mais comandos, duplique esta automa√ß√£o fazendo o ajuste que julgar necess√°rio.Comando /start.Comando /luzes e exibi√ß√£o de bot√µesOutro exemplo de comando que pode ser criado √© o que exibe e permite controlar algumas luzes usando bot√µes.alias: Telegram Comando Luzesdescription: \"\"trigger: - platform: event event_type: telegram_command event_data: command: /luzescondition: []action: - service: telegram_bot.send_message data: message: &lt;b&gt;Controle das Luzes&lt;/b&gt; target: \"{{ trigger.event.data.chat_id }}\" inline_keyboard: - - - &gt;- Quarto teto {{ states.switch.sonoff_1000000000.state|replace(\"on\", \"üí°\")|replace(\"off\", \"‚ö´Ô∏è\") }} - sonoff_1000000000 - - - &gt;- Esquerda {{ states.switch.sonoff_2000000000.state|replace(\"on\", \"üí°\")|replace(\"off\", \"‚ö´Ô∏è\") }} - sonoff_2000000000 - - &gt;- Direita {{ states.switch.sonoff_3000000000.state|replace(\"on\", \"üí°\")|replace(\"off\", \"‚ö´Ô∏è\") }} - sonoff_3000000000(...) - - - &gt;- Escrit√≥rio {{ states.switch.sonoff_4000000000.state|replace(\"on\", \"üí°\")|replace(\"off\", \"‚ö´Ô∏è\") }} - sonoff_4000000000 - - - Atualizar üîÑ - /atualizarmode: singleComando /luzes.Disposi√ß√£o inline_keyboard: Inicia a cria√ß√£o de bot√µes; - - -: Indica nova linha; - -: Indica um bot√£o na mesma linha; Bot√µesTodo bot√£o tem uma mensagem exibida e um comando a ser enviado: - - - &gt;- Quarto teto {{ states.switch.sonoff_1000000000.state|replace(\"on\", \"üí°\")|replace(\"off\", \"‚ö´Ô∏è\") }} - sonoff_1000000000Ou seja, este bot√£o come√ßa uma nova linha, possui a mensagem Quarto teto üí° e o comando sonoff_1000000000. {{ states.switch.sonoff_1000000000 }} representa o estado do bot√£o; |replace(\"on\", \"üí°\")|replace(\"off\", \"‚ö´Ô∏è\") faz o estado ser simbolizado por üí° caso esteja ligado (on) ou ‚ö´Ô∏è caso esteja desligado (off).Comando do bot√£o AtualizarDiferentemente do comando de texto, o comando de um bot√£o vem em um callback. Os bot√µes do comando anterior exibem somente o estado de quando foram gerados. Para atualizar os estados sem que seja necess√°rio repetir o comando /luzes, sugiro o uso do bot√£o Atualizar. Crie uma nova automa√ß√£o com o seguinte conte√∫do:alias: Telegram Callback Atualizardescription: \"\"trigger: - platform: event event_type: telegram_callback event_data: command: /atualizarcondition: []action: - service: telegram_bot.answer_callback_query data: callback_query_id: \"{{ trigger.event.data.id }}\" message: | Atualizado em {{ now().hour }}:{{ now().minute }}:{{ now().second }} show_alert: true - service: telegram_bot.edit_message data: message_id: \"{{ trigger.event.data.message.message_id }}\" chat_id: \"{{ trigger.event.data.chat_id }}\" message: | &lt;b&gt;{{ trigger.event.data.message.text }}&lt;/b&gt; inline_keyboard: - - - &gt;- Quarto teto {{ states.switch.sonoff_1000000000.state|replace(\"on\", \"üí°\")|replace(\"off\", \"‚ö´Ô∏è\") }} - sonoff_1000000000(...) - - - Atualizar üîÑ - /atualizarmode: single service: Responder a chamada do bot√£o. Valor: telegram_bot.answer_callback_query; callback_query_id: Responder para quem clicou no bot√£o. Valor: \"{{ trigger.event.data.id }}\"; show_alert: Exibir pop-up. Valores poss√≠veis: true ou false.Ou seja, sempre que o bot√£o Atualizar for apertado, um pop-up ser√° exibido confirmando a atualiza√ß√£o naquele hor√°rio e a mensagem ser√° editada para exibir os valores atuais.Pop-up do bot√£o atualizar.Comando de bot√£o de luzalias: Telegram Callbackdescription: \"\"trigger: - platform: event event_type: telegram_callbackcondition: []action: - service: switch.toggle data: {} target: entity_id: switch.{{ trigger.event.data.data }} - delay: hours: 0 minutes: 0 seconds: 0 milliseconds: 100 - service: telegram_bot.edit_message data: message_id: \"{{ trigger.event.data.message.message_id }}\" chat_id: \"{{ trigger.event.data.chat_id }}\" message: &lt;b&gt;{{ trigger.event.data.message.text }}&lt;/b&gt; inline_keyboard: - - - &gt;- Quarto teto {{ states.switch.sonoff_1000000000.state|replace(\"on\", \"üí°\")|replace(\"off\", \"‚ö´Ô∏è\") }} - sonoff_1000000000(...) - - - Atualizar üîÑ - /atualizarO bot√£o de luz inicia tr√™s a√ß√µes em sequ√™ncia: O switch, cujo valor vem pelo comando do bot√£o({{ trigger.event.data.data }}), tem seu estado invertido (toggle); Aguarda 100 milisegundos para que o switch tenha seu estado alterado; Atualiza a mensagem, refazendo o seu conte√∫do com os estados atualizados.Comando /cameraEste comando tira uma foto da c√¢mera e a envia por Telegram. Muito √∫til para verificar rapidamente o que est√° sendo gravado.alias: Telegram Comando Cameradescription: \"\"trigger: - platform: event event_type: telegram_command event_data: command: /cameracondition: []action: - service: camera.snapshot data: filename: /tmp/snapshot.png target: device_id: 123456789abcdefghijklmnopqrst - service: telegram_bot.send_document data: authentication: digest file: /tmp/snapshot.png target: \"{{ trigger.event.data.chat_id }}\"mode: singleAs duas a√ß√µes desencadeadas pelo comando s√£o: Tirar uma foto (camera_snapshot) usando a c√¢mera definida em device_id e a armazena no caminho definido em filename; Envia a foto em formato de documento. A vantagem de enviar a foto como documento √© que mant√©m a qualidade original. Para enviar a foto com compress√£o, tornando o envio mais r√°pido mas com perda de qualidade, substitua send_document por send_photo.Falha ‚Äúno access to path‚ÄùCaso a pasta n√£o esteja acess√≠vel √† a√ß√£o de tirar a foto, um erro ‚Äúno access to path‚Äù ser√° exibido no log. Para corrigir, abra o configuration.yaml e adicione em homeassistant:homeassistant:(...) allowlist_external_dirs: - \"/tmp\"Adicionar itens √† lista de comprasPara adicionar itens √† Lista de Compras, integra√ß√£o dispon√≠vel aqui, basta enviar uma mensagem para o bot contendo o termo comprar.alias: Telegram Lista de Comprasdescription: \"\"trigger: - platform: event event_type: telegram_textcondition: - condition: template value_template: \"{{ 'comprar' in trigger.event.data.text|lower }}\"action: - service: shopping_list.add_item data: name: \"{{ trigger.event.data.text|title|replace('Comprar', '') }}\" - service: shopping_list.sort data: reverse: false - service: telegram_bot.send_message data: message: | &lt;code&gt;{{ trigger.event.data.text }}&lt;/code&gt; Salvo na Lista de Compras. target: \"{{ trigger.event.data.chat_id }}\"mode: single condition: Condi√ß√£o em que a a√ß√£o ser√° executada. Neste caso, ela somente ser√° executada na presen√ßa do termo comprar; |lower considera a mensagem toda em min√∫sculo, facilitando a verifica√ß√£o da condi√ß√£o. As tr√™s a√ß√µes da automa√ß√£o s√£o: Adicionar o item √† lista de compras; |title: Escreve o item em formato de t√≠tulo, ou seja, com as iniciais em mai√∫sculo; |replace('Comprar', ''): Remove o termo ‚ÄúComprar‚Äù presente na mensagem; Ordena a lista de compras; Por n√£o haver verifica√ß√£o de itens duplicados, faz-se necess√°ria a ordena√ß√£o alfab√©tica; Envia uma mensagem confirmando que o item foi adicionado √† lista de compras.Adicionando item √† lista de compras.Item adicionado.Comandos usando AssistOutra maneira de controlar o Home Assistant √© usando o Assist, usando comandos em forma de texto.alias: Telegram Assistdescription: \"\"trigger: - platform: event event_type: telegram_textcondition: - condition: template value_template: \"{{ 'comprar' not in trigger.event.data.text|lower }}\"action: - service: conversation.process data: text: \"{{ trigger.event.data.text }}\" language: pt-br - service: telegram_bot.send_message data: message: | &lt;code&gt;{{ trigger.event.data.text }}&lt;/code&gt; Comando enviado. target: \"{{ trigger.event.data.chat_id }}\" parse_mode: htmlmode: singleEsta automa√ß√£o somente ser√° executada caso o termo comprar n√£o esteja presente na mensagem. Satisfeita a condi√ß√£o, √© iniciado o servi√ßo conversation.process. - service: conversation.process data: text: \"{{ trigger.event.data.text }}\" language: pt-brEste servi√ßo ir√° processar a mensagem recebida e executar o comando. Definir o idioma n√£o √© obrigat√≥rio, mas torna a a√ß√£o muito mais r√°pida, portanto, √© recomend√°vel ter o idioma ajustado.Por fim, a a√ß√£o notifica o usu√°rio que foi executada.Assist em funcionamento.Menu do botO menu do bot n√£o √© obrigat√≥rio, mas √© recomendado por facilitar a localiza√ß√£o dos comandos dispon√≠veis. A maneira mais f√°cil de criar o menu √© falando com o @BotFather. Envie o comando /mybots e selecione o bot que deseja ajustar na lista. Clique em Edit Bot e, em seguida, em Edit Commands. Envie os comandos no formato comando - Descri√ß√£o.Ajuste de comandos no BotFather.Bot com o menu de comandos definido." }, { "title": "Bot de ChatGPT no Telegram", "url": "/posts/ChatGPTTelegram/", "categories": "Telegram, Bot", "tags": "telegram, bot, chatgpt, openai", "date": "2023-05-14 16:30:00 -0300", "snippet": "ChatGPT‚ÄúO OpenAI ChatGPT √© uma ferramenta de intelig√™ncia artificial (IA) projetada pela OpenAI para gerar conversas humanas em tempo real. O ChatGPT usa um modelo de linguagem natural de √∫ltima ge...", "content": "ChatGPT‚ÄúO OpenAI ChatGPT √© uma ferramenta de intelig√™ncia artificial (IA) projetada pela OpenAI para gerar conversas humanas em tempo real. O ChatGPT usa um modelo de linguagem natural de √∫ltima gera√ß√£o treinado em grandes quantidades de texto na internet para fornecer uma experi√™ncia de chatbot de alto n√≠vel. O sistema pode responder a perguntas, entender comandos e seguir t√≥picos de conversa, com habilidade suficiente para gerar respostas flu√≠das e coherentemente humanas. O OpenAI ChatGPT representa um passo significativo no futuro da IA e da comunica√ß√£o humana‚Äù 1.Bot no TelegramUm bot no Telegram nada mais √© que um programa de computador que segue uma receita de funcionamento, um algoritmo. Para funcionar √© necess√°rio que seu rob√¥ interaja com os servidores do Telegram. As instru√ß√µes de como esta comunica√ß√£o √© feita √© chamada de API, que pode ser entendida como uma interface de programa√ß√£o de aplica√ß√£o, dispon√≠vel em https://core.telegram.org/bots/api. Leia maisRequisitosChave da OpenAIA chave da OpenAI √© facilmente gerada. Tendo uma conta no site da OpenAI, clique em Personal (canto superior direito) e, em seguida, em View API Keys. Crie uma chave clicando em Create new secret key.Token do botPara se comunicar com o Telegram, crie um bot, caso j√° n√£o possua um, falando com o @BotFather. Envie o comando /newbot e siga as instru√ß√µes.Instala√ß√£oPara criar o seu bot com ChatGPT, basta clonar o reposit√≥rio ChatGPT-Telegram-Bot e seguir o passo a passo do post que explica como ter um bot na Amazon. Repare que o arquivo serverless.yml j√° est√° criado e pronto para ser usado.Como o uso da API do ChatGPT √© pago2, √© necess√°rio definir quais identificadores do Telegram3 ser√£o respondidos pelo bot. Este controle √© feito pela vari√°vel USERID, que pode conter uma lista de IDs de pessoas ou mesmo o ID de um grupo. Ou seja, no segundo caso, todos os membros do grupo ser√£o capazes de interagir com o bot.Consulte os pre√ßos e plano gr√°tis de testes da API no site oficial.Por fim, defina os valores das vari√°veis de ambiente necess√°rias para o funcionamento do bot.export TOKEN=&lt;TOKEN DO BOT&gt;export CHATGPTKEY=&lt;CHAVE DO CHATGPT&gt;export USERID=&lt;ID DE USU√ÅRIO&gt;Execu√ß√£oFinalmente, com todos os ajustes feitos, execute o comando abaixo para que o bot seja criado na Amazon.serverless deployNo fim da instala√ß√£o, n√£o esque√ßa de definir o webhook usandopython setWebhook.py &lt;URL DO BOT NA AMAZON&gt;Pronto. Seu bot deve estar funcionando.Bot em funcionamentoC√≥digoFun√ß√£o ask_chatgptA fun√ß√£o ask_chatgpt √© respons√°vel pelas consultas √† API da OpenAI. √â ela que envia a mensagem e recebe a resposta. A mensagem √© enviada com role: user, indicando que s√£o as mensagens enviadas pelo usu√°rio. J√° as respostas s√£o armazenadas com role: assistant, pois s√£o as respostas recebidas pelo assistente. √â importante armazenar o hist√≥rico de mensagens para ser mantido o contexto da conversa. Caso o contexto n√£o seja mantido (linhas 12 e 20), a cada mensagem o bot ir√° se comportar como se fosse novo, como se n√£o houvesse conversa anterior.Par√¢metros da OpenAI model: Identificador do modelo usado. Cada modelo possui um custo e uma finalidade espec√≠fica. Valor padr√£o: gpt-3.5-turbo; messages: Lista de mensagens contidas na conversa; n: Quantas respostas ser√£o geradas. Valor padr√£o: 1; temperature: N√≠vel de aleatoriedade da resposta, variando de 0 a 2, sendo zero de maior aleatoriedade e dois de menor aleatoriedade. Valor padr√£o: 1; max_tokens: O tamanho m√°ximo em tokens usado em cada intera√ß√£o. Valor padr√£o 1024.Para mais informa√ß√µes, consulte a API oficial.Fun√ß√£o clean_contextAo receber o comando /start o bot ir√° limpar o hist√≥rico da conversa, perdendo todo o contexto que possui. Pode ser √∫til para fins de manter o custo do bot baixo.Fun√ß√£o message_receivedTodas as mensagens, com exce√ß√£o do comando /start, entram nesta fun√ß√£o, que ir√° chamar a fun√ß√£o ask_chatgpt usando o conte√∫do da mensagem recebida como par√¢metro.Fun√ß√£o hello_httpFun√ß√£o respons√°vel pelo funcionamento do webhook.Caso queira executar o bot usando polling, remova toda esta fun√ß√£o e acrescente ao c√≥digo a linha:bot.infinity_polling() Este texto foi elaborado pelo pr√≥prio bot usando o ChatGPT.¬†&#8617; Consulte os pre√ßos e planos, al√©m do plano gr√°tis (de testes), no site oficial.¬†&#8617; Leia mais em https://blog.gabrf.com/posts/TelegramID/¬†&#8617; " }, { "title": "Como hospedar um bot na Amazon AWS", "url": "/posts/ServerlessBot/", "categories": "Telegram, Bot", "tags": "telegram, bot, aws, serverless, webhook", "date": "2023-01-19 19:20:00 -0300", "snippet": "Amazon LambdaLambda √© a hospedagem de fun√ß√µes do tipo serverless da Amazon. Estas fun√ß√µes n√£o exigem o gerenciamento de recursos computacionais ou qualquer tipo de infraestrutura para funcionarem. ...", "content": "Amazon LambdaLambda √© a hospedagem de fun√ß√µes do tipo serverless da Amazon. Estas fun√ß√µes n√£o exigem o gerenciamento de recursos computacionais ou qualquer tipo de infraestrutura para funcionarem. Basta enviar o c√≥digo fonte e a Amazon se encarregar√° de sua execu√ß√£o conforme os crit√©rios definidos. O c√≥digo fica ‚Äúadormecido‚Äù e somente √© executado quando chamado.√â uma op√ß√£o muito interessante para quem n√£o quer ter que lidar com um servidor, mem√≥ria RAM, uso de CPU, HDD etc. O uso da tecnologia serverless remove todo o trabalho do desenvolvedor, facilitando inclusive a escalabilidade do projeto. Outra vantagem do serverless √© que toda a responsabilidade com a seguran√ßa do servidor fica a cargo do provedor. Normalmente, por manter a aplica√ß√£o ‚Äúadormecida‚Äù enquanto n√£o √© usada, o custo √© menor que o de manter um servidor ligado.Serverless.comServerless.com √© uma ferramenta que facilita o envio e o controle de solu√ß√µes na nuvem para os mais diversos provedores. A configura√ß√£o √© toda feita em um arquivo .yml e tudo √© gerenciado facilmente.Serverless √© a tecnologia que permite n√£o se preocupar com a infraestrutura para rodar a aplica√ß√£o. N√£o confundir com serverless.com, que √© a ferramenta usada para facilitar o gerenciamento da fun√ß√£o.Instala√ß√£oPara instalar a ferramenta serverless.com, siga as instru√ß√µes do site oficial ou do canal oficial no YouTube.Definir e Configurar Chave de acessoFeita a instala√ß√£o, crie uma chave de acesso para o serverless.com conforme a documenta√ß√£o oficial ou o v√≠deo. O comando para o ajuste das credenciais √© o seguinte:serverless config credentials \\ --provider aws \\ --key &lt;Access key ID&gt; \\ --secret &lt;Secret access key&gt;Arquivo serverless.ymlCrie o arquivo serverless.yml com o conte√∫do abaixo, ajustando-o conforme a necessidade:service: &lt;nome&gt;frameworkVersion: '3'provider: name: aws runtime: python3.8 region: eu-west-3functions: bot: handler: bot.hello_http events: - httpApi: path: / method: post environment: TOKEN: ${env:TOKEN}plugins: - serverless-python-requirementscustom: pythonRequirements: dockerizePip: false usePipenv: falseO que n√£o for listado abaixo n√£o deve ser alterado: service: Nome do bot (sem espa√ßos); region: Regi√£o em que o bot ser√° hospedado. Recomendo eu-west-3 por ser na Europa, deixando o bot com baixa lat√™ncia; handler: Composto por &lt;nome_do_arquivo_py&gt;.&lt;fun√ß√£o_que_recebe_requisi√ß√µes&gt;; environment: Vari√°veis de ambiente que ser√£o usadas pelo .py; plugins: Recomendo usar o serverless-python-requirements para que sejam instaladas as depend√™ncias listadas no requirements.txt.Para instalar o plugin, use o comando:sls plugin install -n serverless-python-requirementsCaso n√£o utilize o requirements.txt, remova as linhas 19 em diante do serverless.yml.BotArquivo bot.pyTendo o bot no arquivo bot.py, um exemplo de rob√¥ que repete tudo o que recebe seria:import telebotimport osTOKEN = os.getenv('TOKEN')bot = telebot.TeleBot(TOKEN, threaded=False)@bot.message_handler(func=lambda m:True)def on_message(message): bot.reply_to(message, message.text)def hello_http(event, context): update = telebot.types.Update.de_json(event['body']) try: bot.process_new_updates([update]) except: pass return {\"statusCode\": 200, \"body\": \"hello world\"}A fun√ß√£o hello_http deve ter o mesmo nome usado no arquivo serverless.yml. √â ela que receber√° os requests enviados ao bot. Ou seja, este bot usa webhook em vez de polling. Isto significa que o bot √© executado somente quando chamado. Ele n√£o busca atualiza√ß√µes no servidor do Telegram, o Telegram √© que vai at√© a Amazon quando algo chegar, fazendo o bot ser executado.O webhook √© recomendado para bots que usam serverless por permitir que o bot somente seja executado quando houver uma requisi√ß√£o/mensagem. A alternativa seria o uso do polling, que faria o bot ficar sempre ligado, como demonstrado aqui.Arquivo requirements.txtO requirements.txt seria:pyTelegramBotAPI==4.6.0Caso haja necessidade, basta acrescentar outras bibliotecas a serem instaladas, uma por linha e, preferencialmente, com as vers√µes definidas.Comando DeployExecute o comando abaixo para armazenar o token em uma vari√°vel de ambiente, substituindo &lt;TOKEN_DO_BOT&gt; pelo valor fornecido pelo BotFather:export TOKEN=&lt;TOKEN_DO_BOT&gt;Em seguida, execute o comando abaixo para fazer o deploy:serverless deployEste comando ir√° empacotar o bot e enviar√° toda a informa√ß√£o para a Amazon. Ir√° tamb√©m criar toda a infraestrutura necess√°ria para o funcionamento do bot, criando tamb√©m um bucket e um API Gateway. O primeiro simplesmente armazena o c√≥digo, j√° o segundo serve de ponto de entrada das requisi√ß√µes que fazem o c√≥digo ser executado.Ap√≥s a conclus√£o do deploy, copie o valor do endpoint, pois ele ser√° usado no pr√≥ximo passo.Arquivo setWebhook.pyEste arquivo ser√° usado somente uma vez, ap√≥s a primeira execu√ß√£o do Deploy, para definir a URL que o Telegram ir√° enviar as requisi√ß√µes que fazem o bot ser executado. N√£o √© necess√°rio executar o script outras vezes a menos que o ENDPOINT seja alterado, o que n√£o √© comum.Crie um arquivo setWebhook.py com o c√≥digo abaixo:import osimport sysimport telebotTOKEN = os.getenv('TOKEN')WEBHOOK = sys.argv[1]bot = telebot.TeleBot(TOKEN)bot.remove_webhook()bot.set_webhook(WEBHOOK)Usando o valor do endpoint fornecido anteriormente, execute:python setWebhook.py \"&lt;ENDPOINT&gt;\"Repare que as \" (aspas) devem ser usadas no comando!Pronto! Definido o webhook seu bot j√° estar√° funcionando.Comando RemovePara remover tudo de uma s√≥ vez, basta executar:serverless removeEste comando, al√©m de remover a fun√ß√£o, remover√° tamb√©m o bucket e o API Gateway. Ou seja, n√£o restar√° nada relacionado ao bot na nuvem da Amazon. Ele n√£o pode ser desfeito, ent√£o use somente quando necess√°rio." }, { "title": "Recebendo PIX em bot do Telegram", "url": "/posts/MercadoPago/", "categories": "Telegram, Bot", "tags": "telegram, bot, pix, mercadopago", "date": "2023-01-16 19:00:00 -0300", "snippet": "De todas as APIs que j√° estudei, a do Mercado Pago foi sem d√∫vida uma das mais simples de implementar e usar. Este texto explica e d√° exemplos de como podem ser enviadas cobran√ßas usando-se um bot ...", "content": "De todas as APIs que j√° estudei, a do Mercado Pago foi sem d√∫vida uma das mais simples de implementar e usar. Este texto explica e d√° exemplos de como podem ser enviadas cobran√ßas usando-se um bot do Telegram. O limite √© a sua criatividade.O uso da API √© dividido em duas partes:Cobran√ßaA cobran√ßa √© gerada e seu resultado √© um c√≥digo PIX do tipo copia e cola, com valor e validade definidos. N√£o √© poss√≠vel que o cliente altere qualquer um deles. A validade padr√£o √© de um dia, mas pode ser alterada como demonstrado nos pr√≥ximos passos.Para ser gerada uma cobran√ßa √© obrigat√≥rio o fornecimento de um endere√ßo de e-mail do cliente. Este endere√ßo tem por principal finalidade o envio da cobran√ßa e do comprovante para a pessoa. Para facilitar o uso do bot, sugiro colocar um endere√ßo de e-mail fixo, fazendo com que n√£o seja necess√°rio o fornecimento do dado. O lado negativo desta abordagem √© que a pessoa fica restrita a fazer o pagamento pelo bot, n√£o sendo poss√≠vel ter uma c√≥pia consigo. Ou seja, o modelo de neg√≥cio que vai definir a exig√™ncia ou n√£o do email da pessoa.PagamentoA cobran√ßa fica pendente at√© que seja atingida a sua validade ou que seja paga. A parte que gera a cobran√ßa √© totalmente separada da verifica√ß√£o. Recomendo ter duas inst√¢ncias separadas, uma para o bot e outra apenas para verifica√ß√µes. A cobran√ßa √© paga quando seu estado √© alterado para approved. Enquanto aguarda o pagamento, o estado √© pending. Caso n√£o seja paga, a cobran√ßa ter√° o estado cancelled ao ser atingida a data de validade.Requisitos Ter uma conta no Mercado Pago; Obter um token de acesso no painel de credenciais; Ter uma chave PIX para receber pagamentos cadastrada em sua conta.Instala√ß√£oInstale a biblioteca oficial do Mercado Pago para utilizar a cobran√ßa via PIX.pip install mercadopagoOpcionalmente, caso queira gerar a imagem do QRCode, √© recomend√°vel instalar tamb√©m a biblioteca Pillow.pip install PillowUsoCobran√ßa simplesO script abaixo gera uma cobran√ßa de valor definido na vari√°vel valor (linha 6).import mercadopagosdk = mercadopago.SDK(TOKEN)payment_data = { \"transaction_amount\": valor, \"description\": \"descri√ß√£o\", \"payment_method_id\": 'pix', \"installments\": 1, \"payer\": { \"email\": 'email_do_cliente@dominio.xpto' }}result = sdk.payment().create(payment_data)print(result['response']) transaction_amount: Valor a ser cobrado; description: Descri√ß√£o; payment_method_id: (N√£o alterar) M√©todo de pagamento; installments: (N√£o alterar) N√∫mero de parcelas; payer: email: E-mail do cliente/pagador. Cobran√ßa com validadeAbaixo, um script que gera cobran√ßa com validade igual a 30 minutos (linha 5):import datetimeimport mercadopagosdk = mercadopago.SDK(TOKEN)expire = datetime.datetime.now() + datetime.timedelta(minutes=30)expire = expire.strftime(\"%Y-%m-%dT%-H:%M:%S.000-03:00\")payment_data = { \"date_of_expiration\": f\"{expire}\", \"transaction_amount\": valor, \"description\": \"descri√ß√£o\", \"payment_method_id\": 'pix', \"installments\": 1, \"payer\": { \"email\": 'email_do_cliente@dominio.xpto' }}result = sdk.payment().create(payment_data)print(result['response']) date_of_expiration: Data de validade. Padr√£o: 1 dia. Formato obrigat√≥rio: yyyy-MM-dd'T'HH:mm:ssz RespostaPara fins de simplica√ß√£o, apenas alguns items da resposta ser√£o tratados aqui. Consulte a lista completa na documenta√ß√£o oficial.Usando-se qualquer um dos c√≥digos anteriores,pix_copia_cola = result['response']['point_of_interaction']['transaction_data']['qr_code']qr_code = result['response']['point_of_interaction']['transaction_data']['qr_code_base64'] pix_copia_cola: Valor a ser colado no PIX para ser feito o pagamento j√° com o valor fixado; qr_code: QRCode correspondente ao pix copia e cola em base64.Ou seja, com o pix_copia_cola j√° √© poss√≠vel fazer o pagamento. A imagem contida em qr_code pode ser usada tamb√©m. Mais abaixo √© demonstrado como ela pode ser enviada.Lista cobran√ßasPara verificar todas as cobran√ßas em sua conta, independente do estado e listadas na ordem em que foram geradas, utilize:import mercadopagosdk = mercadopago.SDK(TOKEN_MERCADOPAGO)payments = sdk.payment().search({'sort':'date_created', 'criteria': 'desc'})for payment in payments['response']['results']: print(payment['id'], payment['status'], payment['description'], payment['date_of_expiration'])Verifica estadoUma cobran√ßa de ID espec√≠fico (linha 7) pode ser verificada usando:import mercadopagoimport telebotbot = telebot.TeleBot(TOKEN_BOT)sdk = mercadopago.SDK(TOKEN_MERCADOPAGO)result = sdk.payment().get(ID_DO_PAGAMENTO)payment = result[\"response\"]print(payment['status'], payment['description'])BotEnvia PIX Copia e ColaEste bot ir√° enviar uma cobran√ßa no valor de R$ 10 (linha 27) para a pessoa que enviar o comando /pagar.import datetimeimport mercadopagoimport telebotsdk = mercadopago.SDK(TOKEN_MERCADOPAGO)bot = telebot.TeleBot(TOKEN_BOT)def create_payment(value): expire = datetime.datetime.now() + datetime.timedelta(days=1) expire = expire.strftime(\"%Y-%m-%dT%-H:%M:%S.000-03:00\") payment_data = { \"transaction_amount\": int(value), \"payment_method_id\": 'pix', \"installments\": 1, \"description\": 'Descri√ß√£o', \"date_of_expiration\": f\"{expire}\", \"payer\": { \"email\": 'email@dominio.xpto' } } result = sdk.payment().create(payment_data) return result@bot.message_handler(commands=['pagar'])def cmd_pagar(message): payment = create_payment(10) pix_copia_cola = payment['response']['point_of_interaction']['transaction_data']['qr_code'] bot.send_message(message.from_user.id, f'&lt;code&gt;{pix_copia_cola}&lt;/code&gt;', parse_mode='HTML') if __name__ == \"__main__\": bot.infinity_polling()Envia QRCodeSemelhante ao exemplo anterior, este bot envia uma cobran√ßa para o usu√°rio que enviar /pagar. A resposta ser√° a imagem do QRCode com o PIX Copia e Cola como legenda.import datetimeimport mercadopagoimport telebotimport base64from PIL import Imagefrom io import BytesIOsdk = mercadopago.SDK(TOKEN_MERCADOPAGO)bot = telebot.TeleBot(TOKEN_BOT)def create_payment(value): expire = datetime.datetime.now() + datetime.timedelta(days=1) expire = expire.strftime(\"%Y-%m-%dT%-H:%M:%S.000-03:00\") payment_data = { \"transaction_amount\": int(value), \"payment_method_id\": 'pix', \"installments\": 1, \"description\": 'Descri√ß√£o', \"date_of_expiration\": f\"{expire}\", \"payer\": { \"email\": 'email@dominio.xpto' } } result = sdk.payment().create(payment_data) return result@bot.message_handler(commands=['pagar'])def cmd_pagar(message): payment = create_payment(10) pix_copia_cola = payment['response']['point_of_interaction']['transaction_data']['qr_code'] qr_code = payment['response']['point_of_interaction']['transaction_data']['qr_code_base64'] qr_code = base64.b64decode(qr_code) qr_code_img = Image.open(BytesIO(qr_code)) qrcode_output = qr_code_img.convert('RGB') bot.send_photo(message.from_user.id, qrcode_output, f'&lt;code&gt;{pix_copia_cola}&lt;/code&gt;', parse_mode='HTML')if __name__ == \"__main__\": bot.infinity_polling()TaxasNa data em que o texto foi escrito havia uma cobran√ßa de 0.99% por pagamento. Consulte o site oficial para obter informa√ß√µes atualizadas.LembreteN√£o se esque√ßa de enviar um PIX como agradecimento ao texto que te dar√° muito dinheiro!Chave pix: bots@grf.xyz." }, { "title": "Send2KindleBot - Mudan√ßas recentes na Amazon", "url": "/posts/Send2KindleBot-2/", "categories": "Telegram, Bot", "tags": "kindle, send2kindlebot, telegram, bot, amazon", "date": "2023-01-02 18:00:00 -0300", "snippet": " Porque seus arquivos n√£o chegamFuncionamentoO @Send2KindleBot pede dois e-mails assim que a conversa √© iniciada. O e-mail usado em sua conta Amazon e o e-mail de seu dispositivo/app Kindle.Por qu...", "content": " Porque seus arquivos n√£o chegamFuncionamentoO @Send2KindleBot pede dois e-mails assim que a conversa √© iniciada. O e-mail usado em sua conta Amazon e o e-mail de seu dispositivo/app Kindle.Por que?Porque o bot utiliza o seu e-mail para enviar o documento. Ou seja, o bot ‚Äúpreenche‚Äù o campo remetente com o seu endere√ßo de e-mail da conta e o de destinat√°rio com o do kindle. Isto facilita o uso do bot e tamb√©m a configura√ß√£o do servidor de e-mail que o bot utiliza.O que mudou?Recentemente, a Amazon passou a verificar o DNS reverso do e-mail, o que faz sentido. A consequ√™ncia disso √© que agora, ao receber um documento, a Amazon consulta se o servidor que preencheu o campo de remetente de fato √© o servidor daquele endere√ßo. Ou seja, a Amazon verifica se o servidor do bot √© o servidor do GMail, do Hotmail, do Yahoo etc. Obviamente n√£o √©, falhando na verifica√ß√£o. Assim, o e-mail enviado pelo bot cai no que seria uma caixa de SPAM, exigindo que o usu√°rio precise confirmar o envio clicando em um link que chega por e-mail, no mesmo endere√ßo usado na conta da Amazon. E-mail de verifica√ß√£o de documento enviadoCorre√ß√£oInfelizmente a corre√ß√£o √© invi√°vel, portanto, n√£o ser√° feita. As possibilidades s√£o as seguintes:Dom√≠nio pr√≥prioUma poss√≠vel solu√ß√£o seria criar um dom√≠nio para o bot. O problema √© que para dar certo, eu teria dois custos adicionais. Um servidor pr√≥prio para o bot, com IP p√∫blico; Um nome de dom√≠nio para o bot. Para quem usa o bot seria necess√°ria a autoriza√ß√£o de um novo endere√ßo de e-mail com permiss√£o de envios. Ou seja, dificultaria o uso.Al√©m disso, aumentaria muito o custo do bot, pois tanto o servidor quanto o dom√≠nio s√£o pagos. Isto tornaria o bot invi√°vel de ser mantido. Seu custo mais que dobraria.E-mail pr√≥prioOutra possibilidade seria ter um e-mail exclusivo para o bot, exemplo send2kindlebot@hotmail.com. Al√©m de ter o mesmo problema de exigir a configura√ß√£o de cada usu√°rio, tamb√©m seria criada uma brecha de seguran√ßa.Parte da seguran√ßa do envio de documentos existe por exigir a combina√ß√£o perfeita entre remetente e destinat√°rio. Tendo um mesmo remetente para todas as pessoas, algu√©m com m√°s inten√ß√µes teria 50% menos trabalho para fazer SPAM, pois bastaria usar o mesmo e-mail que o bot para disparar documentos para as pessoas. N√£o me parece uma boa id√©ia.Solu√ß√£o idealSeria muito interessante se a Amazon confiasse no servidor usado pelo bot. A configura√ß√£o a ser feita seria simples e resolveria o problema por completo. Houve uma tentativa de contato com a empresa em 16/11/2022, mas sem respostas.Solu√ß√£o realPor enquanto, n√£o h√° o que ser feito. Todos os envios v√£o exigir a verifica√ß√£o por e-mail enquanto n√£o surgir uma id√©ia melhor.Atualizarei o post quando houver uma resposta da Amazon." }, { "title": "Automa√ß√£o Residencial: Interruptor de cenas", "url": "/posts/SonoffSMate/", "categories": "Automa√ß√£o Residencial, Interruptor de Cenas", "tags": "automa√ß√£o, cenas, sonoff, smate, homeassistant, hass", "date": "2022-10-04 18:40:00 -0300", "snippet": " Resolvendo todos os problemas que voc√™ n√£o sabia que tinha.Um interruptor comum √© aquele que controla somente um circuito. A liga√ß√£o entre o interruptor e o dispositivo controlado √© um fio, limit...", "content": " Resolvendo todos os problemas que voc√™ n√£o sabia que tinha.Um interruptor comum √© aquele que controla somente um circuito. A liga√ß√£o entre o interruptor e o dispositivo controlado √© um fio, limitando completamente sua a√ß√£o para um fim espec√≠fico. N√£o √© poss√≠vel alterar o que √© controlado por um interruptor comum sem que se desligue o quadro el√©trico, abra as caixinhas dos interruptores e sejam feitas mudan√ßas na fia√ß√£o.J√° um interruptor de cenas √© um interruptor que ao ser apertado pode executar uma a√ß√£o qualquer. N√£o existe liga√ß√£o f√≠sica direta entre o interruptor de cenas e os objetos. Tudo √© definido por software. Ou seja, √© poss√≠vel configurar um interruptor de cenas para apagar somente uma l√¢mpara ou apagar todas as l√¢mpadas de uma vez, sem que seja necess√°ria nenhuma interven√ß√£o na instala√ß√£o. Tudo √© feito via software.Sonoff S-Mate Sonoff S-MateO S-Mate √© um dispositivo que transforma um interruptor comum em um interruptor de cenas, podendo ser instalado em caixas 4x2. Ele n√£o exige neutro e pode ser colocado em locais em que foi feita uma instala√ß√£o padr√£o para ilumina√ß√£o. Ele pode receber at√© tr√™s interruptores diferentes. Exige a exist√™ncia de um Sonoff MiniR3 ou de um Sonoff M5 a no m√°ximo 40 metros de dist√¢ncia para que funcione. Havendo este pareamento com o MiniR3 ou com o M5, torna-se ent√£o capaz de controlar qualquer outro dispositivo.Seu √∫nico ponto negativo √© a alimenta√ß√£o por bateria CR2032. Ou seja, mesmo com uma expectativa de dura√ß√£o de dois anos, n√£o √© poss√≠vel instal√°-lo e esquecer que existe. Mais cedo ou mais tarde ser√° necess√°rio fazer uma pequena manuten√ß√£o, abrindo-o e trocando a bateria. Por isso, analise muito bem onde ir√° instal√°-lo.De todos os dispositivos deste post, o S-Mate √© o que mais me chama a aten√ß√£o por permitir que um interruptor comum seja transformado em um interruptor de cenas. Um interruptor que ligava uma l√¢mpada pode passar a desligar cinco l√¢mpadas diferentes, ligar a tv e o ar condicionado. Uma campainha pode tocar uma m√∫sica1. As possibilidades passam a ser infinitas.Instala√ß√£oUm ponto que me chamou a aten√ß√£o no Sonoff S-Mate √© a sua instala√ß√£o. Ele possui os pontos L, L1, L2 e L3, que servem para manter em funcionamento as liga√ß√µes j√° existentes nas caixas 4x2. Por√©m, us√°-las √© totalmente opcional uma vez que elas n√£o participam do funcionamento do dispositivo. Na verdade, estes quatro pontos s√£o fisicamente unidos internamente. Qualquer dispositivo ligado ap√≥s um destes pontos receber√° energia sempre. Por este motivo o fabricante indica a instala√ß√£o do Sonoff MiniR3 na sequ√™ncia do S-Mate. O MiniR3 instalado desta forma nunca √© desligado e ambos os dispositivos se encaixam perfeitamente em liga√ß√µes padr√µes de luzes.A parte importante na liga√ß√£o do S-Mate acontece nos pontos S, S1, S2 e S3. Estes sim s√£o os pontos que servem de gatilho para as cenas. O ponto S √© o ‚Äúcomum‚Äù e sempre que √© fechado o circuito entre ele e qualquer um dos outros pontos S √© enviado um sinal para o Sonoff MiniR3 ou para o Sonoff M5, o que estiver vinculado. Esquema de liga√ß√£o do Sonoff S-MatePor que isso √© bom?Porque permite que facilmente seja criado um interruptor novo sem que chegue fio algum ao local. √â poss√≠vel, por exemplo, ligar os pontos S e S1 em uma campainha sem que seja necess√°rio ter ponto de energia el√©trica. Desta forma, ao ser tocada a campainha, uma cena ser√° iniciada, que pode desde acender uma luz at√©, por exemplo, enviar uma mensagem para um celular1.Um interruptor de cenas pode tamb√©m ter seu comportamento variando conforme o hor√°rio. √â poss√≠vel que o interruptor ao lado da cama acenda a luz de leitura caso acionado at√© as 21:00. Ap√≥s as 21:00, se clicado, poderia enviar um comando desligando todas as luzes da casa, deixando somente o jardim aceso. Ao acordar, caso seja acionado at√© as 10:00 e for um dia de semana, desligaria o ar condicionado.Sonoff MiniR3Sonoff Mini R3Quase um Sonoff Basic, o Sonoff Mini R3 n√£o √© um interruptor, mas pode receber o sinal do Sonoff R5 e do Sonoff S-Mate. √â um dispositivo em que entram dois fios, fase e neutro, e saem tamb√©m dois fios, fase e neutro. Ou seja, para fazer a instala√ß√£o em uma luz j√° existente, basta colocar o dispositivo ali, onde a l√¢mpada tem seus fios conectados. O Mini R3 ser√° um intermedi√°rio entre a l√¢mpada e a fia√ß√£o do local. N√£o h√° espa√ßo para a liga√ß√£o do interruptor nem mais nada.Seu grande trunfo √© permitir o uso do Sonoff S-Mate uma vez que ambos t√™m a instala√ß√£o simplificada. A desvantagem √© o aumento do custo, pois √© necess√°rio comprar dois dispositivos em vez de um s√≥.Por√©m, como um √∫nico Mini R3 √© capaz de se comunicar com at√© oito S-Mates, n√£o √© necess√°rio colocar o Mini R3 em todos os circuitos a serem controlados. Qualquer outro Sonoff atenderia, mesmo o Basic.Sonoff DualR3Sonoff Dual R3Este modelo parece o Sonoff MiniR3, mas, na verdade, √© a evolu√ß√£o do Sonoff Mini R2. Pode controlar at√© dois circuitos separadamente, √© capaz de controlar motores2 e √© compat√≠vel com interruptores three-way. Pode ser encontrado em dois modelos:Dual R3 LiteVers√£o b√°sica. Possui as mesmas funcionalidades do Sonoff Mini R2, tendo como novidade o controle de motores2 e entrada m√°xima de 15A no total.Dual R3Apesar de ter a mesma apar√™ncia da vers√£o Lite, possui como diferenciais a capacidade de calibra√ß√£o para motores e tamb√©m a de medi√ß√£o do consumo de energia el√©trica, permitindo a visualiza√ß√£o de hist√≥rico e de dados em tempo real.Limita√ß√£oN√£o serve como dispositivo que recebe o sinal do Sonoff S-Mate nem do Sonoff R5. Isto significa que um S-Mate ou um R5 √© sim capaz de interagir com o DualR3, desde que exista um Sonoff M5 ou um Sonoff MiniR3 como intermedi√°rios.Sonoff M5Sonoff M5 (modelo 120)O Sonoff M5 √© um interruptor comum, por√©m, capaz de se comunicar com o Sonoff S-Mate e com o Sonoff R5. Infelizmente sua est√©tica n√£o √© a mesma do Sonoff R5, deixando um ambiente sem padr√£o caso sejam usados em conjunto. Tem exatamente o mesmo funcionamento do MiniR3, por√©m em formato de interruptor. Exige a exist√™ncia de um fio neutro para funcionar. √â a evolu√ß√£o da linha TX, com visual renovado e a capacidade de se comunicar com o S-Mate e com o R5.O modelo compat√≠vel com as caixas 4x2 brasileiras √© o 120, que possui op√ß√µes com uma, duas ou tr√™s teclas.Op√ß√µes de Sonoff M5 120Sonoff R5Sonoff R5O Sonoff R5 √© um interruptor de cenas sem fio. Ele √© acompanhado uma base magn√©tica que pode ser fixada na parede, cujo uso √© opcional. O dispositivo √© alimentado por duas baterias CR2032 e se comunica com o Sonoff M5 ou com o Sonoff MiniR3 em 433Mhz. Seu grande trunfo em rela√ß√£o ao uso do S-Mate √© o de permitir al√©m do clique simples, a configura√ß√£o de duplo clique e clique longo. Ou seja, uma mesma tecla pode ter tr√™s fun√ß√µes diferentes. Possuindo seis teclas, cada uma com tr√™s configura√ß√µes, permite o controle de at√© 18 cenas. O controle de outros dispositivos que n√£o s√£o Sonoff exige o uso de solu√ß√µes de terceiros, como, por exemplo, o Home Assistant.¬†&#8617;¬†&#8617;2 Consulte informa√ß√µes no site do fabricante.¬†&#8617;¬†&#8617;2 " }, { "title": "Bot de envio de regras e controle de acesso a grupos", "url": "/posts/RegrasRobot/", "categories": "Telegram, Bot", "tags": "telegram, grupo, bot, regras", "date": "2022-08-26 18:00:00 -0300", "snippet": "Este bot tem uma fun√ß√£o muito simples e objetiva, permitir a entrada de pessoas em um grupo do Telegram somente ap√≥s lerem e aceitarem as regras. Ele pode ser usado em grupos p√∫blicos ou privados e...", "content": "Este bot tem uma fun√ß√£o muito simples e objetiva, permitir a entrada de pessoas em um grupo do Telegram somente ap√≥s lerem e aceitarem as regras. Ele pode ser usado em grupos p√∫blicos ou privados e sua configura√ß√£o deve ser feita pessoa pessoa que √© dona do grupo. O bot n√£o aceitar√° fazer a configura√ß√£o por outra pessoa.Como usar Adicione o bot ao seu grupo; Transforme seu grupo em supergrupo. Leia mais informa√ß√µes aqui; Adicione o bot ao grupo e coloque-o como administrador; No grupo, envie o comando /set_rules e defina as regras. A mensagem enviada para a pessoa ser√° exatamente a mesma enviada neste etapa. Grupos p√∫blicosNas op√ß√µes do grupo, v√° em tipo de grupo e ligue a op√ß√£o Aprovar novos membros. Pronto. Isto √© suficiente para que o bot entre em contato com as pessoas quando elas tentarem entrar no grupo e envie a mensagem com as regras.Grupos privadosEm grupos privados, o bot somente ir√° funcionar para as pessoas que entrarem no grupo usando um link com a op√ß√£o Pedir aprova√ß√£o de admins ligada. Para gerar um link com esta op√ß√£o, basta abrir os ajustes do grupo e clicar em Links de convite. Gere um link com a op√ß√£o ligada e envie para as pessoas.Regras do grupoAs regras do grupo podem ser acessadas enviando-se o comando /regras no grupo. A mensagem com o comando ser√° automaticamente apagada e enviada como mensagem privada. Caso o bot n√£o consiga enviar a mensagem para a pessoa, uma mensagem ser√° enviada no grupo com um link que permitir√° o envio em privado assim que clicado. Esta mensagem enviada no grupo ser√° apagada automaticamente em alguns segundos, mantendo o grupo sempre organizado.CaptchaAo solicitar a entrada em um grupo, para confirmar que leu e entendeu as regras ser√° necess√°rio que a pessoa clique no bot√£o correspondente ao emoji descrito na mensagem. A id√©ia √© que funcione como um captcha, barrando contas automatizadas de entrarem no grupo. A mensagem com o captcha fica dispon√≠vel por dois minutos. Caso n√£o seja respondida ou seja respondida incorretamente, a mensagem √© automaticamente removida.GitHubO bot √© de c√≥digo aberto e toda colabora√ß√£o √© bem vinda! Visite o reposit√≥rio aqui.Grupo vs SupergrupoInicialmente criamos grupos. Com a evolu√ß√£o do app, o Telegram criou o conceito de supergrupos. Para o usu√°rio, isto faz pouca ou nenhuma diferen√ßa. Para o bot isto √© importante pois altera o ID do grupo, que √© a parte importante quando tratamos de bots. Para n√£o haver confus√µes futuras, o bot somente funciona em supergrupos.A transforma√ß√£o de grupo em supergrupo √© feita de maneira autom√°tica pelo Telegram. A maneira mais f√°cil e imediata de for√ßar tal mudan√ßa √© alterando as regras de visibilidade de hist√≥rico do grupo. Abra as op√ß√µes do grupo e altere para deixar o hist√≥rico v√≠sivel sempre. Ao fazer isto, automaticamente o grupo √© transformado em supergrupo e isto n√£o pode ser desfeito, independente do ajuste escolhido em sequ√™ncia." }, { "title": "Feed RSS no Telegram sem precisar de servidor", "url": "/posts/Rss2Telegram/", "categories": "Telegram, Bot", "tags": "telegram, bot, canal, automa√ß√£o, github, rss", "date": "2022-07-14 20:50:00 -0300", "snippet": "Envio autom√°tico de feed RSS no Telegram! Funciona com envios para pessoas, grupos e canais, p√∫blicos ou privados.Configura√ß√£oFa√ßa um fork do reposit√≥rio original, clicando em fork.Obrigat√≥riasV√° e...", "content": "Envio autom√°tico de feed RSS no Telegram! Funciona com envios para pessoas, grupos e canais, p√∫blicos ou privados.Configura√ß√£oFa√ßa um fork do reposit√≥rio original, clicando em fork.Obrigat√≥riasV√° em Settings, Secrets, Actions e crie a vari√°vel: BOT_TOKEN: Token do bot que far√° os envios. Fale com o @BotFather caso n√£o tenha um; DESTINATION: IDs ou @ de quem receber√° as mensagens; URL: Lista de urls dos feeds separados por v√≠rgulas. As vari√°veis DESTINATION e URL podem ser criadas em Secrets ou em arquivos .txt, prevalecendo o que estiver em Secrets. Ou seja, caso crie DESTINATION.txt ou URL.txt √© necess√°rio remover o respectivo Secret.Opcionais MESSAGE_TEMPLATE: Mensagem a ser enviada. Veja a lista de componentes abaixo; BUTTON_TEXT: Texto do bot√£o a ser enviado. Veja a lista de componentes abaixo; EMOJIS: Emojis que ser√£o sorteados aleatoriamente a cada envio. Lista pr√©-definida:üóû,üì∞,üóí,üóì,üìã,üîó,üìù,üóÉ; PARAMETERS: Par√¢metros a serem acrescentados ao link. Exemplo: utm_source=telegram&amp;utm_medium=telegrammessage&amp;utm_campaign=rss2telegram. ComponentesTanto o corpo da mensagem quanto o bot√£o podem conter textos, emojis e/ou um dos componentes pr√©-definidos. {SITE_NAME} Cont√©m o nome do site; {TITLE} √â o t√≠tulo do post; {SUMMARY} Corpo do texto do t√≥pico do RSS; {LINK} Link para o post completo; {EMOJI} Emojis que ser√£o sorteados aleatoriamente no momento do envio. Crie sua lista de emojis na vari√°vel EMOJIS. FiltrosPor padr√£o, todos o conte√∫do do feed √© enviado. Para criar regras de filtros, crie um arquivo chamado RULES.txt e adicione as regras conforme a necessidade. As regras ser√£o lidas em ordem! O valor de termo independe de min√∫sculas ou mai√∫sculasACCEPT:ALL: Todas as mensagens ser√£o enviadas;DROP:ALL: Todas as mensagens n√£o ser√£o enviadas;ACCEPT:termo: A mensagem ser√° enviada se termo estiver presente;DROP:termo: A mensagem n√£o ser√° enviada se termo estiver presente.A√ß√£oAjustadas as vari√°veis, v√° em Actions, Select workflow e clique em Enable workflow. A a√ß√£o ir√° rodar a cada 1 hora para verificar as atualiza√ß√µes.Para alterar o intervalo da a√ß√£o basta alterar o arquivo .github/workflows/cron.yml.Exemplos:- cron: '0 */1 * * *': Faz a a√ß√£o ser executada uma vez por hora;- cron: '*/15 * * * *': Faz a a√ß√£o ser executada uma vez a cada quinze minutos.Exemplos de mensagensMensagem padr√£oMensagem padr√£oMESSAGE_TEMPLATE: N√£o definido;BUTTON_TEXT: N√£o definido.Mensagem padr√£o com bot√£o definidoMensagem padr√£o com bot√£o definidoMESSAGE_TEMPLATE: {EMOJI}{TITLE};BUTTON_TEXT: {TITLE}.Mensagem padr√£o com link no textoMensagem padr√£o com link no textoMESSAGE_TEMPLATE: {EMOJI}&lt;b&gt;{TITLE}&lt;/b&gt;\\n\\n{LINK};BUTTON_TEXT: N√£o definido.Exemplos de filtrosTodos as mensagens ser√£o enviadas, menos as que tiverem o termo pol√≠ticaConte√∫do de RULES.txt:ACCEPT:ALLDROP:Pol√≠ticaNenhuma mensagem ser√° enviada, com exce√ß√£o das mensagens com os termos futebol e v√¥leiConte√∫do de RULES.txt:DROP:ALLACCEPT:futebolACCEPT:v√¥leiObserva√ß√µes Bot somente envia mensagem para pessoas que j√° falaram com ele. Ou seja, √© necess√°rio que a pessoa tenha clicado ao menos uma vez em Iniciar para que o bot consiga enviar uma mensagem. Bot somente entra em canais como administrador. ParticipeEntre na aba Discussions no GitHub e vamos conversar sobre o projeto!" }, { "title": "Bot do PromoPassagens autom√°tico e gr√°tis!", "url": "/posts/PromoPassagens/", "categories": "Telegram, Bot", "tags": "telegram, bot, canal, automa√ß√£o, github", "date": "2022-06-12 12:00:00 -0300", "snippet": " Automa√ß√£o do canal PromoPassagens com posts de lista do Twitter.O canal PromoPassagens re√∫ne as postagens de uma lista do Twitter em um canal do Telegram de forma autom√°tica. Os posts s√£o formata...", "content": " Automa√ß√£o do canal PromoPassagens com posts de lista do Twitter.O canal PromoPassagens re√∫ne as postagens de uma lista do Twitter em um canal do Telegram de forma autom√°tica. Os posts s√£o formatados para um padr√£o e as cidades recebem #hashtags para facilitar buscas.Link do reposit√≥rio: github.com/GabrielRF/PromoPassagensFuncionamentoO c√≥digo e a automa√ß√£o s√£o hospedados no GitHub e n√£o dependem de nenhum servi√ßo externo. A cada quinze minutos √© executada uma a√ß√£o do GitHub que se encarrega de todo o processo automaticamente. O reposit√≥rio pode ser p√∫blico ou privado, com a diferen√ßa que reposit√≥rios privados possuem uma limita√ß√£o na quantidade de execu√ß√µes. Para mais informa√ß√µes, verifique aqui as condi√ß√µes dos planos.Configura√ß√£oA√ß√£oA a√ß√£o √© definida no arquivo .github/workflows/cron.yml. workflow_dispatch permite que a a√ß√£o seja executada manualmente caso necess√°rio, sem precisar ficar aguardando o intervalo; cron: '*/15 * * * *' define que a a√ß√£o deve ser executada a cada quinze minutos. N√£o recomendo usar intervalos menores que 10 minutos; actions/checkout@v2 faz a a√ß√£o obter o c√≥digo do reposit√≥rio; actions/setup-python@v2 instala python na m√°quina que executa a a√ß√£o; run: pip install -r requirements.txt instala as bibliotecas necess√°rias para o script python funcionar; run: python promopassagens.py executa o script que faz todo o processo; env permite que o script visualize as vari√°veis de ambiente definidas como secrets. Arquivos de configura√ß√£oAs cidades s√£o listadas em cities.txt. Cada cidade deve ocupar uma linha.O arquivo blocklist.txt possui uma lista de palavras que fazem a postagem ser ignorada. Basta uma delas estar presente para que a mensagem n√£o v√° para o canal.Vari√°veis de ambienteNas configura√ß√µes do reposit√≥rio acesse Secrets &gt; Actions. Crie as vari√°veis: BOT_TOKEN: Token do bot que enviar√° as mensagens no canal. Fornecido pelo @BotFather; DESTINATION: Canal p√∫blico que receber√° as mensagens. Exemplo: PromoPassagens (n√£o use @!); TWITTER_ACCESS_SECRET: Valor fornecido pelo Twitter; TWITTER_ACCESS_TOKEN: Valor fornecido pelo Twitter; TWITTER_CONSUMER_KEY: Valor fornecido pelo Twitter; TWITTER_CONSUMER_SECRET: Valor fornecido pelo Twitter; TWITTER_OWNER: Perfil criador da lista no Twitter. Exemplo: GabRF; TWITTER_SLUG: Slug da lista no Twitter. Exemplo: canal-promopassagens.Limita√ß√£oInfelizmente n√£o √© poss√≠vel usar esta solu√ß√£o em canais privados. Toda sugest√£o √© bem vinda!" }, { "title": "Atendimento a clientes usando Telegram", "url": "/posts/ClientesChat/", "categories": "Telegram, Bot", "tags": "telegram, bot, clienteschatbot, sac, atendimento", "date": "2021-12-14 12:00:00 -0300", "snippet": " Como ter uma equipe de atendimento e manter organizadas as conversas com os clientes?Uma solu√ß√£o de c√≥digo aberto que auxilia no atendimento e na organiza√ß√£o das conversas com seus clientes.O ser...", "content": " Como ter uma equipe de atendimento e manter organizadas as conversas com os clientes?Uma solu√ß√£o de c√≥digo aberto que auxilia no atendimento e na organiza√ß√£o das conversas com seus clientes.O servi√ßo √© composto por tr√™s partes: Bot: Por onde as pessoas entram em contato. Do ponto de vista do usu√°rio, a conversa √© sempre feita via bot. Canal: A equipe de atendimento faz tudo pelo canal, usando os coment√°rios. Grupo: Serve para ativar os coment√°rios no canal e tem tamb√©m a funcionalidade de ser um log de tudo.Em resumo: As pessoas (clientes) devem interagir com o bot e a equipe de atendimento com o canal, usando os coment√°rios. O grupo √© limitado a quem o criou e ao bot apenas.AtendimentoDo ponto de vista da equipe de atendimento, as conversas ficam separadas em t√≥picos no canal. Diferentes pessoas podem fazer o atendimento simultaneamente, sendo transparente para quem est√° sendo atendido.J√° para quem recebe o atendimento, tudo vem com o nome e a marca da empresa, pois a conversa √© feita atrav√©s do bot.Edi√ß√£o e Remo√ß√£o de Conte√∫doA conversa n√£o some. A √∫nica possibilidade de uma tela ser limpa √© se algu√©m manualmente apagar algo. Por√©m, a exclus√£o de conte√∫do ocorre somente do lado que a executou. Ou seja, se um atendente remove a conversa, quem √© atendido continua com todo o hist√≥rico perfeito. Se a pessoa excluiu ou bloqueou o bot, a conversa tamb√©m permanece intacta do lado da equipe de atendimento.As mensagens editadas s√£o editadas dos dois lados. Uma mensagem editada pela pessoa atendida √© alterada tamb√©m na vis√£o da equipe de atendimento e uma mensagem editada pela equipe tamb√©m √© alterada na vis√£o do cliente1.Dados PessoaisDe acordo com o funcionamento do Telegram, as informa√ß√µes vis√≠veis ao bot s√£o apenas nome, sobrenome e ID, dados que s√£o exibidos para a equipe de atendimento assim que a pessoa envia a primeira mensagem ao bot. Nenhuma outra informa√ß√£o √© coletada automaticamente. Qualquer outro dado deve ser solicitado durante a conversa.Respostas ProntasPensando na agilidade do atendimento, h√° um m√≥dulo de Respostas Prontas presente no bot! As respostas prontas funcionam em modo inline. Ou seja, a equipe de atendimento2 pode us√°-las em qualquer chat, basta escrever no campo de envio de mensagens o @usuario do bot e selecionar a resposta a ser enviada. Os termos escritos ap√≥s @usuario servem para filtrar respostas, exibindo apenas as respostas que cont√©m o argumento desejado. Uso de Respostas ProntasMais informa√ß√µesVisite o site Clientes.Chat Seguindo as regras do pr√≥prio Telegram, a edi√ß√£o pode ocorrer somente nas primeiras 48 horas ap√≥s o envio da mensagem. Telegram.org¬†&#8617; As Respotas Prontas somente funcionam para a equipe de atendimento. Outras pessoas recebem como resposta um link para receber atendimento.¬†&#8617; " }, { "title": "Anuncie no Telegram", "url": "/posts/AnuncieAquiBot/", "categories": "Telegram, Bot", "tags": "telegram, bot, anuncieaquibot, propaganda, an√∫ncio", "date": "2021-10-27 14:00:00 -0300", "snippet": "O AnuncieAquiBot √© a maneira mais f√°cil e barata de ter visibilidade no Telegram!Os an√∫ncios s√£o postados em tr√™s outros bots, nas situa√ß√µes: RastreioBot - Movimenta√ß√£o de pacote1; Send2KindleBot...", "content": "O AnuncieAquiBot √© a maneira mais f√°cil e barata de ter visibilidade no Telegram!Os an√∫ncios s√£o postados em tr√™s outros bots, nas situa√ß√µes: RastreioBot - Movimenta√ß√£o de pacote1; Send2KindleBot - Envio de documento2; Pic2GifBot - In√≠cio de cria√ß√£o de gif.As contrata√ß√µes s√£o feitas pela quantidade de pessoas que receber√£o o an√∫ncio. Enquanto o an√∫ncio est√° em andamento, √© poss√≠vel que uma mesma pessoa receba o an√∫ncio mais de uma vez, n√£o afetando a contagem dos envios.Como criar um an√∫ncioTodo o processo de cria√ß√£o de um an√∫ncio √© feito diretamente com o bot. Envie o comando /criar e siga as etapas. Exemplo de an√∫ncioPasso 1:Envie o texto do an√∫ncio, o corpo da mensagem que ser√° exibida. Este texto dever√° ter no m√°ximo 200 caracteres.Passo 2:Envie um texto para o bot√£o que conter√° o link. Este campo pode ter no m√°ximo 25 caracteres.Passo 3:Envie o link do bot√£o contendo http ou https.Andamento dos an√∫nciosPara consultar quantas pessoas j√° viram seu an√∫ncio, basta enviar /listar. O bot responder√° o andamento de cada an√∫ncio, mostrando a quantidade enviada e a quantidade contratada.DicasUse emojis!Chamam bastante a aten√ß√£o e servem como um guia para os locais em que devem ser lidos e mais facilmente encontrados, como o texto do bot√£o.Crie links √∫nicosPara links do Telegram, crie um links de convite e saiba quantos cliques aconteceram em seu an√∫ncio. Exemplo de an√∫ncioPara links fora do Telegram, utilize encurtadores de links ou par√¢metros UTM3 para saber o alcance obtido com o uso do servi√ßo. Os status do RastreioBot s√£o postados uma vez por dia no Twitter, https://twitter.com/RastreioBot¬†&#8617; O an√∫ncio somente √© enviado para pessoas com o app em portugu√™s brasileiro (pt-br).¬†&#8617; Para saber mais sobre par√¢metros UTM, leia: https://blog.gabrf.com/posts/TelegramInfluencer/¬†&#8617; " }, { "title": "RastreioBot - Primeiro milh√£o de pacotes", "url": "/posts/RastreioBot1M/", "categories": "Telegram, Bot", "tags": "telegram, bot, rastreiobot", "date": "2021-10-20 12:30:00 -0300", "snippet": " https://rastreiobot.xyzCriado em 03 de Julho de 2015, o RastreioBot precisou de 2295 dias para alcan√ßar a marca de 1.000.000 pacotes rastreados. Aproximadamente 400.000 pacotes foram rastreados s...", "content": " https://rastreiobot.xyzCriado em 03 de Julho de 2015, o RastreioBot precisou de 2295 dias para alcan√ßar a marca de 1.000.000 pacotes rastreados. Aproximadamente 400.000 pacotes foram rastreados s√≥ nos √∫ltimos seis meses!1Muito obrigado a todas as pessoas que me ajudaram com o bot, seja fazendo coment√°rios, cr√≠ticas, ajudando com a programa√ß√£o ou at√© com doa√ß√µes. A soma de tudo isto trouxe o bot ao primeiro milh√£o de pacotes.https://telegram.me/RastreioBotHist√≥ria Logo antigo do RastreioBot.Id√©ia inicialO bot foi criado com um √∫nico objetivo, reduzir consultas no site dos Correios.A primeira vers√£o era bastante simples. N√£o tinha banco de dados nem enviava alertas. Tudo o que o bot fazia era salvar a √∫ltima mensagem recebida em um arquivo de texto .txt e exibir um bot√£o /Repetir que, quando clicado, retornava o status dispon√≠vel no sistema dos Correios. Ou seja, se a pessoa tivesse mais de um pacote, al√©m de o bot ter salvo somente o √∫ltimo enviado, o bot n√£o enviava nenhum alerta a menos que fosse consultado.O bot rodava em um Raspberry Pi 3, em casa mesmo, onde ficou durante muitos anos. Pilha de Raspberry Pi.Evolu√ß√£oSomente em Feveiro de 2017 o bot come√ßou a engatinhar para a vers√£o atual. Foi aberto um novo reposit√≥rio e foi criado o primeiro banco de dados. Principais novidades: Uso de banco de dados; Alertas de movimenta√ß√µes; Possibilidade de descrever os pacotes.Rapidamente as avalia√ß√µes do bot melhoraram e ele come√ßou a aparecer entre os 10 melhores (em portugu√™s) no antigo sistema de vota√ß√£o de bots, o StoreBot. Foi nesta vers√£o tamb√©m que comecei a receber as colabora√ß√µes de c√≥digo do meu amigo Marco Rougeth, que at√© hoje me salva com o Python. Site do StoreBot.Limite de pacotesEm abril de 2017 o bot atingiu a quantidade de 100 pacotes rastreados simultaneamente. Neste momento o site dos Correios passou a bloquear meu IP, pois eram muitas consultas. Quando o IP era bloqueado, demorava demais a voltar a funcionar. Migrei ent√£o para a API oficial dos Correios2, que √© usada at√© hoje.2018Em 2018 passei a receber mais colabora√ß√µes com o c√≥digo do bot, recebendo ajuda de diversas pessoas. Dentre elas, mais um amigo que me ajuda at√© hoje, o Bigua. Foi com a ajuda dele que come√ßamos a fazer sprints do bot, rapidamente reescrevendo o que precisava de mudan√ßas. Foi ele tamb√©m que come√ßou a organizar o c√≥digo para facilitar a integra√ß√£o de outras plataformas, dando in√≠cio ao uso da TrackingMore, plataforma para rastrear pacotes fora do Brasil. No mesmo ano participei da PyCon3, apresentando um poster e contando um pouco da hist√≥ria do bot. Participa√ß√£o na PyCon 2018.Foi neste ano tamb√©m que recebi de presente a atual arte do bot. Obrigado, Pedro Hartmann.T√° pegando fogo, bichoUm inc√™ndio em uma subesta√ß√£o da Companhia Energ√©tica de Bras√≠lia (CEB) em 2019 fez o Raspberry Pi do bot desligar abruptamente, corrompendo o cart√£o de mem√≥ria4. Ao tentar restaurar o backup, notei que o backup estava sendo feito incorretamente. Infelizmente, o banco de dados do bot foi perdido. Para evitar futuros problemas, neste momento o bot foi movido para a nuvem, para uma m√°quina virtual na ScaleWay. O backup foi corrigido e mantido na Amazon, em um bucket S3. Fogo em subesta√ß√£o da CEB. Imagem da CBN Bras√≠lia.O bot e a pandemiaO bot n√£o para de crescer. Com a pandemia, as compras online aumentaram bastante e, consequentemente, o uso do bot explodiu. Em 2021 o bot precisava verificar mais de 75.000 pacotes de uma vez s√≥, precisando de quase uma hora para concluir a rotina. Com a ajuda do Rougeth, esse n√∫mero foi reduzido para incr√≠veis tr√™s minutos, otimizando as verifica√ß√µes ass√≠ncronas e diminuindo o atraso entre a movimenta√ß√£o do pacote e o envio da mensagem para a pessoa.Primeiro milh√£oNo dia 13 de Outubro de 2021, pela manh√£, o bot atingiu a marca de 1.000.000 pacotes rastreados desde a sua cria√ß√£o. O bot foi constru√≠do em Python e as pessoas da comunidade Python Brasil s√£o grandes respons√°veis pelos avan√ßos na programa√ß√£o do bot. Alcan√ßar esse recorde durante a Python Brasil 2021 foi muito simb√≥lico, tendo sido registrado mais tarde em uma palestra rel√¢mpago durante o evento.Muito obrigado a todas as pessoas que me ajudaram e me ajudam!E vamos ao segundo milh√£o! üöÄ Diariamente os status do bot s√£o postados no Twitter. @RastreioBot¬†&#8617; API dos Correios: https://www.correios.com.br/atendimento/ferramentas/sistemas/arquivos/web-service-de-rastreamento¬†&#8617; Maior confer√™ncia de Python no mundo, ocorre anualmente. https://pycon.org/¬†&#8617; Post no Medium sobre o problema: https://medium.com/@gabrielrf/socorro-meus-pacotes-sumiram-e6ecf6b153ab¬†&#8617; " }, { "title": "Como obter IDs no Telegram", "url": "/posts/TelegramID/", "categories": "Telegram, Curiosidades", "tags": "telegram, bot", "date": "2021-07-27 13:30:00 -0300", "snippet": " Post para desenvolvedores.Antes de mais nada‚Ä¶ Pessoas: Sempre com ID positivo; Canais: Sempre com ID negativo; Grupos: Sempre com ID negativo. Caso seja um supergrupo1, comecar...", "content": " Post para desenvolvedores.Antes de mais nada‚Ä¶ Pessoas: Sempre com ID positivo; Canais: Sempre com ID negativo; Grupos: Sempre com ID negativo. Caso seja um supergrupo1, comecar√° com -100. Telegram WebEste m√©todo sempre funciona, n√£o importa qual seja o chat.Abra as informa√ß√µes do chat, n√£o importa se √© pessoa, grupo ou canal. Perfil do DicasChat.Use o inspetor de c√≥digo e encontre a div &lt;div class=\"profile-name\"&gt;. C√≥digo HTML do Telegram Web.O ID estar√° presente em data-peer-id.Como sei que o grupo do exemplo √© um supergrupo1, o ID correto √© -1001055895627.Usando seu pr√≥prio botPara este m√©todo funcionar, √© necess√°rio que a pessoa fale com o bot ou que o grupo fa√ßa parte do grupo/canal em que se deseja obter o ID.Acesse o endere√ßo https://api.telegram.org/bot158700146:AAHOPReqqTR8V7FXysa8mJCbQACUWSTBog8/getUpdates, colocando o token do seu bot.Caso queira o ID de um grupo ou canal, basta verificar em chat id. No exemplo, o canal @PromoPassagens tem o ID -1001002634335. JSON de um bot exibindo chat.id.Caso esteja buscando o ID de uma pessoa, basta verificar em from id. O meu ID, como mostrado no exemplo, √© 9083329. JSON de um bot exibindo from.id.Usando bots no Telegram N√£o funcionam para: Pessoas com a op√ß√£o de privacidade em mensagens encaminhas ligada; Grupos privados; Canais privados. @ShowJsonBotEncaminhe a mensagem da pessoa, do grupo ou do canal para o bot e veja na resposta o ID. No caso, a mensagem encaminhada foi do canal @DicasTelegram, cujo ID √© -1001029093254. A resposta do bot √© bem completa, mostrando o ID de quem enviou a mensagem para o bot, no caso 9083329, e mais algumas informa√ß√µes que podem ser √∫teis. Show Json Bot@UserInfoBotEncaminhe a mensagem da pessoa, grupo ou canal para o bot e ele responder√° com o ID. userinfobot O Telegram deixou transparente para o usu√°rio a mudan√ßa de grupo para supergrupo. Para ler mais, clique aqui.¬†&#8617;¬†&#8617;2 " }, { "title": "Automa√ß√£o residencial: Como fazer uma planta baixa no HomeAssistant", "url": "/posts/HomeAssistantBluePrint/", "categories": "Automa√ß√£o Residencial, Home Assistant", "tags": "automa√ß√£o, hass, homeassistant, plantabaixa", "date": "2021-07-23 19:30:00 -0300", "snippet": "InterfaceUm dos pontos que mais chamam a aten√ß√£o na interface do Home Assistant √© a possibilidade de se ter uma planta baixa do im√≥vel, que exibe, em tempo real, o estado dos dispositivos inteligen...", "content": "InterfaceUm dos pontos que mais chamam a aten√ß√£o na interface do Home Assistant √© a possibilidade de se ter uma planta baixa do im√≥vel, que exibe, em tempo real, o estado dos dispositivos inteligentes. √â uma maneira simples e bonita de se controlar tudo.Cart√£oO cart√£o correto a ser utilizado √© o picture-elements, cuja documenta√ß√£o est√° dispon√≠vel no site oficial.image: /local/planta/planta_completa.pngtype: picture-elementstitle: Luzes type: Tipo de cart√£o. image: A imagem que ser√° colocada no fundo. A imagem deve ser colocada em uma pasta chamada www na ra√≠z do Home Assistant, mesmo local em que fica o configuration.yml. title: T√≠tulo do cart√£o.ElementosCada objeto colocado na imagem √© um elemento, que cont√©m uma entidade j√° configurada em seu Home Assistant. O primeiro exemplo √© uma l√¢mpada com os estados mostrados em diferentes imagens. J√° o segundo √© uma l√¢mpada ilustrada com um √≠cone, que muda de cor de acordo com o funcionamento. Por fim, o terceiro √© um √≠cone que, ao ser clicado, liga uma televis√£o.elements: - entity: switch.sonoff1 type: image state_image: 'off': /local/off.png 'on': /local/on.png style: left: 40% top: 50% width: 100% - entity: switch.sonoff2 icon: mdi:car style: left: 80% top: 70% tap_action: action: toggle type: state-icon - entity: remote.sala icon: mdi:power-cycle style: '--iron-icon-height': 40px '--iron-icon-width': 40px color: red left: 10% top: 10% tap_action: action: call-service service: remote.send_command service_data: command: turn_on delay_secs: 0.75 device: lg entity_id: remote.sala hold_secs: 1 num_repeats: 1 entity: A entidade a ser exibida tap_action: A√ß√£o ao tocar. toggle faz inverter o estado atual (ligar/desligar). call-service: Executa o servi√ßo. Consulte a configura√ß√£o de acordo com o servi√ßo para preencher os dados necess√°rios. type: O que √© exibido. image para imagem off: Imagem a ser exibida quando entidade estiver desligada. on: Imagem exibida quando ligar a entidade. state-icon para √≠cone. O √≠cone pode ser definido em icon ou nas customiza√ß√µes. style: Personaliza√ß√£o do √≠cone ou da imagem. left: Dist√¢ncia do canto esquerdo medido em porcentagem (%). top: Dist√¢ncia do topo em porcentagem (%). color: Cor do √≠cone. ExemploOutro uso do picture-elements √© a cria√ß√£o de controles diversos. Abaixo um exemplo de controle remoto simples para tv, com parte do YAML mostrando como foi feito. O servi√ßo usado parte de um dispositivo Broadlink Mini IR, que funciona como um controle remoto infravermelho. Exemplo de controle remoto usando Picture Elements.image: /local/background.pngtitle: TV LGtype: picture-elementselements: - entity: remote.sala type: icon icon: mdi:power-cycle style: '--iron-icon-height': 40px '--iron-icon-width': 40px color: red left: 10% top: 10% tap_action: action: call-service service: remote.send_command service_data: command: turn_on delay_secs: 0.75 device: lg entity_id: remote.sala hold_secs: 1 num_repeats: 1 - entity: remote.sala type: icon icon: mdi:numeric-0 style: '--iron-icon-height': 40px '--iron-icon-width': 40px color: black left: 80% top: 50% tap_action: action: call-service service: remote.send_command service_data: command: 0 delay_secs: 0.75 device: lg entity_id: remote.sala hold_secs: 1 num_repeats: 1" }, { "title": "Automa√ß√£o residencial: MQTT", "url": "/posts/MQTT/", "categories": "Automa√ß√£o Residencial, MQTT", "tags": "automa√ß√£o, mqtt, hass, homeassistant, broker", "date": "2021-06-29 14:00:00 -0300", "snippet": " Message Queuing Telemetry Transport.MQTT √© um protocolo de mensagens feito pela IBM para a internet das coisas, IoT. Foi desenhado para ser extremamente leve, possuindo duas fun√ß√µes b√°sicas, publ...", "content": " Message Queuing Telemetry Transport.MQTT √© um protocolo de mensagens feito pela IBM para a internet das coisas, IoT. Foi desenhado para ser extremamente leve, possuindo duas fun√ß√µes b√°sicas, publicar (publish) e inscrever-se/assinar (subscribe). √â ideal para ser usado em dispositivos com pequeno poder de processamento, pouca banda dispon√≠vel e alimenta√ß√£o energ√©tica limitada (baterias).BrokerO broker √© o centro do MQTT. √â a parte respons√°vel por receber todas as mensagens e mant√™-las dispon√≠veis para os assinantes. Tem seu funcionamento baseado em t√≥picos, em que cada t√≥pico normalmente carrega uma informa√ß√£o espec√≠fica. Para simplificar, gosto de pensar que o broker √© um enorme quadro de avisos, em que cada coluna representa um t√≥pico.AssinantesOs dispositivos assinantes s√£o aqueles que l√™em e escrevem as informa√ß√µes no broker. √â considerada uma boa pr√°tica escrever informa√ß√µes em um t√≥pico e ler as informa√ß√µes de outro.Tomemos como exemplo uma porta: Sala/Porta/Estado √© o t√≥pico respons√°vel por armazenar a informa√ß√£o se a porta est√° aberta ou fechada. Sala/Porta/Comando √© o t√≥pico respons√°vel dizer √† porta se ela deve executar o comando de abrir ou fechar. Ou seja, dentro do t√≥pico Sala h√° o subt√≥pico Porta, que √© subdividido em outros dois, Estado e Comando. Tal divis√£o torna-se bastante √∫til para manter o sistema organizado e tamb√©m para n√£o ocorrer confus√£o ou erros com os comandos. Por exemplo, pode ser interessante que uma l√¢mpada seja capaz de acompanhar o Estado da porta, tendo seu acendimento simult√¢neo √† abertura da porta. Ao mesmo tempo, n√£o √© interessante que esta luz seja capaz de mandar o Comando para a porta abrir. Com a divis√£o correta dos t√≥picos tal erro √© evitado.Fun√ß√µesPublish√â a fun√ß√£o publicar. √â usando esta fun√ß√£o que uma informa√ß√£o √© escrita no broker e torna-se dispon√≠vel para todos que podem ler aquele t√≥pico.√â interessante conhecer a op√ß√£o retain para mensagens publicadas. Com tal op√ß√£o ligada, a mensagem permanece dispon√≠vel no t√≥pico at√© que outra mensagem a substitua. Isto √© extremamente √∫til para evitar que um dispositivo fique sem informa√ß√£o alguma caso tenha se conectado a um t√≥pico sem assinantes, caso em que as mensagens s√£o automaticamente descartadas.SubscribeUsando-se a fun√ß√£o de assinar, um dispositivo torna-se capaz de acompanhar um t√≥pico e ler tudo o que for escrito nele. Caso um dispositivo precise ler mais de um t√≥pico, √© necess√°rio assinar cada t√≥pico deles individualmente ou assinar o t√≥pico acima, para casos de subt√≥picos.Instala√ß√£oEclipse Mosquitto (broker) Mosquitto e alguns clientes.√â um programa de c√≥digo aberto que funciona como broker MQTT. √â de f√°cil instala√ß√£o e funciona muito bem com o Home Assistant, estando dispon√≠vel tamb√©m como addon. Mesmo que normalmente usado apenas em LAN, recomendo sempre o uso de autentica√ß√£o com usu√°rio e senha para acessar o Mosquitto.Como addon, basta ir na lista do Home Assistant e instalar o Mosquitto broker. Nas configura√ß√µes ap√≥s a instala√ß√£o √© poss√≠vel definir login e senha.O Mosquitto pode ser instalado via snap ou Docker. Para mais informa√ß√µes, consulte https://mosquitto.org/download/.Paho MQTT (cliente)Para a configura√ß√£o de clientes usando Python, recomendo a biblioteca Paho-MQTT.PubSubClient (cliente)Caso esteja usando para clientes Arduino, NodeMCU ou ESP826, recomendo a biblioteca PubSubclient.Tasmota (cliente) Tela inicial do Tasmota.Por fim, caso esteja usando ESP8266 ou at√© dispositivos de marcas como Sonoff, √© poss√≠vel utilizar o firmware Tasmota. Solu√ß√£o excelente para quem quer fugir dos firmwares estrangeiros e querem manter o controle total sobre seus dispositivos, n√£o dependendo de entes na nuvem ou de empresas privadas. Por permitir que a configura√ß√£o seja feita OTA (over the air), esta solu√ß√£o √© bastante interessante e confi√°vel, al√©m de f√°cil manuten√ß√£o." }, { "title": "Como fazer bots para o Telegram", "url": "/posts/HowToBot/", "categories": "Telegram, Bot", "tags": "telegram, bot, how-to, dev, python", "date": "2021-06-25 10:40:00 -0300", "snippet": " Conte√∫do apresentado na 58¬∫ Python Floripa: https://youtu.be/Av2Mv3FVkdI?t=4120Um bot no Telegram nada mais √© que um programa de computador que segue uma receita de funcionamento, um algoritmo. P...", "content": " Conte√∫do apresentado na 58¬∫ Python Floripa: https://youtu.be/Av2Mv3FVkdI?t=4120Um bot no Telegram nada mais √© que um programa de computador que segue uma receita de funcionamento, um algoritmo. Para funcionar √© necess√°rio que seu rob√¥ interaja com os servidores do Telegram. As instru√ß√µes de como esta comunica√ß√£o √© feita √© chamada de API, que pode ser entendida como uma interface de programa√ß√£o de aplica√ß√£o, dispon√≠vel em https://core.telegram.org/bots/api.Mas, antes de mais nada, vamos do in√≠cio‚Ä¶BotFather√â aqui que tudo come√ßa. √â o pai dos bots. Todo bot, sem exce√ß√£o, √© criado falando-se com o BotFather. Logo do BotFatherInicialmente envia-se o comando /newbot. Ser√° solicitado um nome para o bot e, em seguida, um nome de usu√°rio (o @ alguma coisa), que deve ser √∫nico e terminar com a palavra bot.O BotFather te fornecer√° um token, que deve ser mantido em segredo. √â usando o token que ser√° feita a comunica√ß√£o com os servidores do Telegram, seja para enviar mensagens usando o bot, seja para ler as mensagens que o bot recebeu. Tendo o token √© poss√≠vel ler todo o hist√≥rico do bot, por isto √© t√£o importante guard√°-lo em segredo.√â tamb√©m no BotFather que √© definida a imagem do bot, sua descri√ß√£o e o campo ‚Äúsobre este bot‚Äù. Fun√ß√µes avan√ßadas, como o funcionamento inline e da plataforma de pagamentos tamb√©m s√£o ajustadas via BotFather. Ou seja, mexer neste bot √© parte do dia-a-dia de quem cria e mant√©m bots.Alguns dos principais comandos dispon√≠veis no BotFather: /newbot: Criar um novo bot (m√°ximo de 20 bots por conta). /mybots: Listar bots criados. /setname: Alterar nome (sem alterar o @). /setdescription: Alterar descri√ß√£o (texto exibido antes do primeiro uso do bot). /setabouttext: Alterar texto presente na bio. /setuserpic: Alterar imagem do bot. /setcommands: Ajustar comandos dispon√≠veis no menu. /deletebot: Apagar bot. /token: Ver token. /revoke: Expirar token antigo e gerar um novo. /setjoingroups: Definir se um bot pode entrar em grupos. /setprivacy: Ajustar a privacidade de um bot em grupos.ID no Telegram O token usado aqui √© fict√≠cio. Leia a parte sobre BotFather para entender a import√¢ncia de manter seu token seguro.Antes de seguirmos com a explica√ß√£o, h√° um conceito simples e muito importante a ser explicado, o ID. Todo usu√°rio, grupo e canal possui um ID √∫nico. Pessoas possuem ID positivo, enquanto grupos e canais possuem IDs negativos. √â indiferente falar de ID para bots uma vez que um bot n√£o √© capaz de conversar com outro.O jeito mais simples de saber o ID de uma pessoa ou grupo √© encaminhando uma mensagem para os bots @userinfobot, @getidsbot ou abrindo o getUpdates do bot em um navegador pela URL: https://api.telegram.org/bot158700146:AAHOPReqqTR8V7FXysa8mJCbQACUWSTBog8/getUpdates, substituindo pelo token do seu bot.Send Message Para os exemplos deste post usarei a biblioteca PyTelegramBotApi, em Python.Come√ßando pelo mais simples, um bot n√£o precisa de muita coisa para enviar uma mensagem. O √∫nico requisito √© que a pessoa j√° tenha falado com o bot anteriormente ou que o bot fa√ßa parte do grupo/canal. Ou seja, um bot n√£o √© capaz de falar com quem nunca falou com ele nem enviar mensagens para grupos/canais que n√£o fa√ßa parte.import telebotTOKEN = \"158700146:AAHOPReqqTR8V7FXysa8mJCbQACUWSTBog8\"bot = telebot.TeleBot(TOKEN)destination = 9083329message = \"Ol√°! Tudo bem?\"bot.send_message(destination, message)Neste caso destination √© o ID que receber√° a mensagem e message √© o texto a ser enviado.Para adicionar formatac√£o ao texto, basta escolher entre HTML ou Markdown, adicionar a formata√ß√£o ao texto e colocar parse_mode=\"HTML\" ou parse_mode=\"Markdown\", como exemplificado abaixo:message = \"&lt;b&gt;Ol√°!&lt;/b&gt; Tudo bem?\"bot.send_message(destination, message, parse_mode=\"HTML\") Imagem com e sem formata√ß√£oPara saber todos os tipos de formata√ß√£o poss√≠veis, visite https://core.telegram.org/bots/api#formatting-options√â interessante notar que o envio de mensagens pode ser feito completamente separado do recebimento. Ou seja, √© poss√≠vel ter o mesmo bot enviando mensagens de diferentes locais, contextos ou m√°quinas. Isto √©, um bot pode ser usado para m√∫ltiplos envios, auxiliando a manter a quantidade de bots criados abaixo do limite de 20.WebhookWebhook seria o m√©todo avan√ßado para receber mensagens. Caso opte por us√°-lo, √© necess√°rio subir um servidor web com SSL para que o Telegram te envie uma requisi√ß√£o sempre que houver uma mensagem. Por se tratar de um m√©todo um pouco mais t√©cnico, n√£o irei abord√°-lo em detalhes aqui, pois n√£o √© o foco do blog.PollingM√©todo mais simples e r√°pido de fazer um bot receber mensagens. Neste m√©todo o bot vai at√© o Telegram perguntar se h√° atualiza√ß√µes, ao contr√°rio do Webhook. Como vantagem, o Polling tem uma configura√ß√£o extremamente simplificada e como desvantagem, costuma usar um pouco mais de rede para ficar fazendo as consultas.√â importante saber que pode existir somente um processo fazendo polling de um bot. Ou seja, n√£o √© poss√≠vel criar programas separados fazendo polling do mesmo bot. O pr√≥prio Telegram ir√° bloquear os processos excedentes caso isto ocorra.Echo botUm bot super simples, que repete as mensagens recebidas, pode ser feito com poucas linhas de c√≥digo:import telebotTOKEN = \"158700146:AAHOPReqqTR8V7FXysa8mJCbQACUWSTBog8\"bot = telebot.TeleBot(TOKEN)@bot.message_handler(func=lambda m: True)def text(message): bot.reply_to(message, message.text)bot.polling()Bot com comandosExemplo de bot que responde aos comandos /start e /pause, al√©m de responder ok a qualquer outra mensagem recebida.import telebotTOKEN = \"158700146:AAHOPReqqTR8V7FXysa8mJCbQACUWSTBog8\"bot = telebot.TeleBot(TOKEN)@bot.message_handler(commands=[\"start\"])def start(message): bot.send_chat_action(message.chat.id, 'typing') bot.send_message(message.chat.id, message.text)@bot.message_handler(commands=[\"pause\"])def pause(message): bot.send_chat_action(message.chat.id, 'typing') bot.send_message(message.chat.id, 'Parado')@bot.message_handler(func=lambda m: True)def text(message): bot.reply_to(message, 'ok')bot.polling()Repare a diferen√ßa entre o send_message e o reply_to. O primeiro simplesmente envia uma mensagem para a pessoa. J√° o segundo responde a mensagem, ou seja, mant√©m o contexto. Gosto bastante da segunda maneira, principalmente quando o bot √© usado em grupos. Ajuda a manter a organiza√ß√£o e notifica quem chamou o bot mesmo quando o grupo est√° silenciado.Neste exemplo coloquei tamb√©m o envio de a√ß√µes, o send_chat_action, que d√° caracter√≠stica de ‚Äúhumaniza√ß√£o‚Äù ao bot, fazendo o usu√°rio perceber que o bot recebeu a mensagem e est√° processando a resposta. Tal caracter√≠stica causa um efeito interessante, o de fazer as pessoas aguardarem um pouco antes de repetirem os comandos, evitando assim o envio excessivo de mensagens. Send Chat Action: TypingAs poss√≠veis a√ß√µes para um bot s√£o: typing: Escrevendo. upload_photo: Enviando uma foto. record_video: Gravando v√≠deo. upload_video: Enviando um v√≠deo. record_voice: Gravando mensagens de voz. upload_document: Enviando um arquivo. find_location: Escrevendo (n√£o traduzido adequadamente). record_video_note: Gravando mensagem de v√≠deo. upload_video_note: Enviando uma mensagem de v√≠deo.Onde hospedarUm bot pode ser hospedado basicamente em qualquer lugar! Inicialmente, at√© para testes mesmo, recomendo que fa√ßa o bot em sua pr√≥pria m√°quina para v√™-lo funcionando rapidamente, sem perder tempo de in√≠cio com a escolha de um servidor.Mantive por anos meus bots funcionando em Raspberry Pi. S√£o uma √≥tima solu√ß√£o para manter tudo funcionando a um custo baix√≠ssimo, pois o consumo de energia el√©trica √© impercet√≠vel na conta. Caso opte pela nuvem, as escolhas s√£o diversas, cada uma com suas vantagens e desvantagens. Migrei para a nuvem apenas quando o RPi n√£o deu mais conta.Os servi√ßos de nuvem que mais vejo as pessoas usando s√£o: Scaleway Digital Ocean Amazon AWS Google Cloud Heroku√â importante avaliar os custos e a dificuldade de se usar cada um deles.Grupo no TelegramDesenvolvimento de Bots" }, { "title": "Automa√ß√£o residencial: Introdu√ß√£o ao Home Assistant", "url": "/posts/HomeAssistant/", "categories": "Automa√ß√£o Residencial, Home Assistant", "tags": "automa√ß√£o, homeassistant, hass", "date": "2021-06-17 14:30:00 -0300", "snippet": " Integrando tudo.Home Assistant √© um software de c√≥digo aberto, gr√°tis e que pode ser executado em um Raspberry Pi, em um computador ou em um conteiner Docker. Sua principal fun√ß√£o √© integrar tudo...", "content": " Integrando tudo.Home Assistant √© um software de c√≥digo aberto, gr√°tis e que pode ser executado em um Raspberry Pi, em um computador ou em um conteiner Docker. Sua principal fun√ß√£o √© integrar tudo. Ele permite que diferentes dispositivos, de diferentes marcas, conversem e reajam juntos, conforme regras definidas pelo usu√°rio.Pode ser acessado via web ou por aplicativo. √â uma solu√ß√£o bem completa de automa√ß√£o, identificando desde o status dos dispositivos at√© se a pessoa est√° andando ou dirigindo (rastreando o celular). Permite ser totalmente personalizado, ajustando-se cada item da interface de controle.Dispositivos de hospedagemRaspberry PiO Raspberry Pi √© um computador do tamanho de um cart√£o de cr√©dito e baix√≠ssimo consumo energ√©tico. Pode ficar ligado 24 horas por dia e n√£o impactar praticamente nada na conta de luz. A partir da vers√£o 3 j√° √© capaz de rodar uma inst√¢ncia do Home Assistant sem maiores problemas.Caso opte por usar um Raspberry Pi, recomendo que use um dedicado ao Home Assistant. Basta baixar a imagem do sistema operacional j√° pronta no site, salvar em um cart√£o SD e ligar. Tudo estar√° preparado para ser usado.ComputadorO Home Assistant pode funcionar em um computador, como se fosse um programa comum. A grande vantagem deste m√©todo √© que computador, em geral, t√™m desempenho mais que suficiente para rodar uma inst√¢ncia de Home Assistant. A desvantagem √© o volume do equipamento e, dependendo do caso, o consumo energ√©tico. No caso de computadores, geralmente n√£o h√° problema em dar outros usos para m√°quina, n√£o precisando mant√™-la exclusivamente para o Home Assistant.Conteiner DockerA maneira mais avan√ßada. A √∫nica desvantagem √© que exige alguns conhecimentos t√©cnicos mais espec√≠ficos. Por√©m, permite melhor uso dos recursos computacionais, facilitando o uso compartilhado da m√°quina.Instala√ß√£oPara garantir sempre uma instala√ß√£o usando-se os recursos mais atualizados, recomendo sempre seguir o site oficial.https://www.home-assistant.io/installation/Selecione o tipo de instala√ß√£o e siga os passos descritos no site.Gloss√°rioTermos importantes:Hass: Abrevia√ß√£o de Home Assistant. √â o software em si.Home Assistant Supervisor: Parte respons√°vel pelo controle do Hass. Sua instala√ß√£o n√£o √© obrigat√≥ria, mas facilita muito para iniciantes.Hass.io: Home Assistant somando ao Supervisor. √â a solu√ß√£o pronta, que j√° cont√©m os addons a um clique de dist√¢ncia.Addons: Programas auxiliares ao Hass. Podem ser instalados tamb√©m separadamente, sem usar a op√ß√£o de addons. S√£o exemplos: NodeRed e Mosquitto (MQTT).HassOS: Sistema operacional. √â baixada uma imagem j√° completa, com o Hass e o Hass.io prontos.Home Assistant Core: Home Assistant que usa ambiente virtual Python.MQTT: Protocolo de mensagens muito √∫til para troca de informa√ß√µes entre dispositivos. A comunica√ß√£o acontece entre um cliente e um broker.Broker MQTT: Pode ser entendido como um mural de avisos. √â a parte respons√°vel por receber as mensagens e deix√°-las dispon√≠veis para os demais dispositivos. Geralmente usa-se um software chamado Mosquitto.Cliente MQTT: Dispositivo que l√™ e escreve no broker. S√£o exemplos de clientes l√¢mpadas, fechaduras, sensores etc.NodeRed: Software de desenvolvimento baseada em fluxos. Facilita a cria√ß√£o de automa√ß√µes e pode facilmente ser integrado ao Hass.ImagensExemplos de uso do Home Assistant.Controle de luzes√â poss√≠vel controlar as luzes com clique na imagem, clique no bot√£o ou at√© com automa√ß√µes. Controle de luzes no Home Assistant.Controle de televis√£oA integra√ß√£o com SmartTVs √© facilmente feita, n√£o exigindo nenhum hardware adicional. Importante notar que uma vez desligado o aparelho, o comando de ligar ir√° funcionar somente se a televis√£o estiver ligada √† rede usando-se um cabo. Pouqu√≠ssimas marcas aceitam o comando de ligar por wi-fi/sem fio. Controle de televis√£o Home Assistant.Informa√ß√µes gerais e contagem de tempo de usoOutro uso interessante do Home Assistant √© a contagem do tempo de uso dos equipamentos, permitindo at√© estimar o custo na conta de energia el√©trica. Usando-se ferramentas externas √© poss√≠vel estimar tempo no tr√¢nsito ou pre√ßo de moedas e a√ß√µes. Informa√ß√µes gerais Home Assistant." }, { "title": "Automa√ß√£o residencial: Tomadas e Interruptores", "url": "/posts/AutomationSwitch/", "categories": "Automa√ß√£o Residencial, Tomadas e Interruptores", "tags": "automa√ß√£o, interruptores, tomadas", "date": "2021-05-20 14:00:00 -0300", "snippet": " Jarvis, apague as luzes.O controle de luzes e de tomadas √© provavelmente a parte da automa√ß√£o residencial com mais op√ß√µes dispon√≠veis. Nesse post tentarei explicar os pontos que considero importa...", "content": " Jarvis, apague as luzes.O controle de luzes e de tomadas √© provavelmente a parte da automa√ß√£o residencial com mais op√ß√µes dispon√≠veis. Nesse post tentarei explicar os pontos que considero importantes para que seja feita a melhor escolha para a sua realidade.TomadasCome√ßando pelo mais f√°cil, a tomada costuma ser resolvida simplesmente acrescentando um dispositivo entre as conex√µes. O √∫nico ponto importante a ser observado √© a corrente m√°xima suportada pela tomada inteligente, que costuma ser 10A (2200W). Essa corrente costuma ser suficiente para a maior parte dos dispositivos dom√©sticos, mas dificilmente ser√° poss√≠vel utilizar em uma m√°quina de lavar roupas, em um chuveiro ou um forno el√©trico.Antes de comprar, verifique a compatibilidade do dispositivo. Prefira os dispositivos que integram com os assistentes de voz do Google e da Amazon (Alexa), pois estes potencialmente conversam com outros dispositivos que voc√™ possuir, permitindo integra√ß√µes muito interessantes, como apagar as luzes e as tomadas com um comando s√≥ ou at√© criar um cen√°rio em que alguns dispositivos s√£o ligados e outros desligados, permitindo uma melhor experi√™ncia ao assistir TV, por exemplo. Sonoff Smartplug no padr√£o brasileiro.InterruptoresSeparados em 3 categorias, os interruptores s√£o as partes que t√™m o potencial para serem as mais trabalhosas. A id√©ia da categoriza√ß√£o √© explicar separadamente as vantagens e desvantagens de cada abordagem. Externos s√£o os interruptores que ficam na parede mesmo, como interruptores que estamos acostumados. Remotos s√£o aqueles que funcionam como controle remoto, que n√£o ficam fixos na parede. Internos s√£o aqueles que ficam escondidos, dentro da parede ou atr√°s da base da l√¢mpada.ExternosOs interruptores externos entram no lugar do interruptor comum, sendo instalados nas caixas 4x4 ou 4x2. A √∫nica mudan√ßa de uma instala√ß√£o comum √© que os interruptores inteligentes necessitam de um Neutro chegando at√© eles para que funcionem. Ou seja, h√° a necessidade de se ter um fio a mais, al√©m dos comumente encontrados nos interruptores j√° instalados. Nestes casos, n√£o costuma ser complicado puxar o Neutro de uma tomada pr√≥xima ou at√© mesmo da l√¢mpada que ser√° controlada.Raramente estes modelos suportam o funcionamento em paralelo com outros interruptores, nas liga√ß√µes chamadas three way. Sonoff Smartplug no padr√£o brasileiro.RemotosMais vers√°teis, os interruptores remotos funcionam por sinais de r√°dio, emitindo sinais em 433MHz, Zigbee ou at√© Bluetooth. N√£o necessitam ficar em local fixo nem de alimenta√ß√£o externa (tomada). Por√©m, √© necess√°rio que exista um dispositivo capaz de receber e interpretar o sinal de r√°dio, podendo ser a pr√≥pria l√¢mpada, um interruptor (interno ou externo) ou at√© mesmo um dispositivo espec√≠fico para isto, os chamados bridges. Sonoff Controle Remoto 433MHz com suporte de parede.InternosInterruptores internos s√£o bons por n√£o afetarem a est√©tica, pois ficam ocultos. Ou seja, s√£o ligados nos interruptores j√° existentes no local. Assim como os externos, tamb√©m necessitam de um Neutro para que funcionem. H√° modelos, como o da imagem, que cabem em caixas 4x2, ocupando, dentro da caixa, o espa√ßo que seria de um interruptor comum. Alternativamente, esses interruptores podem ser instalados atr√°s do suporte da l√¢mpada, o que costuma ser mais f√°cil, pois ali j√° existem todos os fios necess√°rios para o funcionamento do dispositivo. Outro detalhe importante √© que h√° interruptores internos (como o da foto) que s√£o compat√≠veis com liga√ß√µes three way.Em resumo, interruptores internos s√£o os que n√£o causam mudan√ßa alguma na est√©tica do local, por√©m, s√£o os que apresentam maior desafio t√©cnico para ser instalado. O ideal √© que sejam instalados na fase de obra, pois tudo j√° fica pronto e oculto. Sonoff Mini.Conclus√£o e Recomenda√ß√£oPessoalmente gosto muito da marca Sonoff. S√£o dispositivos muito bem constru√≠dos e que s√£o compat√≠veis com in√∫meras solu√ß√µes dispon√≠veis no mercado. J√° de f√°brica s√£o compat√≠veis com assistentes de voz (Google e Alexa) e com aplicativos de celular, n√£o ficando restrito ao aplicativo do pr√≥prio fabricante. Caso seja do interesse, √© poss√≠vel tamb√©m alterar o firmware, eliminando assim a comunica√ß√£o do fabricante com o dispositivo.A marca oferece um amplo espectro de dispositivos. Dentre eles, destaco:Sonoff Mini: Interruptor interno. Pequeno, barato e compat√≠vel com liga√ß√µes three-way. Wi-fi.Sonoff D1: Dimmer para l√¢mpadas. Tamb√©m interno. N√£o cabe em caixas 4x2 nem √© compat√≠vel com three-way. Wi-fi.Sonoff RM433: Controle 433MHz para envio de comandos. 433MHz.Sonoff RF Bridge 433MHz: Bridge necess√°ria para receber os comandos do controle remoto e envi√°-los para os demais dispositivos. 433MHz e Wi-fi.Sonoff TX: Interruptor externo, sens√≠vel ao toque, para controle de l√¢mpadas. Wi-fi.Sonoff Smartplug S26: Controle de tomadas at√© 10A. Wi-fi." }, { "title": "Automa√ß√£o residencial: Fechadura digital e Controle de Acesso", "url": "/posts/AutomationDoor/", "categories": "Automa√ß√£o Residencial, Fechadura digital e Controle de acesso", "tags": "automa√ß√£o, fechadura, controlid, digital, senha, nfc", "date": "2021-05-19 17:00:00 -0300", "snippet": " Acesso autorizado.Primeiro √≠tem em uma automa√ß√£o residencial, o controle de acesso √© talvez a escolha mais complexa e que envolve analisar mais par√¢metros que qualquer outra solu√ß√£o.De in√≠cio √© i...", "content": " Acesso autorizado.Primeiro √≠tem em uma automa√ß√£o residencial, o controle de acesso √© talvez a escolha mais complexa e que envolve analisar mais par√¢metros que qualquer outra solu√ß√£o.De in√≠cio √© importante separar o que √© fechadura do que √© o equipamento de controle de acesso. H√° modelos que s√£o solu√ß√µes completas, mas este nem sempre √© o caso.Fechadura DigitalPode ser entendida como uma solu√ß√£o completa. √â comprado um kit completo, pronto para ser instalado. Possui todos os componentes, desde a leitora de biometria/teclado n√∫merico at√© o trinco que tranca efetivamente a porta.S√£o alimentadas por pilhas e s√£o de f√°cil instala√ß√£o. Raros modelos se conectam √† rede sem fio ou ao celular usando bluetooth. O mais comum √© que n√£o possuam conectividade, preservando as pilhas.Em caso de as baterias acabarem, possuem contatos externos em que basta encostar uma bateria 9V que a fechadura funcionar√° para que permita um acionamento, abrindo a porta. ControlID IDLock Bio. Parte externa (esq) e parte interna.Controle de AcessoSolu√ß√µes de controle de acesso t√™m como principal diferencial que as partes devem ser adquiridas separadamente. √â poss√≠vel, inclusive, misturar marcas. Ou seja, √© necess√°rio escolher qual ser√° o controle de acesso e tamb√©m qual ser√° a fechadura eletr√¥nica que ser√£o usados.Leitor biom√©tricoControle de acesso usando-se dados biom√©tricos. Geralmente √© feita a leitura da impress√£o digital, mas h√° modelos que conseguem verificar a face ou at√© mesmo a ir√≠s. S√£o solu√ß√µes muito seguras e que n√£o permitem compartilhamento. ControlID IDFlex Pro.SenhaO modelo mais comum. A pessoa digita uma senha em um teclado e a porta ser√° destravada. Intelbras FR210.Tag NFCEtiquetas de aproxima√ß√£o. Podem ser em formato de cart√£o, chaveiro, coleira, etiqueta etc. Basta aproximar da leitora e o acesso ser√° permitido. Leitor de cart√£o por aproxima√ß√£o.FechadurasSolen√≥ideFechadura em que um pino controla a abertura e o fechamento. H√° modelos que permitem uso da chave, muito √∫til em situa√ß√µes de falta de energia, por exemplo. Geralmente possuem sensor de porta aberta embutido. Normalmente usada em portas de madeira, pois comportam a fechadura. N√£o √© poss√≠vel usar em portas finas, como portas de vidro.Os modelos variam em:Fail safe: Pino recolhido quando h√° falta de energia el√©trica, ou seja, a porta fica aberta.Fail secure: Pino fica extendido se n√£o houver eletricidade, mantendo a porta trancada. Fechadura solen√≥ide.StrikeModelo em que √© enviado um pulso e o trinco pode ser recolhido, permitindo a abertura. Geralmente possui uma ma√ßaneta para o lado de dentro. Pode ser sobreposta ou interna √† porta. Muito usada em portas de vidro. S√£o do tipo fail secure, ou seja, n√£o permanecem abertas caso falte energia el√©trica. Fechadura strike Amelco.Eletroim√£Geralmente usada em portas de vidro, as fechaduras do tipo eletroim√£ abrem quando a energia √© desligada, ou seja, s√£o do tipo fail safe. Portanto, recomenda-se o uso de baterias ou outros sistemas de conting√™ncia para casos de falha na rede el√©trica. Podem ser instaladas basicamente em qualquer porta por serem de sobrepor. √â importante observar no ato da compra se a vers√£o adquirida √© para portas que abrem para dentro ou para fora. Fechadura eletroim√£ Intelbras.Conclus√£o e Recomenda√ß√£oGosto muito da marca ControlID. S√£o produtos nacionais, funcionam muito bem e possuem in√∫meras funcionalidades j√° embutidas nos produtos, al√©m de um suporte muito bom. S√£o facilmente encontradas no Mercado Livre e t√™m √≥tima rela√ß√£o custo/benef√≠cio.Costumo recomendar dois modelos: A ControlID IDFlex Pro e a ControlID IDLock Bio.ControlID IDFlex Pro Modelo que n√£o √© o Pro n√£o possui rede! Perde muita funcionalidade.Modelo que uso onde moro, em conjunto com uma fechadura solen√≥ide (Modelo: Automatiza FS1010). Destaco que este modelo se conecta √† rede (LAN), possui API e permite a abertura usando chave (de acordo com a fechadura usada). LAN: Permite acesso do computador ou do celular pela rede. A interface web √© √≥tima. Possui relat√≥rios de acessos, customiza√ß√£o do per√≠odo de acesso individualizado e personaliza√ß√£o completa do formul√°rio das pessoas, permitindo inserir foto, nome, cpf, telefone etc. As possibilidades s√£o infinitas. API: Para os desenvolvedores, a API √© um enorme diferencial para criar integra√ß√µes e solu√ß√µes novas. As possibilidades s√£o infitias. Uso, por exemplo, para receber uma mensagem quando algu√©m abre a porta. De ponto negativo, n√£o h√° como fugir da dificuldade de instala√ß√£o. √â necess√°rio chegar com rede el√©trica na fechadura e na leitora de digital.Site do fabricante.ControlID IDLock BioDe fac√≠lima instala√ß√£o, a IDLock Bio √© ideal para quem quer ter pouqu√≠ssimo trabalho e quer usar uma solu√ß√£o completa. Funciona com pilhas AA e a expectativa √© que as pilhas durem em torno de um ano.Possui todas as personaliza√ß√µes de cadastro da IDFlex, com o diferencial de n√£o ser acessada pela rede. Sua conex√£o √© feita via Bluetooth, permitindo fazer tudo por aplicativo de celular. O aplicativo √© sincronizado com a fechadura e permite a emiss√£o de senhas mesmo quando o telefone n√£o est√° ao alcance do sinal Bluetooth. Por n√£o estar ligada √† rede, n√£o √© poss√≠vel inserir novos cadastros quando se est√° longe da fechadura. N√£o possui API.Site do fabricante." }, { "title": "Telegram n√£o aumenta engajamento", "url": "/posts/TelegramInfluencer/", "categories": "Telegram, Curiosidades", "tags": "telegram, ferramenta, influencers, engajamento, analytics", "date": "2021-05-02 14:00:00 -0300", "snippet": " Quem v√™ Analytics, n√£o v√™ Telegram.Telegram √© uma √≥tima ferramenta para engajar o p√∫blico e manter toda a comunica√ß√£o organizada. Permite notificar 100% de seus seguidores instantaneamente e form...", "content": " Quem v√™ Analytics, n√£o v√™ Telegram.Telegram √© uma √≥tima ferramenta para engajar o p√∫blico e manter toda a comunica√ß√£o organizada. Permite notificar 100% de seus seguidores instantaneamente e formar uma comunidade unida e forte. Tudo sem exibir n√∫meros de telefone e preservando a privacidade de todos.Canais Canal @BsbDF.√â a maneira mais f√°cil de distribuir seu conte√∫do. Canais s√£o locais em que somente a pessoa que criou (e quem mais for autorizado) pode escrever. Os posts s√£o entregues instantaneamente para todos os assinantes. A lista de pessoas √© restrita aos administradores.Os canais podem ser p√∫blicos, sendo acess√≠veis com um @nome e mantendo o hist√≥rico vis√≠vel para todos. Podem tamb√©m ser vinculados a grupos, permitindo assim que as pessoas fa√ßam coment√°rios nas postagens e interajam entre si e tamb√©m com os administradores. A vincula√ß√£o √© feita nas propriedades do canal. Somente a pessoa que for dona do canal e do grupo pode fazer a integra√ß√£o. Vincular canal a grupo.GruposAssim como canais, grupos tamb√©m podem ser p√∫blicos. A grande diferen√ßa de um grupo para um canal √© que no segundo todos podem falar e podem ver a lista de membros. Os administradores podem ser colocados como an√¥nimos pelo dono do grupo. Quando an√¥nimos, n√£o aparecer√£o na listagem de pessoas e suas mensagens sair√£o em nome do grupo. Op√ß√£o de permanecer an√¥nimo.O grupo, quando vinculado ao canal, pode ser acessado nas propriedades do canal, clicando-se no bot√£o Conversar. Caso haja interesse que os membros do canal somente comentem no canal e n√£o no grupo1, mantendo a organiza√ß√£o, bots podem ser usados para n√£o permitir a entrada de pessoas no grupo. O @AutoKick_bot √© um exemplo de bot que pode ser colocado no grupo como administrador para garantir que as pessoas usem somente o canal. Op√ß√£o conversar em um canal.Analytics Analytics: Clique com origem Twitter.Diferentemente do Twitter, Facebook e outras redes, o Telegram n√£o altera os links. Por isto, n√£o √© poss√≠vel saber que o clique em seu site ou v√≠deo veio do app. Os cliques s√£o considerados cliques diretos, n√£o tendo uma origem definida. Analytics: Clique direto.Ou seja, a menos que os par√¢metros UTM2 sejam inseridos no link, as ferramentas de Analytics n√£o saber√£o a origem do clique, n√£o deixando claro o que veio do Telegram e o que n√£o veio.Exemplo de caso de uso: Em vez de usar no Telegram o link https://gabrf.com, pode-se usar o link https://blog.gabrf.com/?utm_source=telegram&amp;utm_medium=telegrammessage&amp;utm_campaign=rastreiobot. Desta forma todos os par√¢metros est√£o definidos e os cliques contados corretamente. Analytics: Clique com origem Telegram.Conclus√£oO Telegram pode sim ser uma excelente ferramenta para engajar as pessoas. Por√©m, √© importante saber que o app, por ter um enorme compromisso com a privacidade, acaba por n√£o entregar a origem dos cliques, dando a impress√£o que o app n√£o gera cliques ou engajamento.Caso a contagem de cliques seja relevante, √© importante conhecer as regras do jogo e as ferramentas dispon√≠veis. Um simples ajuste nos links far√° toda a diferen√ßa na contagem, sejam os links para sites, v√≠deos do YouTube ou qualquer outra rede. Ap√≥s a vincula√ß√£o, tudo o que √© postado no canal aparece no grupo, mas o que √© postado no grupo n√£o aparece no canal!¬†&#8617; Ferramenta para defini√ß√£o de par√¢metros UTM: https://ga-dev-tools.appspot.com/campaign-url-builder/¬†&#8617; " }, { "title": "Sua senha deve conter:", "url": "/posts/Passwords/", "categories": "Seguran√ßa, Gerenciadores de senhas", "tags": "senhas, seguran√ßa, gerenciador, cofre", "date": "2021-04-26 10:30:00 -0300", "snippet": " Letras mai√∫sculas Letras min√∫sculas N√∫meros Caracteres especiais Gifs Mais n√∫meros ainda Mais umas letrasCalma‚Ä¶Muito se fala em n√£o repetir as senhas, em ter senhas longas, em usar n√∫meros,...", "content": " Letras mai√∫sculas Letras min√∫sculas N√∫meros Caracteres especiais Gifs Mais n√∫meros ainda Mais umas letrasCalma‚Ä¶Muito se fala em n√£o repetir as senhas, em ter senhas longas, em usar n√∫meros, letras e caracteres especiais para se criar uma senha segura. Mas ningu√©m explica como fazer isto de maneira pr√°tica e que n√£o exija um monte de papel guardado na gaveta com as senhas.Gerenciadores de senhasS√£o aplicativos que armazenam suas credenciais (logins, senhas etc) de maneira segura, com criptografia, em um arquivo chamado cofre. Podem ser integrados aos navegadores e aos aparelhos celulares, tornando poss√≠vel o uso de senhas bastante complicadas sem que isto se torne muito trabalhoso. Basta cadastrar a senha no app e deixar o navegador auto-completar para voc√™. Em aparelhos com reconhecimento biom√©trico, as senhas s√£o preenchidas usando-se tais mecanismos, ou seja, tudo muito f√°cil e c√¥modo. Auto-preenchimento de senhaNo momento em que √© criado um novo cadastro o app sugere uma senha, que √© salva automaticamente salva no cofre. Ou seja, n√£o √© trabalhoso para usar a senha nem para criar um novo cadastro. EnPass: Tela de controleAl√©m de armazenar as credenciais, muitos gerenciadores de senhas verificam se voc√™ foi v√≠tima de vazamentos. S√£o calculados os hashes das senhas e s√£o comparados com dados dispon√≠veis online. Ou seja, a verifica√ß√£o √© feita de maneira segura, pois ningu√©m v√™ a sua senha, nem mesmo o app. Assim, fico sabendo de problemas sem que a autoridade do banco de dados precise me notificar, pois √© comum que tais avisos sejam feitos com consider√°vel atraso.Qual utilizar?Recomendo gerenciadores que n√£o usem nuvem pr√≥pria, ou seja, o cofre fica armazenado onde voc√™ escolher. Desta forma, supondo que seja descoberta uma falha de seguran√ßa no gerenciador, ser√° necess√°rio tamb√©m invadir o servi√ßo de armazenamento (Dropbox, Drive etc) para que se tenha acesso ao cofre.Gerenciadores de senhas que eu recomendo (em ordem alfab√©tica):1PasswordMuito famoso entre usu√°rios de dispositivos Apple.Ponto fraco: Uso limitado fora do ambiente Apple, motivo que me fez migrar.BitWardenGerenciador totalmente de c√≥digo aberto. Permite que qualquer pessoa avalie como o programa funciona e fa√ßa uma auditoria de seguran√ßa.Aplicativo gratuito para uso individual. Nunca o utilizei, mas tem uma fama excelente.Enpass√â o que uso atualmente. O que me atraiu na √©poca foi o funcionamento nos principais sistemas operacionais do Mercado. Funciona muit√≠ssimo bem.LessPassGerenciador de senhas open source e que n√£o possui cofre. A senha √© calculada de acordo com par√¢metros de cada servi√ßo/site no momento do uso. √â um paradigma novo comparado aos anteriores.Na pr√°ticaN√£o vivo sem um gerenciador de senhas. Sempre que o sistema permite, coloco senhas com mais de 50 caracteres. Ainda, com o uso do MailShieldBot, al√©m de uma senha por servi√ßo, tenho tamb√©m um e-mail por servi√ßo, tornando imposs√≠vel lembrar de todas as informa√ß√µes sem um cofre/gerenciador de senhas. Tenho tamb√©m o h√°bito de salvar os dados de meus documentos em notas no cofre, tendo sempre em local de f√°cil acesso n√∫meros que nunca me recordo, como PIS, n√∫mero do t√≠tulo de eleitor ou de reservista.Neste cen√°rio, mesmo que haja um vazamento de dados, que o app me notifica, sei que o preju√≠zo m√°ximo n√£o ser√° muito grande, pois a senha vazada funciona em no m√°ximo um local e o e-mail vazado √© exclusivo do servi√ßo, ou seja, a pessoa que obteve os dados pouco conseguir√° fazer, pois n√£o ser√° poss√≠vel autenticar em nenhum outro local. Nem a senha nem o e-mail ser√£o v√°lidos em outros sites e servi√ßos. O quanto antes providenciarei a troca da senha vazada e pronto. N√£o preciso mexer em v√°rios locais para manter meus dados seguros.E assim, durmo tranquilo!Use autentica√ß√£o em dois fatores!" }, { "title": "Os porqu√™s do Wi-Fi", "url": "/posts/Wifi/", "categories": "Rede, Wi-Fi", "tags": "rede, wifi, mesh, canal, site-survey", "date": "2021-03-25 10:00:00 -0300", "snippet": "Originalmente postado no CocaTechAtualmente muitos de n√≥s possu√≠mos redes wi-fi em casa e no trabalho. √â uma comodidade inexplic√°vel ter acesso √† internet de qualquer lugar. Por√©m, poucos sabem os ...", "content": "Originalmente postado no CocaTechAtualmente muitos de n√≥s possu√≠mos redes wi-fi em casa e no trabalho. √â uma comodidade inexplic√°vel ter acesso √† internet de qualquer lugar. Por√©m, poucos sabem os porqu√™s da rede. Porque falta sinal em algum lugar ou at√© porque o sinal cai repentinamente. A ideia aqui √© explicar um pouco os problemas e sugerir solu√ß√µes.Praticamente todas as redes wi-fi funcionam em 2.4 GHz. Por que isso? Todas as frequ√™ncias entre 2.4 GHz e 2.5 GHz fazem parte de uma classe de frequ√™ncias chamada ISM, frequ√™ncias n√£o licenci√°veis, ou seja, de uso livre para qualquer tecnologia desde que respeitados os limites impostos pelo pa√≠s.A tecnologia wi-fi em 2.4 GHz (mais comum) usa 11 canais (padr√£o EUA) de 22 MHz cada. V√£o de 2401 MHz a 2473 MHz. Canal Frequ√™ncia in√≠cio Frequ√™ncia meio Frequ√™ncia fim 1 2401 2412 2423 2 2406 2417 2428 3 2411 2422 2433 4 2416 2427 2438 5 2421 2432 2443 6 2426 2437 2448 7 2431 2442 2453 8 2436 2447 2458 9 2441 2452 2463 10 2446 2457 2468 11 2451 2462 2473 Canais de wi-fi (adaptado da Wikipedia)Cada canal interfere em quatro canais em cada um dos lados. Portanto, caso esteja usando o canal 6, por exemplo, os canais 2, 3, 4 e 5 sofrer√£o de um lado assim como os canais 7, 8, 9 e 10 sofrer√£o do outro. Somente estar√£o totalmente livres de interfer√™ncia os canais 1 e 11.Site survey √© o nome do estudo feito em um ambiente sobre a ocupa√ß√£o de tais canais visando um melhor uso do espectro. Como exemplo, cito o iStumbler, gratuito para OS X. Nele podemos ver, entre outros detalhes, em quais canais est√£o cada uma das redes. H√° v√°rios programas com a mesma finalidade. Busque o que atende melhor as suas necessidades.Por ser uma banda livre, tamb√©m podem ser encontrados em 2.4 GHz diversos outros dispositivos em funcionamento. O telefone sem fio, por exemplo, pode ser um vil√£o para as redes wi-fi. √â exatamente por isso que eles possuem a tecla ‚Äúcanal‚Äù (channel). Sua fun√ß√£o √© alterar o canal em uso, diminuindo assim interfer√™ncias.Outro grande vil√£o √© o forno de microondas. Ele tamb√©m opera na faixa de 2.4 GHz, frequ√™ncia capaz de movimentar as mol√©culas da √°gua. Movimento √© igual a calor. Pronto. √â assim que ele funciona. E assim tamb√©m que ele causa interfer√™ncia nas redes.√â por esse mesmo motivo que uma rede sem fio tem dificuldades de atravessar banheiros. O que temos em abund√¢ncia l√°? √Ågua! Grande parte (ou toda) a pot√™ncia do sinal √© perdida. √Å agua a ‚Äúconsome‚Äù. Al√©m disso, o sinal sem fio costuma ter dificuldade de atravessar espelhos e superf√≠cies met√°licas, muito comuns em banheiros.Ainda n√£o resolveu os problemas da sua rede? Comece a procurar ao seu redor ent√£o por aparelhos de bab√°-eletr√¥nica, walkie-talkies etc. √â triste, mas muitas coisas operam em 2.4 GHz.Como √∫ltimo recurso, opte por um roteador sem fio 802.11a/ac/n, pois operam na faixa de 5 GHz. A vantagem dessa faixa √© oferecer mais canais e sofrer menos interfer√™ncia, pois poucos dispositivos operam nela. A desvantagem de operar em 5 GHz √© a menor √°rea de cobertura. Mantidos todos os par√¢metros constantes, quanto maior a frequ√™ncia, menor a dist√¢ncia. Por isso, caso tenha um roteador que opera nas duas bandas, provavelmente voc√™ j√° reparou que uma das redes √© muito maior que a outra." }, { "title": "ChatDeVozBot - Inser√ß√µes de voz no Telegram", "url": "/posts/TelegramVoiceChat/", "categories": "Telegram, VoiceMeeter Banana", "tags": "telegram, voicemeeter, banana, voz, audio", "date": "2021-03-10 12:00:00 -0300", "snippet": " Aten√ß√£o: Para este guiar funcionar, √© necess√°rio ler este post antes!Dando continuidade ao uso do VoiceMeeter, criei um bot para ser usado em Chats de Voz no Telegram. Sua principal fun√ß√£o √© rece...", "content": " Aten√ß√£o: Para este guiar funcionar, √© necess√°rio ler este post antes!Dando continuidade ao uso do VoiceMeeter, criei um bot para ser usado em Chats de Voz no Telegram. Sua principal fun√ß√£o √© receber mensagens de √°udio e as encaminhar para uma pessoa respons√°vel pela an√°lise e reprodu√ß√£o do conte√∫do.Instru√ß√µes para uso no grupoAdicione o ChatDeVozBot como administrador de seu grupo.Iniciar o botPara iniciar o bot no grupo, envie /iniciar. O bot enviar√° uma mensagem comunicando o in√≠cio de seu funcionamento e fixar√° uma mensagem que cont√©m um bot√£o para que os √°udios sejam enviados. A pessoa que enviar este comando receber√° todos os √°udios em privado, via bot, para an√°lise do conte√∫do. Iniciando o ChatDeVozBot no grupoComo usar o VoiceMeeterA pessoa que administrar√° os √°udios far√° o controle do que ser√° ou n√£o tocado no chat de voz nos bot√µes do VoiceMeeter. Neste caso, a parte mais importante √© o ret√¢ngulo amarelo, a Entrada Virtual. Para este uso em espec√≠fico, recomendo que o volume seja deixado em 0dB. VoiceMeeter Banana pronto para usoPara que somente a pessoa que administra a fila ou√ßa o √°udio, basta desativar B1 no ret√¢ngulo amarelo.Deixando B1 ativado, o √°udio ser√° enviado para o Chat de Voz, permitindo que todos o ou√ßam.Parar o botPara encerrar, basta que qualquer administrador envie /parar. Parando o ChatDeVozBot no grupoInstru√ß√µes para uso geralClique no bot√£o /Participar enviado no grupo. Ser√° aberta uma conversa com o bot. Clique em Come√ßar e, em seguida, envie sua mensagem de voz. Enviando mensagem de voz para o ChatDeVozBotPara enviar uma nova mensagem, repita o procedimento." }, { "title": "VoiceMeeter Banana e Chat de Voz do Telegram", "url": "/posts/TelegramBanana/", "categories": "Telegram, VoiceMeeter Banana", "tags": "telegram, voicemeeter, banana, voz, audio", "date": "2021-03-07 12:00:00 -0300", "snippet": "Originalmente postado no Telegraph Este ser√° um breve guia de como controlar o que √© transmitido para o Telegram. N√£o ser√° um guia altamente t√©cnico nem detalhado. A inten√ß√£o √© apenas demonstrar, ...", "content": "Originalmente postado no Telegraph Este ser√° um breve guia de como controlar o que √© transmitido para o Telegram. N√£o ser√° um guia altamente t√©cnico nem detalhado. A inten√ß√£o √© apenas demonstrar, de maneira r√°pida, como controlar o som de seu computador.Instala√ß√£oEste software funciona somente em Windows e pode ser baixado aqui. Fa√ßa o download e siga os passos da instala√ß√£o. √â recomend√°vel reiniciar o computador no fim da instala√ß√£o.Configura√ß√£o de sa√≠dasO programa pode ser visto como dividido em duas partes. Inicialmente daremos aten√ß√£o ao lado direito do programa, onde s√£o configuradas as interfaces de sa√≠da de som. Sa√≠das de som do VoiceMeeterInicie os ajustes pelas sa√≠das f√≠sicas do programa, marcadas em vermelho. Coloque ali tudo o que voc√™ usar para escutar o som, podendo ser o pr√≥prio monitor, fones de ouvido, caixas de som etc. O programa suporta no m√°ximo tr√™s sa√≠das de som f√≠sicas. Para funcionar √© necess√°rio ao menos uma.Na imagem de exemplo est√£o configuradas duas interfaces de sa√≠da, sendo: A1: Fone de ouvido A2: Monitor A3: N√£o utilizadaRecomendo nomear os ajustes de n√≠vel de maneira a facilitar o controle. Para isto, basta clicar com o bot√£o direito do mouse no nome que deseja alterar, como demonstrado no quadrado amarelo da imagem. Repare que ali aparecem mais duas sa√≠das, as sa√≠das virtuais, sendo elas: B1: Sa√≠da virtual principal B2: Sa√≠da virtual auxiliarO controle de volume de todas as sa√≠das √© feito movendo-se as barras verdes. Zero dB significa o volume ‚Äúnormal‚Äù, sem amplifica√ß√£o. Ou seja, caso seu fone, por exemplo, tenha um controle de volume, zero dB ser√° igual ao ajustado no fone. Feita uma altera√ß√£o no valor, para voltar ao zero basta um duplo clique na barra verde.Valores acima de zero podem causar distor√ß√µes no som e at√© problemas por excesso de amplifica√ß√£o. Sugiro nunca passar de zero. Se precisar aumentar o volume, sugiro controlar no pr√≥prio dispositivo.Configura√ß√µes de entrada Entradas de som do VoiceMeeterJ√° no lado esquerdo do programa s√£o feitos os ajustes das interfaces de entrada. Na parte em vermelho, clique nos textos Hardware Input e defina quais s√£o seus componentes de entrada. Na imagem de exemplo est√° definido apenas uma interface de entrada, um microfone. Na imagem temos: Hardware Input 1: Microfone Hardware Input 2: N√£o utilizada Hardware Input 3: N√£o utilizadaNo quadrado amarelo s√£o definidos os volumes das entradas. Ali est√£o definidas tamb√©m duas interfaces virtuais de entrada, localizadas na por√ß√£o mais a direita dentro ret√¢ngulo amarelo.Configura√ß√µes no WindowsClique com o bot√£o direito do mouse sobre o √≠cone de som e selecione Abrir Configura√ß√µes de Som. Op√ß√µes de som do WindowsSer√° aberta a janela de configura√ß√µes do Windows. Configura√ß√µes de som do WindowsSelecione a entrada virtual principal do VoiceMeeter como sa√≠da de som e VoiceMeeter Output como a entrada de som, conforme a imagem. Ou seja, o som que sair do Windows entrar√° no VoiceMeeter e o som que entrar no Windows ter√° como origem o VoiceMeeter.Configura√ß√µes no TelegramEntre em um chat de voz do Telegram e clique nos ajustes de som, marcados em vermelho. Canal de voz do TelegramSer√° aberta a tela de ajustes. Configure como a imagem, com Speakers: Entrada virtual auxiliar do VoiceMeeter Microphone: Sa√≠da do VoiceMeeter Ajustes de som do canal de vozUtiliza√ß√£oFeita a configura√ß√£o, temos: Entrada 1: Microfone Entrada Virtual Principal: Windows Entrada Virtual Auxiliar: Chat de Voz Sa√≠da A1: Fone de Ouvido Sa√≠da A2: Monitor Sa√≠da B1: Sa√≠da de Som VirtualDesta forma, para fazer com que os participantes ou√ßam o microfone basta selecionar B1 no microfone. VoiceMeeter enviando o som do microfone para a sa√≠da B1Para que o som do chat de voz saia no fone de ouvido, basta selecionar A1 na Entrada Virtual Auxiliar. VoiceMeeter enviando som do chat de voz para o fone de ouvido, sa√≠da A1Configura√ß√£o completa VoiceMeeter corretamente configurado para o Chat de Voz com m√∫sicaFinalmente, esta √© a forma correta de se configurar o VoiceMeeter para que se use o Chat de Voz do Telegram transmitindo m√∫sica.Re√¢ngulo VermelhoMicrofone enviando o som para B1, permitindo que os participantes do Chat de Voz escutem o que √© falado.Ret√¢ngulo AmareloEntrada virtual enviando som para A1 e B1, ou seja, a m√∫sica que √© tocada no meu Windows (seja no navegador, no Spotify etc) √© enviada para meu fone de ouvido (A1) e para o chat de voz (B1). Note que este volume est√° em -15, pois assim a m√∫sica fica com o volume diminu√≠do.Ret√¢ngulo VerdePor fim, a entrada virtual auxiliar envia o som para o fone de ouvido (A1), permitindo que o que √© dito no chat de voz seja ouvido." }, { "title": "O RastreioBot apagou minha mensagem!", "url": "/posts/BotMsgDelete/", "categories": "Telegram, Bot", "tags": "telegram, seguran√ßa, bot, rastreiobot", "date": "2021-03-03 15:00:00 -0300", "snippet": "√â comum algu√©m comentar que o RastreioBot apagou uma mensagem que n√£o era c√≥digo de rastreio. Mas calma, tudo tem explica√ß√£o.O RastreioBot √© um programa de computador que funciona 24 horas por dia ...", "content": "√â comum algu√©m comentar que o RastreioBot apagou uma mensagem que n√£o era c√≥digo de rastreio. Mas calma, tudo tem explica√ß√£o.O RastreioBot √© um programa de computador que funciona 24 horas por dia em uma m√°quina na nuvem. Ele segue um algoritmo que recebe as mensagens e verifica automaticamente se o pacote foi atualizado no sistema dos Correios. Seu papel √© unicamente este.Por√©m, por diversos motivos, algumas pessoas t√™m o h√°bito de usar o bot como bloco de notas, local para salvar fotos, textos e muito mais, fugindo totalmente de seu escopo de funcionamento. N√£o recomendo fazer isto! Mensagem sendo apagada no RastreioBotTodo bot do Telegram √© controlando pelo token, uma chave fornecida pelo app assim que o bot √© cadastrado. O token deve ser mantido em segredo, pois √© com ele que o bot √© controlado e as intera√ß√µes s√£o feitas. Uma pessoa em poder do token, sendo quem criou o bot ou n√£o, √© capaz de ver todo o hist√≥rico do bot, tudo o que j√° passou por ele, sejam mensagens diretamente ao bot ou mensagens em grupos em que o bot possa ler tudo.Quando uma mensagem √© apagada pelo bot, a mensagem some para o usu√°rio e tamb√©m dos servidores do Telegram. Ou seja, ao apagar a mensagem, todo o risco de vazamento de dados acaba, pois a mensagem deixa de existir. Mesmo que ocorra um problema em que o token fique exposto ou se torne p√∫blico, as mensagens apagadas n√£o poder√£o ser recuperadas.Portanto, n√£o se preocupe. Sua mensagem foi apagada para o seu bem. A mensagem some do programa do bot, do servidor do Telegram e da sua tela. A informa√ß√£o some da onde n√£o devia estar e continua sendo exclusivamente sua.Mensagens salvasO Telegram oferece um local espec√≠fico para salvar tudo que voc√™ quiser, √© o espa√ßo Mensagens Salvas. L√° voc√™ pode salvar textos e arquivos de at√© 2GB cada, sem limite de arquivos. Para acessar, v√° nas configura√ß√µes do app e clique em Mensagens Salvas.Dica: Fixe o Mensagens Salvas no topo das conversas." }, { "title": "Esqueci minha senha", "url": "/posts/Hash/", "categories": "Seguran√ßa, Hash de senha", "tags": "senhas, seguran√ßa, hash", "date": "2021-03-01 18:00:00 -0300", "snippet": "Quem administra um sistema deve ser capaz de consultar as senhas de todas as pessoas?Definitivamente n√£o!As senhas nunca devem ser armazenadas em claro, de maneira que possam ser lidas, nos bancos ...", "content": "Quem administra um sistema deve ser capaz de consultar as senhas de todas as pessoas?Definitivamente n√£o!As senhas nunca devem ser armazenadas em claro, de maneira que possam ser lidas, nos bancos de dados. Isto representa uma falha de seguran√ßa e potencializa as eventuais consequ√™ncias de um vazamento de dados.Uma maneira de saber se o sistema √© bem projetado ou n√£o √© clicando no bot√£o ‚ÄúEsqueci minha senha‚Äù. Se a senha for enviada para seu e-mail ent√£o claramente sua senha est√° salva no banco. Reclame. Est√° errado.Fun√ß√µes HASHSem entrar em muitos detalhes t√©cnicos e de implementa√ß√£o, o que deve ser salvo no banco de dados √© o hash da senha. Uma fun√ß√£o hash √© uma fun√ß√£o matem√°tica que faz um c√°lculo que n√£o √© revers√≠vel, ou seja, uma vez calculado o hash, n√£o √© poss√≠vel obter o dado que o gerou.Exemplos de c√°lculos usando diferentes algoritmos:hash.md5('Gabriel')b70e2a0d855b4dc7b1ea34a8a9d10305hash.sha1('Gabriel')aaac72d4824650c176db2fc2451be237f164ea98hash.sha224('Gabriel')407df5cd4cac7957a889f640396e3e3622a8f4d880360b883c880772. . . hash.sha512('Gabriel')7d3f59986c56cf117b273aa04bf82d6cd1eab4325f2799377a02ba441c7ee56162f77f9a023171f3c72ac346dc3293ddc89d5f8e0a70c4a1a14fe0ce13220f41Ningu√©m √© capaz, matematicamente, de obter a palavra Gabriel tendo os hashes calculados, pois o c√°lculo n√£o √© revers√≠vel. Ou seja, ao digitar a senha em um sistema, o sistema faz o c√°lculo de hash, verifica se o resultado coincide com o valor armazenado no banco de dados e permite ou n√£o o acesso. A senha n√£o √© salva. Repare ainda que qualquer altera√ß√£o no valor inserido na fun√ß√£o hash gera um resultado completamente novo.Compare os valores gerados por Gabriel e GAbriel:hash.md5('Gabriel')b70e2a0d855b4dc7b1ea34a8a9d10305hash.md5('GAbriel')8783d83d6f4098dd5d717b5f796c21a6Com a altera√ß√£o de apenas uma letra, trocando-a de min√∫scula para mai√∫scula, a sa√≠da j√° foi completamente diferente. Isto √© √∫til para garantir hashes √∫nicos para cada entrada.Colis√µesPor√©m, fun√ß√µes hash n√£o s√£o perfeitas. O algoritmo MD5, por exemplo, tem uma sa√≠da de 32 caracteres, 128 bits, ou seja, possui um universo total de 2^128 (340282366920938463463374607431768211456) possibilidades. √â um n√∫mero enorme para um humano, mas n√£o para um computador. Quando duas entradas geram o mesmo resultado hash, acontece o que √© chamado de colis√£o.Imagine um banco de dados com 2^128 hashes MD5 previamente calculados. Imagine tamb√©m que uma pessoa teve acesso aos hashes dos usu√°rios de determinado sistema1. Esta pessoa n√£o precisa saber sua senha, basta saber um valor que gere o mesmo hash (uma colis√£o) para se passar por voc√™. Tal pr√°tica √© chamada de Ataque de Dicion√°rio. Por este motivo, novos algoritmos de hash s√£o criados, pois a cada nova gera√ß√£o h√° um aumento no tamanho da sa√≠da, aumentando a quantidade de resultados e, consequentemente, diminuindo a possibilidade de colis√µes. A fun√ß√£o hash SHA512 possui 512 bits, ou seja, o valor total de possibilidades √©: 13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084096Fazendo as contas, o SHA512 √© 39 septrigintilh√µes de vezes maior que o MD5! 2Hash de arquivosSabendo que uma fun√ß√£o hash gera resultados que podem ser considerados √∫nicos para diferentes entradas, outro uso comum √© para verificar a integridade de arquivos.Um bom exemplo √© o sistema operacional Ubuntu, que pode ser baixado de in√∫meros sites. Portanto, uma maneira segura de saber se o arquivo baixado √© √≠ntegro √© calculando seu hash e comparando-o com o que √© disponibilizado no site oficial3. Desta forma n√£o restar√° d√∫vidas se o arquivo foi adulterado ou n√£o. Os sistemas devem ser protegidos de tais ataques usando *SALT* e/ou outros m√©todos, mas n√£o √© o foco do texto.¬†&#8617; https://www.wolframalpha.com/input/?i=2%5E512+%2F+2%5E128¬†&#8617; releases.ubuntu.com¬†&#8617; " }, { "title": "Send2KindleBot - Como enviar arquivos para seu Kindle", "url": "/posts/Send2KindleBot/", "categories": "Telegram, Bot", "tags": "kindle, send2kindlebot, telegram, bot", "date": "2021-02-25 15:00:00 -0300", "snippet": "O Send2KindleBot √© a maneira mais pr√°tica de enviar arquivos e documentos para seu Kindle! √â um bot no Telegram, gratuito e de c√≥digo aberto, traduzido para mais de 20 idiomas.Instru√ß√µes de usoSolu...", "content": "O Send2KindleBot √© a maneira mais pr√°tica de enviar arquivos e documentos para seu Kindle! √â um bot no Telegram, gratuito e de c√≥digo aberto, traduzido para mais de 20 idiomas.Instru√ß√µes de usoSolu√ß√µes de problemasInstru√ß√µes de uso Usando o Telegram, fale com o @Send2KindleBot Clique em Come√ßar Conforme solicitado, envie o e-mail de seu dispositivo Kindle, que normalmente termina em @kindle.com Em seguida, envie o e-mail de sua conta da Amazon. √â o seu e-mail usado para acessar o site da Amazon (GMail, Hotmail etc) Pronto! üéâFeita a configura√ß√£o, o bot estar√° pronto para enviar os arquivos, sejam eles mobi, doc, txt, epub ou outro formato. O bot tamb√©m √© capaz de enviar sites para o Kindle. Neste caso, um PDF da p√°gina ser√° enviado para seu dispositivo, sendo poss√≠vel optar no momento do envio se uma convers√£o para mobi deve ser feita ou n√£o.Solu√ß√µes de problemas Bot n√£o funciona ou os arquivos n√£o chegamEnvie /start para o bot e confira se os e-mails est√£o certos. Qualquer erro de digita√ß√£o faz diferen√ßa. Para corrigir o problema, clique no bot√£o Ajustar e-mail e envie o endere√ßo que deseja alterar, sendo o do Kindle ou o da sua conta.Se n√£o houver erro, verifique se chegou algo em seu e-mail. A solu√ß√£o abaixo pode te ajudar se for este o caso. Amazon envia e-mail pedindo confirma√ß√£o do envioA confirma√ß√£o de envio √© necess√°ria quando os dois e-mails (do Kindle e da conta) s√£o muito parecidos. Exemplo fict√≠cio:gabriel@gmail.com e gabriel@kindle.comNeste caso, para corrigir o problema, basta deix√°-los diferentes. Ou seja, trocar o e-mail do Kindle ou o e-mail autorizado a enviar documentos.Basta seguir uma das instru√ß√µes abaixo para resolver o problema. Trocar o e-mail do KindleAcesse o site da Amazon. V√° em Conta, Dipositivos, Selecione o Kindle, Clique em Editar para alterar o e-mail. Algo como kindlegabriel@kindle.com seria um exemplo de solu√ß√£o, pois deixaria bem diferente de gabriel@gmail.com. Feita a altera√ß√£o, volte ao bot, clique em Alterar e-mail e envie o novo e-mail cadastrado. Instru√ß√µes de troca de e-mail do Kindle Adicionar um e-mail autorizado a enviar arquivosAcesse o site da Amazon, v√° em Conta, Dispositivos, Prefer√™ncias, Configura√ß√µes de documentos pessoais, Adicionar um novo endere√ßo de e-mail aprovado e adicione um outro e-mail que voc√™ tenha. Por fim, clique em Alterar e-mail no bot e envie o novo e-mail cadastrado. Instru√ß√µes de troca de e-mail autorizado" } ]
